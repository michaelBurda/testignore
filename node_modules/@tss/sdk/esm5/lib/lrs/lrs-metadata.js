/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { IntersectionLayer } from './intersections/intersection-layer';
import { EventLayer } from './events/event-layer';
import { NetworkLayer } from './networks/network-layer';
import { RedlineLayer } from './redlines/redline-layer';
import { CenterlineLayer } from './centerlines/centerline-layer';
import { CalibrationPointLayer } from './calibration-points/calibration-point-layer';
import { MapServerMetadata } from '../maps/map-server-metadata';
import { getGeometryField, getIdField } from '../maps/fields/layer-field';
import { findLayer } from './layer-search';
import { mergeMapMetadata, mergeLrsMetadata, deepMergeMapMetadata } from './lrs-metadata-merge';
import { LRS_METADATA_VALIDATIONS } from './lrs-metadata-validations';
import { NonLrsLayer } from './non-lrs/non-lrs-layer';
import { isNotValue } from '../core/type-check/is-not-value.function';
import { clone } from '../core/clone/clone.function';
/**
 * @param {?} layerId
 * @param {...?} layerList
 * @return {?}
 */
function find(layerId) {
    var layerList = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        layerList[_i - 1] = arguments[_i];
    }
    return findLayer.apply(void 0, tslib_1.__spread([layerId], layerList));
}
var LrsMetadata = /** @class */ (function (_super) {
    tslib_1.__extends(LrsMetadata, _super);
    function LrsMetadata(dataSource) {
        var _this = _super.call(this) || this;
        _this.networkLayers = [];
        _this.eventLayers = [];
        _this.redlineLayers = [];
        _this.centerlineLayers = [];
        _this.calibrationPointLayers = [];
        _this.intersectionLayers = [];
        _this.nonLRSLayers = [];
        _this.lrs = [];
        _this.domains = [];
        if (dataSource) {
            _this.dataSource = dataSource;
            _this.dataSourceId = dataSource.id;
        }
        return _this;
    }
    /**
     * Gets a layer by ID - searching across all types (event layers, network layers, etc).
     */
    /**
     * Gets a layer by ID - searching across all types (event layers, network layers, etc).
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.getLayer = /**
     * Gets a layer by ID - searching across all types (event layers, network layers, etc).
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return find(layerId, this.getAllLayers());
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.getLrsLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return (/** @type {?} */ ((find(layerId, this.networkLayers, this.eventLayers, this.redlineLayers))));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.getLayerDetail = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        // TODO: Come up with a better way to check these layer types.
        // NOTE: We are doing all of these boolean checks instead of just simply calling
        // isEventLayer = this.isEventLayer(layerId) because of performance reasons.
        /** @type {?} */
        var isLrsLayer = this.isLrsLayer(layerId);
        /** @type {?} */
        var isEventLayer = this.isEventLayer(layerId);
        /** @type {?} */
        var isNetworkLayer = !isEventLayer && this.isNetworkLayer(layerId);
        /** @type {?} */
        var isCalibrationPointLayer = !isEventLayer && !isNetworkLayer && this.isCalibrationPointLayer(layerId);
        /** @type {?} */
        var isCenterlineLayer = !isEventLayer && !isNetworkLayer && !isCalibrationPointLayer && this.isCenterlineLayer(layerId);
        /** @type {?} */
        var isIntersectionLayer = !isEventLayer && !isNetworkLayer && !isCalibrationPointLayer && !isCenterlineLayer
            && this.isIntersectionLayer(layerId);
        /** @type {?} */
        var isRedlineLayer = !isEventLayer && !isNetworkLayer && !isCalibrationPointLayer && !isCenterlineLayer && !isIntersectionLayer
            && this.isRedlineLayer(layerId);
        /** @type {?} */
        var isTable = !isEventLayer && !isNetworkLayer && !isCalibrationPointLayer && !isCenterlineLayer && !isIntersectionLayer
            && !isRedlineLayer && this.isTable(layerId);
        /** @type {?} */
        var isNonLRSLayer = !isEventLayer && !isNetworkLayer && !isCalibrationPointLayer && !isCenterlineLayer && !isIntersectionLayer
            && !isRedlineLayer && !isTable && this.isNonLRSLayer(layerId);
        /** @type {?} */
        var layer = this.getLayer(layerId);
        /** @type {?} */
        var shapeField = layer ? getGeometryField(layer.fields) : null;
        /** @type {?} */
        var idField = layer ? getIdField(layer.fields) : null;
        return {
            layer: layer,
            layerId: layerId,
            isEventLayer: isEventLayer,
            isNetworkLayer: isNetworkLayer,
            isCalibrationPointLayer: isCalibrationPointLayer,
            isCenterlineLayer: isCenterlineLayer,
            isIntersectionLayer: isIntersectionLayer,
            isRedlineLayer: isRedlineLayer,
            isTable: isTable,
            isNonLRSLayer: isNonLRSLayer,
            isLrsLayer: isLrsLayer,
            shapeField: shapeField,
            idField: idField,
        };
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.isLrsLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return Boolean(this.getLrsLayer(layerId));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.isNetworkLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return Boolean(find(layerId, this.networkLayers));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.isEventLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return Boolean(find(layerId, this.eventLayers));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.isIntersectionLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return Boolean(find(layerId, this.intersectionLayers));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.isRedlineLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return Boolean(find(layerId, this.redlineLayers));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.isCenterlineLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return Boolean(find(layerId, this.centerlineLayers));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.isCalibrationPointLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return Boolean(find(layerId, this.calibrationPointLayers));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.isNonLRSLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return Boolean(find(layerId, this.nonLRSLayers));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.isTable = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return Boolean(find(layerId, this.tables));
    };
    /**
     * Merges map server general information into this LRS metadata instance.
     */
    /**
     * Merges map server general information into this LRS metadata instance.
     * @param {?} mapMetadata
     * @return {?}
     */
    LrsMetadata.prototype.mergeMapMetadata = /**
     * Merges map server general information into this LRS metadata instance.
     * @param {?} mapMetadata
     * @return {?}
     */
    function (mapMetadata) {
        mergeMapMetadata(this, mapMetadata);
        return this;
    };
    /**
     * @param {?} mapMetadata
     * @return {?}
     */
    LrsMetadata.prototype.deepMergeMapMetadata = /**
     * @param {?} mapMetadata
     * @return {?}
     */
    function (mapMetadata) {
        deepMergeMapMetadata(this, mapMetadata);
        return this;
    };
    /**
     * Merges other LRS metadata into this LRS metdata instance.
     */
    /**
     * Merges other LRS metadata into this LRS metdata instance.
     * @param {?} lrsMetadata
     * @return {?}
     */
    LrsMetadata.prototype.mergeLrsMetadata = /**
     * Merges other LRS metadata into this LRS metdata instance.
     * @param {?} lrsMetadata
     * @return {?}
     */
    function (lrsMetadata) {
        mergeLrsMetadata(this, lrsMetadata);
        return this;
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.getNetworkLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return (/** @type {?} */ (find(layerId, this.networkLayers)));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.getEventLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return (/** @type {?} */ (find(layerId, this.eventLayers)));
    };
    /**
     * @param {?} layerId
     * @return {?}
     */
    LrsMetadata.prototype.getIntersectionLayer = /**
     * @param {?} layerId
     * @return {?}
     */
    function (layerId) {
        return (/** @type {?} */ (find(layerId, this.intersectionLayers)));
    };
    /**
     * @return {?}
     */
    LrsMetadata.prototype.getLrsLayers = /**
     * @return {?}
     */
    function () {
        return ((/** @type {?} */ (this.eventLayers)))
            .concat(this.networkLayers)
            .concat(this.redlineLayers);
    };
    /**
     * @return {?}
     */
    LrsMetadata.prototype.getFeatureClassLayers = /**
     * @return {?}
     */
    function () {
        return ((/** @type {?} */ (this.eventLayers)))
            .concat(this.networkLayers)
            .concat(this.redlineLayers)
            .concat(this.calibrationPointLayers)
            .concat(this.centerlineLayers)
            .concat(this.nonLRSLayers);
    };
    /**
     * @return {?}
     */
    LrsMetadata.prototype.getAllLayers = /**
     * @return {?}
     */
    function () {
        return ((/** @type {?} */ (this.getFeatureClassLayers())))
            .concat(this.tables)
            .concat(this.layers);
    };
    /**
     * @param {?} layer
     * @return {?}
     */
    LrsMetadata.prototype.getNetworkIdForLayer = /**
     * @param {?} layer
     * @return {?}
     */
    function (layer) {
        /** @type {?} */
        var networkId = null;
        if (this.isEventLayer(layer.id)) {
            /** @type {?} */
            var eventLayer = (/** @type {?} */ (layer));
            networkId = eventLayer.parentNetwork ? eventLayer.parentNetwork.id : null;
        }
        if (isNotValue(networkId)) {
            this.networkLayers.forEach((/**
             * @param {?} network
             * @return {?}
             */
            function (network) {
                if (network.eventLayers.find((/**
                 * @param {?} l
                 * @return {?}
                 */
                function (l) { return l.id === layer.id; }))) {
                    networkId = network.id;
                }
            }));
        }
        return networkId;
    };
    /**
     * @param {?} networkLayerId
     * @return {?}
     */
    LrsMetadata.prototype.getEventLayersByNetwork = /**
     * @param {?} networkLayerId
     * @return {?}
     */
    function (networkLayerId) {
        /** @type {?} */
        var networkLayer = this.getNetworkLayer(networkLayerId);
        return this.eventLayers.filter((/**
         * @param {?} layer
         * @return {?}
         */
        function (layer) {
            return layer.parentNetwork
                && layer.parentNetwork.id === networkLayerId
                || networkLayer.eventLayers
                    && networkLayer.eventLayers.find((/**
                     * @param {?} l
                     * @return {?}
                     */
                    function (l) { return l.id === layer.id; }));
        }));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    LrsMetadata.prototype.rebuildLayers = /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        var _this = this;
        (/** @type {?} */ (this)).eventLayers = (/** @type {?} */ (this)).eventLayers.map((/**
         * @param {?} eventLayer
         * @return {?}
         */
        function (eventLayer) { return new EventLayer(find(eventLayer.id, (/** @type {?} */ (_this)).layers), eventLayer); }));
        (/** @type {?} */ (this)).networkLayers = (/** @type {?} */ (this)).networkLayers.map((/**
         * @param {?} networkLayer
         * @return {?}
         */
        function (networkLayer) { return new NetworkLayer(find(networkLayer.id, (/** @type {?} */ (_this)).layers), networkLayer); }));
        (/** @type {?} */ (this)).redlineLayers = (/** @type {?} */ (this)).redlineLayers.map((/**
         * @param {?} redlineLayer
         * @return {?}
         */
        function (redlineLayer) { return new RedlineLayer(find(redlineLayer.id, (/** @type {?} */ (_this)).layers), redlineLayer); }));
        (/** @type {?} */ (this)).centerlineLayers = (/** @type {?} */ (this)).centerlineLayers.map((/**
         * @param {?} centerlineLayer
         * @return {?}
         */
        function (centerlineLayer) { return new CenterlineLayer(centerlineLayer); }));
        (/** @type {?} */ (this)).calibrationPointLayers = (/** @type {?} */ (this)).calibrationPointLayers.map((/**
         * @param {?} calibrationPointLayer
         * @return {?}
         */
        function (calibrationPointLayer) { return new CalibrationPointLayer(calibrationPointLayer); }));
        (/** @type {?} */ (this)).intersectionLayers = (/** @type {?} */ (this)).intersectionLayers.map((/**
         * @param {?} intersectionLayer
         * @return {?}
         */
        function (intersectionLayer) { return new IntersectionLayer(intersectionLayer); }));
        (/** @type {?} */ (this)).nonLRSLayers = (/** @type {?} */ (this)).nonLRSLayers.map((/**
         * @param {?} nonLrsLayer
         * @return {?}
         */
        function (nonLrsLayer) { return new NonLrsLayer(find(nonLrsLayer.id, (/** @type {?} */ (_this)).layers), nonLrsLayer); }));
        return (/** @type {?} */ (this)).assignCodedValueDomainsToFields();
    };
    /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    LrsMetadata.prototype.assignCodedValueDomainsToFields = /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        var _this = this;
        if ((/** @type {?} */ (this)).domains.length) {
            (/** @type {?} */ (this)).getFeatureClassLayers()
                .forEach((/**
             * @param {?} layer
             * @return {?}
             */
            function (layer) { return layer.applyFieldDomains((/** @type {?} */ (_this)).domains); }));
        }
        return (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} source
     * @return {THIS}
     */
    LrsMetadata.prototype.assign = /**
     * @template THIS
     * @this {THIS}
     * @param {?} source
     * @return {THIS}
     */
    function (source) {
        Object.assign((/** @type {?} */ (this)), source);
        return (/** @type {?} */ (this));
    };
    /**
     * @return {?}
     */
    LrsMetadata.prototype.clone = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var copy = clone(this);
        return new LrsMetadata()
            .assign(copy)
            .rebuildLayers();
    };
    /**
     * @return {?}
     */
    LrsMetadata.prototype.validate = /**
     * @return {?}
     */
    function () {
        return LRS_METADATA_VALIDATIONS
            .check(this);
    };
    return LrsMetadata;
}(MapServerMetadata));
export { LrsMetadata };
if (false) {
    /** @type {?} */
    LrsMetadata.prototype.dataSource;
    /** @type {?} */
    LrsMetadata.prototype.dataSourceId;
    /** @type {?} */
    LrsMetadata.prototype.name;
    /** @type {?} */
    LrsMetadata.prototype.serviceHasLrsMeta;
    /** @type {?} */
    LrsMetadata.prototype.networkLayers;
    /** @type {?} */
    LrsMetadata.prototype.eventLayers;
    /** @type {?} */
    LrsMetadata.prototype.redlineLayers;
    /** @type {?} */
    LrsMetadata.prototype.centerlineLayers;
    /** @type {?} */
    LrsMetadata.prototype.calibrationPointLayers;
    /** @type {?} */
    LrsMetadata.prototype.intersectionLayers;
    /** @type {?} */
    LrsMetadata.prototype.nonLRSLayers;
    /** @type {?} */
    LrsMetadata.prototype.lrs;
    /** @type {?} */
    LrsMetadata.prototype.domains;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHJzLW1ldGFkYXRhLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRzcy9zZGsvIiwic291cmNlcyI6WyJsaWIvbHJzL2xycy1tZXRhZGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNqRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSw4Q0FBOEMsQ0FBQztBQUNyRixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsVUFBVSxFQUFvQixNQUFNLDRCQUE0QixDQUFDO0FBSzVGLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsZ0JBQWdCLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNoRyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFdEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQ3RFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQzs7Ozs7O0FBSXJELFNBQVMsSUFBSSxDQUFDLE9BQWU7SUFBRSxtQkFBMEI7U0FBMUIsVUFBMEIsRUFBMUIscUJBQTBCLEVBQTFCLElBQTBCO1FBQTFCLGtDQUEwQjs7SUFDdkQsT0FBTyxTQUFTLGlDQUFDLE9B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QUFBLElBQUksRUFBQSxDQUFDO0lBQ2QsQ0FBQzs7OztJQUVELDJCQUFLOzs7SUFBTDs7WUFDUSxJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQztRQUN4QixPQUFPLElBQUksV0FBVyxFQUFFO2FBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUM7YUFDWixhQUFhLEVBQUUsQ0FBQztJQUNyQixDQUFDOzs7O0lBRUQsOEJBQVE7OztJQUFSO1FBQ0UsT0FBTyx3QkFBd0I7YUFDNUIsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2pCLENBQUM7SUFDSCxrQkFBQztBQUFELENBQUMsQUExT0QsQ0FBaUMsaUJBQWlCLEdBME9qRDs7OztJQXpPQyxpQ0FBdUI7O0lBQ3ZCLG1DQUFxQjs7SUFDckIsMkJBQWE7O0lBQ2Isd0NBQTJCOztJQUMzQixvQ0FBbUM7O0lBQ25DLGtDQUErQjs7SUFDL0Isb0NBQW1DOztJQUNuQyx1Q0FBeUM7O0lBQ3pDLDZDQUFxRDs7SUFDckQseUNBQTZDOztJQUM3QyxtQ0FBdUM7O0lBQ3ZDLDBCQUFvQjs7SUFDcEIsOEJBQWlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YVNvdXJjZSB9IGZyb20gJy4uL2RhdGEtc291cmNlL2RhdGEtc291cmNlJztcbmltcG9ydCB7IEZlYXR1cmVDbGFzc0xheWVyIH0gZnJvbSAnLi4vbWFwcy9mZWF0dXJlLWNsYXNzLWxheWVyJztcbmltcG9ydCB7IEludGVyc2VjdGlvbkxheWVyIH0gZnJvbSAnLi9pbnRlcnNlY3Rpb25zL2ludGVyc2VjdGlvbi1sYXllcic7XG5pbXBvcnQgeyBFdmVudExheWVyIH0gZnJvbSAnLi9ldmVudHMvZXZlbnQtbGF5ZXInO1xuaW1wb3J0IHsgTmV0d29ya0xheWVyIH0gZnJvbSAnLi9uZXR3b3Jrcy9uZXR3b3JrLWxheWVyJztcbmltcG9ydCB7IFJlZGxpbmVMYXllciB9IGZyb20gJy4vcmVkbGluZXMvcmVkbGluZS1sYXllcic7XG5pbXBvcnQgeyBDZW50ZXJsaW5lTGF5ZXIgfSBmcm9tICcuL2NlbnRlcmxpbmVzL2NlbnRlcmxpbmUtbGF5ZXInO1xuaW1wb3J0IHsgQ2FsaWJyYXRpb25Qb2ludExheWVyIH0gZnJvbSAnLi9jYWxpYnJhdGlvbi1wb2ludHMvY2FsaWJyYXRpb24tcG9pbnQtbGF5ZXInO1xuaW1wb3J0IHsgTWFwU2VydmVyTWV0YWRhdGEgfSBmcm9tICcuLi9tYXBzL21hcC1zZXJ2ZXItbWV0YWRhdGEnO1xuaW1wb3J0IHsgZ2V0R2VvbWV0cnlGaWVsZCwgZ2V0SWRGaWVsZCwgTGF5ZXJGaWVsZERvbWFpbiB9IGZyb20gJy4uL21hcHMvZmllbGRzL2xheWVyLWZpZWxkJztcbmltcG9ydCB7IE1hcExheWVyIH0gZnJvbSAnLi4vbWFwcy9tYXAtbGF5ZXInO1xuaW1wb3J0IHsgTHJzTGF5ZXIgfSBmcm9tICcuL2xycy1sYXllcic7XG5pbXBvcnQgeyBMcnNMYXllckRldGFpbCB9IGZyb20gJy4vbHJzLWxheWVyLWRldGFpbCc7XG5pbXBvcnQgeyBMcnNJbmZvIH0gZnJvbSAnLi9scnMtaW5mbyc7XG5pbXBvcnQgeyBmaW5kTGF5ZXIgfSBmcm9tICcuL2xheWVyLXNlYXJjaCc7XG5pbXBvcnQgeyBtZXJnZU1hcE1ldGFkYXRhLCBtZXJnZUxyc01ldGFkYXRhLCBkZWVwTWVyZ2VNYXBNZXRhZGF0YSB9IGZyb20gJy4vbHJzLW1ldGFkYXRhLW1lcmdlJztcbmltcG9ydCB7IExSU19NRVRBREFUQV9WQUxJREFUSU9OUyB9IGZyb20gJy4vbHJzLW1ldGFkYXRhLXZhbGlkYXRpb25zJztcbmltcG9ydCB7IE5vbkxyc0xheWVyIH0gZnJvbSAnLi9ub24tbHJzL25vbi1scnMtbGF5ZXInO1xuaW1wb3J0IHsgQ2xvbmVhYmxlIH0gZnJvbSAnLi4vY29yZS9jbG9uZS9jbG9uZWFibGUnO1xuaW1wb3J0IHsgaXNOb3RWYWx1ZSB9IGZyb20gJy4uL2NvcmUvdHlwZS1jaGVjay9pcy1ub3QtdmFsdWUuZnVuY3Rpb24nO1xuaW1wb3J0IHsgY2xvbmUgfSBmcm9tICcuLi9jb3JlL2Nsb25lL2Nsb25lLmZ1bmN0aW9uJztcbmltcG9ydCB7IFZhbGlkYXRpb25SZXN1bHQgfSBmcm9tICcuLi9jb3JlL3ZhbGlkYXRpb24vdmFsaWRhdGlvbi1yZXN1bHRzJztcblxuXG5mdW5jdGlvbiBmaW5kKGxheWVySWQ6IG51bWJlciwgLi4ubGF5ZXJMaXN0OiBNYXBMYXllcltdW10pOiBNYXBMYXllciB7XG4gIHJldHVybiBmaW5kTGF5ZXIobGF5ZXJJZCwgLi4ubGF5ZXJMaXN0KTtcbn1cblxuXG5leHBvcnQgY2xhc3MgTHJzTWV0YWRhdGEgZXh0ZW5kcyBNYXBTZXJ2ZXJNZXRhZGF0YSBpbXBsZW1lbnRzIENsb25lYWJsZTxMcnNNZXRhZGF0YT4ge1xuICBkYXRhU291cmNlOiBEYXRhU291cmNlO1xuICBkYXRhU291cmNlSWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBzZXJ2aWNlSGFzTHJzTWV0YTogYm9vbGVhbjtcbiAgbmV0d29ya0xheWVyczogTmV0d29ya0xheWVyW10gPSBbXTtcbiAgZXZlbnRMYXllcnM6IEV2ZW50TGF5ZXJbXSA9IFtdO1xuICByZWRsaW5lTGF5ZXJzOiBSZWRsaW5lTGF5ZXJbXSA9IFtdO1xuICBjZW50ZXJsaW5lTGF5ZXJzOiBDZW50ZXJsaW5lTGF5ZXJbXSA9IFtdO1xuICBjYWxpYnJhdGlvblBvaW50TGF5ZXJzOiBDYWxpYnJhdGlvblBvaW50TGF5ZXJbXSA9IFtdO1xuICBpbnRlcnNlY3Rpb25MYXllcnM6IEludGVyc2VjdGlvbkxheWVyW10gPSBbXTtcbiAgbm9uTFJTTGF5ZXJzOiBGZWF0dXJlQ2xhc3NMYXllcltdID0gW107XG4gIGxyczogTHJzSW5mb1tdID0gW107XG4gIGRvbWFpbnM6IExheWVyRmllbGREb21haW5bXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKGRhdGFTb3VyY2U/OiBEYXRhU291cmNlKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGlmIChkYXRhU291cmNlKSB7XG4gICAgICB0aGlzLmRhdGFTb3VyY2UgPSBkYXRhU291cmNlO1xuICAgICAgdGhpcy5kYXRhU291cmNlSWQgPSBkYXRhU291cmNlLmlkO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGEgbGF5ZXIgYnkgSUQgLSBzZWFyY2hpbmcgYWNyb3NzIGFsbCB0eXBlcyAoZXZlbnQgbGF5ZXJzLCBuZXR3b3JrIGxheWVycywgZXRjKS5cbiAgICovXG4gIGdldExheWVyKGxheWVySWQ6IG51bWJlcik6IE1hcExheWVyIHtcbiAgICByZXR1cm4gZmluZChsYXllcklkLCB0aGlzLmdldEFsbExheWVycygpKTtcbiAgfVxuXG4gIGdldExyc0xheWVyKGxheWVySWQ6IG51bWJlcik6IExyc0xheWVyIHtcbiAgICByZXR1cm4gKFxuICAgICAgZmluZChsYXllcklkLCB0aGlzLm5ldHdvcmtMYXllcnMsIHRoaXMuZXZlbnRMYXllcnMsIHRoaXMucmVkbGluZUxheWVycylcbiAgICApIGFzIExyc0xheWVyO1xuICB9XG5cbiAgZ2V0TGF5ZXJEZXRhaWwobGF5ZXJJZDogbnVtYmVyKTogTHJzTGF5ZXJEZXRhaWwge1xuICAgIC8vIFRPRE86IENvbWUgdXAgd2l0aCBhIGJldHRlciB3YXkgdG8gY2hlY2sgdGhlc2UgbGF5ZXIgdHlwZXMuXG4gICAgLy8gTk9URTogV2UgYXJlIGRvaW5nIGFsbCBvZiB0aGVzZSBib29sZWFuIGNoZWNrcyBpbnN0ZWFkIG9mIGp1c3Qgc2ltcGx5IGNhbGxpbmdcbiAgICAvLyBpc0V2ZW50TGF5ZXIgPSB0aGlzLmlzRXZlbnRMYXllcihsYXllcklkKSBiZWNhdXNlIG9mIHBlcmZvcm1hbmNlIHJlYXNvbnMuXG4gICAgY29uc3QgaXNMcnNMYXllciA9IHRoaXMuaXNMcnNMYXllcihsYXllcklkKTtcbiAgICBjb25zdCBpc0V2ZW50TGF5ZXIgPSB0aGlzLmlzRXZlbnRMYXllcihsYXllcklkKTtcbiAgICBjb25zdCBpc05ldHdvcmtMYXllciA9ICFpc0V2ZW50TGF5ZXIgJiYgdGhpcy5pc05ldHdvcmtMYXllcihsYXllcklkKTtcbiAgICBjb25zdCBpc0NhbGlicmF0aW9uUG9pbnRMYXllciA9ICFpc0V2ZW50TGF5ZXIgJiYgIWlzTmV0d29ya0xheWVyICYmIHRoaXMuaXNDYWxpYnJhdGlvblBvaW50TGF5ZXIobGF5ZXJJZCk7XG4gICAgY29uc3QgaXNDZW50ZXJsaW5lTGF5ZXIgPSAhaXNFdmVudExheWVyICYmICFpc05ldHdvcmtMYXllciAmJiAhaXNDYWxpYnJhdGlvblBvaW50TGF5ZXIgJiYgdGhpcy5pc0NlbnRlcmxpbmVMYXllcihsYXllcklkKTtcbiAgICBjb25zdCBpc0ludGVyc2VjdGlvbkxheWVyID0gIWlzRXZlbnRMYXllciAmJiAhaXNOZXR3b3JrTGF5ZXIgJiYgIWlzQ2FsaWJyYXRpb25Qb2ludExheWVyICYmICFpc0NlbnRlcmxpbmVMYXllclxuICAgICAgJiYgdGhpcy5pc0ludGVyc2VjdGlvbkxheWVyKGxheWVySWQpO1xuICAgIGNvbnN0IGlzUmVkbGluZUxheWVyID0gIWlzRXZlbnRMYXllciAmJiAhaXNOZXR3b3JrTGF5ZXIgJiYgIWlzQ2FsaWJyYXRpb25Qb2ludExheWVyICYmICFpc0NlbnRlcmxpbmVMYXllciAmJiAhaXNJbnRlcnNlY3Rpb25MYXllclxuICAgICAgJiYgdGhpcy5pc1JlZGxpbmVMYXllcihsYXllcklkKTtcbiAgICBjb25zdCBpc1RhYmxlID0gIWlzRXZlbnRMYXllciAmJiAhaXNOZXR3b3JrTGF5ZXIgJiYgIWlzQ2FsaWJyYXRpb25Qb2ludExheWVyICYmICFpc0NlbnRlcmxpbmVMYXllciAmJiAhaXNJbnRlcnNlY3Rpb25MYXllclxuICAgICAgJiYgIWlzUmVkbGluZUxheWVyICYmIHRoaXMuaXNUYWJsZShsYXllcklkKTtcbiAgICBjb25zdCBpc05vbkxSU0xheWVyID0gIWlzRXZlbnRMYXllciAmJiAhaXNOZXR3b3JrTGF5ZXIgJiYgIWlzQ2FsaWJyYXRpb25Qb2ludExheWVyICYmICFpc0NlbnRlcmxpbmVMYXllciAmJiAhaXNJbnRlcnNlY3Rpb25MYXllclxuICAgICAgJiYgIWlzUmVkbGluZUxheWVyICYmICFpc1RhYmxlICYmIHRoaXMuaXNOb25MUlNMYXllcihsYXllcklkKTtcbiAgICBjb25zdCBsYXllcjogTWFwTGF5ZXIgPSB0aGlzLmdldExheWVyKGxheWVySWQpO1xuICAgIGNvbnN0IHNoYXBlRmllbGQgPSBsYXllciA/IGdldEdlb21ldHJ5RmllbGQobGF5ZXIuZmllbGRzKSA6IG51bGw7XG4gICAgY29uc3QgaWRGaWVsZCA9IGxheWVyID8gZ2V0SWRGaWVsZChsYXllci5maWVsZHMpIDogbnVsbDtcblxuICAgIHJldHVybiB7XG4gICAgICBsYXllcixcbiAgICAgIGxheWVySWQsXG4gICAgICBpc0V2ZW50TGF5ZXIsXG4gICAgICBpc05ldHdvcmtMYXllcixcbiAgICAgIGlzQ2FsaWJyYXRpb25Qb2ludExheWVyLFxuICAgICAgaXNDZW50ZXJsaW5lTGF5ZXIsXG4gICAgICBpc0ludGVyc2VjdGlvbkxheWVyLFxuICAgICAgaXNSZWRsaW5lTGF5ZXIsXG4gICAgICBpc1RhYmxlLFxuICAgICAgaXNOb25MUlNMYXllcixcbiAgICAgIGlzTHJzTGF5ZXIsXG4gICAgICBzaGFwZUZpZWxkLFxuICAgICAgaWRGaWVsZCxcbiAgICB9O1xuICB9XG5cbiAgaXNMcnNMYXllcihsYXllcklkOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbihcbiAgICAgIHRoaXMuZ2V0THJzTGF5ZXIobGF5ZXJJZClcbiAgICApO1xuICB9XG5cbiAgaXNOZXR3b3JrTGF5ZXIobGF5ZXJJZDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEJvb2xlYW4oZmluZChsYXllcklkLCB0aGlzLm5ldHdvcmtMYXllcnMpKTtcbiAgfVxuXG4gIGlzRXZlbnRMYXllcihsYXllcklkOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbihmaW5kKGxheWVySWQsIHRoaXMuZXZlbnRMYXllcnMpKTtcbiAgfVxuXG4gIGlzSW50ZXJzZWN0aW9uTGF5ZXIobGF5ZXJJZDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEJvb2xlYW4oZmluZChsYXllcklkLCB0aGlzLmludGVyc2VjdGlvbkxheWVycykpO1xuICB9XG5cbiAgaXNSZWRsaW5lTGF5ZXIobGF5ZXJJZDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEJvb2xlYW4oZmluZChsYXllcklkLCB0aGlzLnJlZGxpbmVMYXllcnMpKTtcbiAgfVxuXG4gIGlzQ2VudGVybGluZUxheWVyKGxheWVySWQ6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBCb29sZWFuKGZpbmQobGF5ZXJJZCwgdGhpcy5jZW50ZXJsaW5lTGF5ZXJzKSk7XG4gIH1cblxuICBpc0NhbGlicmF0aW9uUG9pbnRMYXllcihsYXllcklkOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbihmaW5kKGxheWVySWQsIHRoaXMuY2FsaWJyYXRpb25Qb2ludExheWVycykpO1xuICB9XG5cbiAgaXNOb25MUlNMYXllcihsYXllcklkOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbihmaW5kKGxheWVySWQsIHRoaXMubm9uTFJTTGF5ZXJzKSk7XG4gIH1cblxuICBpc1RhYmxlKGxheWVySWQ6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBCb29sZWFuKGZpbmQobGF5ZXJJZCwgdGhpcy50YWJsZXMpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNZXJnZXMgbWFwIHNlcnZlciBnZW5lcmFsIGluZm9ybWF0aW9uIGludG8gdGhpcyBMUlMgbWV0YWRhdGEgaW5zdGFuY2UuXG4gICAqL1xuICBtZXJnZU1hcE1ldGFkYXRhKG1hcE1ldGFkYXRhOiBNYXBTZXJ2ZXJNZXRhZGF0YSk6IExyc01ldGFkYXRhIHtcbiAgICBtZXJnZU1hcE1ldGFkYXRhKHRoaXMsIG1hcE1ldGFkYXRhKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGRlZXBNZXJnZU1hcE1ldGFkYXRhKG1hcE1ldGFkYXRhOiBNYXBTZXJ2ZXJNZXRhZGF0YSk6IExyc01ldGFkYXRhIHtcbiAgICBkZWVwTWVyZ2VNYXBNZXRhZGF0YSh0aGlzLCBtYXBNZXRhZGF0YSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogTWVyZ2VzIG90aGVyIExSUyBtZXRhZGF0YSBpbnRvIHRoaXMgTFJTIG1ldGRhdGEgaW5zdGFuY2UuXG4gICAqL1xuICBtZXJnZUxyc01ldGFkYXRhKGxyc01ldGFkYXRhOiBMcnNNZXRhZGF0YSk6IExyc01ldGFkYXRhIHtcbiAgICBtZXJnZUxyc01ldGFkYXRhKHRoaXMsIGxyc01ldGFkYXRhKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGdldE5ldHdvcmtMYXllcihsYXllcklkOiBudW1iZXIpOiBOZXR3b3JrTGF5ZXIge1xuICAgIHJldHVybiBmaW5kKGxheWVySWQsIHRoaXMubmV0d29ya0xheWVycykgYXMgTmV0d29ya0xheWVyO1xuICB9XG5cbiAgZ2V0RXZlbnRMYXllcihsYXllcklkOiBudW1iZXIpOiBFdmVudExheWVyIHtcbiAgICByZXR1cm4gZmluZChsYXllcklkLCB0aGlzLmV2ZW50TGF5ZXJzKSBhcyBFdmVudExheWVyO1xuICB9XG5cbiAgZ2V0SW50ZXJzZWN0aW9uTGF5ZXIobGF5ZXJJZDogbnVtYmVyKTogSW50ZXJzZWN0aW9uTGF5ZXIge1xuICAgIHJldHVybiBmaW5kKGxheWVySWQsIHRoaXMuaW50ZXJzZWN0aW9uTGF5ZXJzKSBhcyBJbnRlcnNlY3Rpb25MYXllcjtcbiAgfVxuXG4gIGdldExyc0xheWVycygpOiBMcnNMYXllcltdIHtcbiAgICByZXR1cm4gKHRoaXMuZXZlbnRMYXllcnMgYXMgTHJzTGF5ZXJbXSlcbiAgICAgIC5jb25jYXQodGhpcy5uZXR3b3JrTGF5ZXJzKVxuICAgICAgLmNvbmNhdCh0aGlzLnJlZGxpbmVMYXllcnMpO1xuICB9XG5cbiAgZ2V0RmVhdHVyZUNsYXNzTGF5ZXJzKCk6IEZlYXR1cmVDbGFzc0xheWVyW10ge1xuICAgIHJldHVybiAodGhpcy5ldmVudExheWVycyBhcyBGZWF0dXJlQ2xhc3NMYXllcltdKVxuICAgICAgLmNvbmNhdCh0aGlzLm5ldHdvcmtMYXllcnMpXG4gICAgICAuY29uY2F0KHRoaXMucmVkbGluZUxheWVycylcbiAgICAgIC5jb25jYXQodGhpcy5jYWxpYnJhdGlvblBvaW50TGF5ZXJzKVxuICAgICAgLmNvbmNhdCh0aGlzLmNlbnRlcmxpbmVMYXllcnMpXG4gICAgICAuY29uY2F0KHRoaXMubm9uTFJTTGF5ZXJzKTtcbiAgfVxuXG4gIGdldEFsbExheWVycygpOiBNYXBMYXllcltdIHtcbiAgICByZXR1cm4gKHRoaXMuZ2V0RmVhdHVyZUNsYXNzTGF5ZXJzKCkgYXMgTWFwTGF5ZXJbXSlcbiAgICAgIC5jb25jYXQodGhpcy50YWJsZXMpXG4gICAgICAuY29uY2F0KHRoaXMubGF5ZXJzKTtcbiAgfVxuXG4gIGdldE5ldHdvcmtJZEZvckxheWVyKGxheWVyOiBMcnNMYXllcik6IG51bWJlciB8IG51bGwge1xuICAgIGxldCBuZXR3b3JrSWQ6IG51bWJlciA9IG51bGw7XG4gICAgaWYgKHRoaXMuaXNFdmVudExheWVyKGxheWVyLmlkKSkge1xuICAgICAgY29uc3QgZXZlbnRMYXllciA9IGxheWVyIGFzIEV2ZW50TGF5ZXI7XG4gICAgICBuZXR3b3JrSWQgPSBldmVudExheWVyLnBhcmVudE5ldHdvcmsgPyBldmVudExheWVyLnBhcmVudE5ldHdvcmsuaWQgOiBudWxsO1xuICAgIH1cblxuICAgIGlmIChpc05vdFZhbHVlKG5ldHdvcmtJZCkpIHtcbiAgICAgIHRoaXMubmV0d29ya0xheWVycy5mb3JFYWNoKG5ldHdvcmsgPT4ge1xuICAgICAgICBpZiAobmV0d29yay5ldmVudExheWVycy5maW5kKGwgPT4gbC5pZCA9PT0gbGF5ZXIuaWQpKSB7XG4gICAgICAgICAgbmV0d29ya0lkID0gbmV0d29yay5pZDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldHdvcmtJZDtcbiAgfVxuXG4gIGdldEV2ZW50TGF5ZXJzQnlOZXR3b3JrKG5ldHdvcmtMYXllcklkOiBudW1iZXIpOiBFdmVudExheWVyW10ge1xuICAgIGNvbnN0IG5ldHdvcmtMYXllciA9IHRoaXMuZ2V0TmV0d29ya0xheWVyKG5ldHdvcmtMYXllcklkKTtcbiAgICByZXR1cm4gdGhpcy5ldmVudExheWVycy5maWx0ZXIobGF5ZXIgPT5cbiAgICAgIGxheWVyLnBhcmVudE5ldHdvcmtcbiAgICAgICYmIGxheWVyLnBhcmVudE5ldHdvcmsuaWQgPT09IG5ldHdvcmtMYXllcklkXG4gICAgICB8fCBuZXR3b3JrTGF5ZXIuZXZlbnRMYXllcnNcbiAgICAgICYmIG5ldHdvcmtMYXllci5ldmVudExheWVycy5maW5kKGwgPT4gbC5pZCA9PT0gbGF5ZXIuaWQpXG4gICAgKTtcbiAgfVxuXG4gIHJlYnVpbGRMYXllcnMoKTogdGhpcyB7XG4gICAgdGhpcy5ldmVudExheWVycyA9IHRoaXMuZXZlbnRMYXllcnMubWFwKGV2ZW50TGF5ZXIgPT4gbmV3IEV2ZW50TGF5ZXIoZmluZChldmVudExheWVyLmlkLCB0aGlzLmxheWVycyksIGV2ZW50TGF5ZXIpKTtcbiAgICB0aGlzLm5ldHdvcmtMYXllcnMgPSB0aGlzLm5ldHdvcmtMYXllcnMubWFwKG5ldHdvcmtMYXllciA9PiBuZXcgTmV0d29ya0xheWVyKGZpbmQobmV0d29ya0xheWVyLmlkLCB0aGlzLmxheWVycyksIG5ldHdvcmtMYXllcikpO1xuICAgIHRoaXMucmVkbGluZUxheWVycyA9IHRoaXMucmVkbGluZUxheWVycy5tYXAocmVkbGluZUxheWVyID0+IG5ldyBSZWRsaW5lTGF5ZXIoZmluZChyZWRsaW5lTGF5ZXIuaWQsIHRoaXMubGF5ZXJzKSwgcmVkbGluZUxheWVyKSk7XG4gICAgdGhpcy5jZW50ZXJsaW5lTGF5ZXJzID0gdGhpcy5jZW50ZXJsaW5lTGF5ZXJzLm1hcChjZW50ZXJsaW5lTGF5ZXIgPT4gbmV3IENlbnRlcmxpbmVMYXllcihjZW50ZXJsaW5lTGF5ZXIpKTtcbiAgICB0aGlzLmNhbGlicmF0aW9uUG9pbnRMYXllcnMgPSB0aGlzLmNhbGlicmF0aW9uUG9pbnRMYXllcnMubWFwKFxuICAgICAgY2FsaWJyYXRpb25Qb2ludExheWVyID0+IG5ldyBDYWxpYnJhdGlvblBvaW50TGF5ZXIoY2FsaWJyYXRpb25Qb2ludExheWVyKVxuICAgICk7XG4gICAgdGhpcy5pbnRlcnNlY3Rpb25MYXllcnMgPSB0aGlzLmludGVyc2VjdGlvbkxheWVycy5tYXAoaW50ZXJzZWN0aW9uTGF5ZXIgPT4gbmV3IEludGVyc2VjdGlvbkxheWVyKGludGVyc2VjdGlvbkxheWVyKSk7XG4gICAgdGhpcy5ub25MUlNMYXllcnMgPSB0aGlzLm5vbkxSU0xheWVycy5tYXAobm9uTHJzTGF5ZXIgPT4gbmV3IE5vbkxyc0xheWVyKGZpbmQobm9uTHJzTGF5ZXIuaWQsIHRoaXMubGF5ZXJzKSwgbm9uTHJzTGF5ZXIpKTtcblxuICAgIHJldHVybiB0aGlzLmFzc2lnbkNvZGVkVmFsdWVEb21haW5zVG9GaWVsZHMoKTtcbiAgfVxuXG4gIGFzc2lnbkNvZGVkVmFsdWVEb21haW5zVG9GaWVsZHMoKTogdGhpcyB7XG4gICAgaWYgKHRoaXMuZG9tYWlucy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuZ2V0RmVhdHVyZUNsYXNzTGF5ZXJzKClcbiAgICAgICAgLmZvckVhY2gobGF5ZXIgPT4gbGF5ZXIuYXBwbHlGaWVsZERvbWFpbnModGhpcy5kb21haW5zKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhc3NpZ24oc291cmNlOiBhbnkpOiB0aGlzIHtcbiAgICBPYmplY3QuYXNzaWduKHRoaXMsIHNvdXJjZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjbG9uZSgpOiBMcnNNZXRhZGF0YSB7XG4gICAgY29uc3QgY29weSA9IGNsb25lKHRoaXMpO1xuICAgIHJldHVybiBuZXcgTHJzTWV0YWRhdGEoKVxuICAgICAgLmFzc2lnbihjb3B5KVxuICAgICAgLnJlYnVpbGRMYXllcnMoKTtcbiAgfVxuXG4gIHZhbGlkYXRlKCk6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIHJldHVybiBMUlNfTUVUQURBVEFfVkFMSURBVElPTlNcbiAgICAgIC5jaGVjayh0aGlzKTtcbiAgfVxufVxuIl19