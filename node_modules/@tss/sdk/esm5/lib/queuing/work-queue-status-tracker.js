/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { average } from '../core/stats/average.function';
var WorkQueueStatusTracker = /** @class */ (function () {
    function WorkQueueStatusTracker() {
        this.totalQueueSize = 0;
        this.workers = [];
    }
    Object.defineProperty(WorkQueueStatusTracker.prototype, "workerCount", {
        get: /**
         * @return {?}
         */
        function () {
            return this.workers.length;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "percentComplete", {
        get: /**
         * @return {?}
         */
        function () {
            return this.totalQueueSize >= 0
                ? Math.round(this.totalProcessed / this.totalQueueSize * 100) || 0
                : 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "totalComplete", {
        get: /**
         * @return {?}
         */
        function () {
            return this.workers.reduce((/**
             * @param {?} accumulator
             * @param {?} current
             * @return {?}
             */
            function (accumulator, current) { return accumulator + current.totalComplete; }), 0) || 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "totalFailed", {
        get: /**
         * @return {?}
         */
        function () {
            return this.workers.reduce((/**
             * @param {?} accumulator
             * @param {?} current
             * @return {?}
             */
            function (accumulator, current) { return accumulator + current.totalFailed; }), 0) || 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "totalProcessed", {
        get: /**
         * @return {?}
         */
        function () {
            return this.totalComplete + this.totalFailed;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "isWorking", {
        get: /**
         * @return {?}
         */
        function () {
            return Boolean(this.runningWorkerCount);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "isComplete", {
        get: /**
         * @return {?}
         */
        function () {
            return this.startTime && !this.isWorking;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "isCanceled", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var canceledWorkersCount = this.workers.filter((/**
             * @param {?} worker
             * @return {?}
             */
            function (worker) { return worker.isCanceled; })).length;
            return Boolean(canceledWorkersCount && canceledWorkersCount === this.workers.length);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "runningWorkerCount", {
        get: /**
         * @return {?}
         */
        function () {
            return this.workers.filter((/**
             * @param {?} worker
             * @return {?}
             */
            function (worker) { return worker.isWorking; })).length;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "startTime", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var startTimes = this.workers
                .filter((/**
             * @param {?} worker
             * @return {?}
             */
            function (worker) { return worker.startTime; }))
                .map((/**
             * @param {?} worker
             * @return {?}
             */
            function (worker) { return worker.startTime
                ? worker.startTime.getTime()
                : null; }));
            return new Date(Math.min.apply(Math, tslib_1.__spread(startTimes)));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "endTime", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var startTimes = this.workers
                .filter((/**
             * @param {?} worker
             * @return {?}
             */
            function (worker) { return worker.startTime; }))
                .map((/**
             * @param {?} worker
             * @return {?}
             */
            function (worker) { return worker.startTime
                ? worker.startTime.getTime()
                : null; }));
            return new Date(Math.max.apply(Math, tslib_1.__spread(startTimes)));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "remainingQueueSize", {
        get: /**
         * @return {?}
         */
        function () {
            return this.totalQueueSize - this.totalProcessed;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "estimatedSecondsLeft", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var remainingCount = this.remainingQueueSize;
            return remainingCount
                ? average(this.workers
                    .map((/**
                 * @param {?} worker
                 * @return {?}
                 */
                function (worker) { return worker.calculateRemainingSeconds(remainingCount); })))
                : 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkQueueStatusTracker.prototype, "averageRecordsProcessedPerMinute", {
        get: /**
         * @return {?}
         */
        function () {
            return average(this.workers
                .map((/**
             * @param {?} worker
             * @return {?}
             */
            function (worker) { return worker.recordsProcessedPerMinute; })));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} totalQueueSize
     * @return {?}
     */
    WorkQueueStatusTracker.prototype.setQueueSize = /**
     * @param {?} totalQueueSize
     * @return {?}
     */
    function (totalQueueSize) {
        this.totalQueueSize = totalQueueSize;
        return this;
    };
    /**
     * @return {?}
     */
    WorkQueueStatusTracker.prototype.complete = /**
     * @return {?}
     */
    function () {
        this.workers.splice(0, this.workers.length);
        this.totalQueueSize = 0;
        return this;
    };
    /**
     * @param {...?} workers
     * @return {?}
     */
    WorkQueueStatusTracker.prototype.addWorker = /**
     * @param {...?} workers
     * @return {?}
     */
    function () {
        var _this = this;
        var workers = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            workers[_i] = arguments[_i];
        }
        workers.forEach((/**
         * @param {?} worker
         * @return {?}
         */
        function (worker) {
            _this.workers.push(worker);
        }));
        return this;
    };
    /**
     * @return {?}
     */
    WorkQueueStatusTracker.prototype.getStatus = /**
     * @return {?}
     */
    function () {
        return {
            isWorking: this.isWorking,
            isCanceled: this.isCanceled,
            isComplete: this.isComplete,
            totalProcessed: this.totalProcessed,
            startTime: this.startTime,
            endTime: this.endTime,
            percentComplete: this.percentComplete,
            totalQueueSize: this.totalQueueSize,
            remainingQueueSize: this.remainingQueueSize,
            totalComplete: this.totalComplete,
            totalFailed: this.totalFailed,
            estimatedSecondsLeft: this.estimatedSecondsLeft,
            workerCount: this.workers.length,
        };
    };
    return WorkQueueStatusTracker;
}());
export { WorkQueueStatusTracker };
if (false) {
    /** @type {?} */
    WorkQueueStatusTracker.prototype.totalQueueSize;
    /**
     * @type {?}
     * @protected
     */
    WorkQueueStatusTracker.prototype.workers;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29yay1xdWV1ZS1zdGF0dXMtdHJhY2tlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0c3Mvc2RrLyIsInNvdXJjZXMiOlsibGliL3F1ZXVpbmcvd29yay1xdWV1ZS1zdGF0dXMtdHJhY2tlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUd6RDtJQUFBO1FBQ0UsbUJBQWMsR0FBRyxDQUFDLENBQUM7UUFFQSxZQUFPLEdBQXVCLEVBQUUsQ0FBQztJQXdIdEQsQ0FBQztJQXRIQyxzQkFBSSwrQ0FBVzs7OztRQUFmO1lBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztRQUM3QixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLG1EQUFlOzs7O1FBQW5CO1lBQ0UsT0FBTyxJQUFJLENBQUMsY0FBYyxJQUFJLENBQUM7Z0JBQzdCLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLGNBQWMsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNsRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ1IsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSxpREFBYTs7OztRQUFqQjtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNOzs7OztZQUFDLFVBQUMsV0FBVyxFQUFFLE9BQU8sSUFBSyxPQUFBLFdBQVcsR0FBRyxPQUFPLENBQUMsYUFBYSxFQUFuQyxDQUFtQyxHQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwRyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLCtDQUFXOzs7O1FBQWY7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTTs7Ozs7WUFBQyxVQUFDLFdBQVcsRUFBRSxPQUFPLElBQUssT0FBQSxXQUFXLEdBQUcsT0FBTyxDQUFDLFdBQVcsRUFBakMsQ0FBaUMsR0FBRSxDQUFDLENB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QUFjLEVBQUUsSUFBSSxDQUFDLGNBQWM7WUFDbkMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLGtCQUFrQjtZQUMzQyxhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7WUFDakMsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXO1lBQzdCLG9CQUFvQixFQUFFLElBQUksQ0FBQyxvQkFBb0I7WUFDL0MsV0FBVyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTTtTQUNqQyxDQUFDO0lBQ0osQ0FBQztJQUNILDZCQUFDO0FBQUQsQ0FBQyxBQTNIRCxJQTJIQzs7OztJQTFIQyxnREFBbUI7Ozs7O0lBRW5CLHlDQUFvRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFF1ZXVlV29ya2VyVG9rZW4gfSBmcm9tICcuL3F1ZXVlLXdvcmtlci10b2tlbic7XG5pbXBvcnQgeyBXb3JrUXVldWVTdGF0dXMgfSBmcm9tICcuL3dvcmstcXVldWUtc3RhdHVzJztcbmltcG9ydCB7IGF2ZXJhZ2UgfSBmcm9tICcuLi9jb3JlL3N0YXRzL2F2ZXJhZ2UuZnVuY3Rpb24nO1xuXG5cbmV4cG9ydCBjbGFzcyBXb3JrUXVldWVTdGF0dXNUcmFja2VyIGltcGxlbWVudHMgV29ya1F1ZXVlU3RhdHVzIHtcbiAgdG90YWxRdWV1ZVNpemUgPSAwO1xuXG4gIHByb3RlY3RlZCByZWFkb25seSB3b3JrZXJzOiBRdWV1ZVdvcmtlclRva2VuW10gPSBbXTtcblxuICBnZXQgd29ya2VyQ291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy53b3JrZXJzLmxlbmd0aDtcbiAgfVxuXG4gIGdldCBwZXJjZW50Q29tcGxldGUoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy50b3RhbFF1ZXVlU2l6ZSA+PSAwXG4gICAgICA/IE1hdGgucm91bmQodGhpcy50b3RhbFByb2Nlc3NlZCAvIHRoaXMudG90YWxRdWV1ZVNpemUgKiAxMDApIHx8IDBcbiAgICAgIDogMDtcbiAgfVxuXG4gIGdldCB0b3RhbENvbXBsZXRlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMud29ya2Vycy5yZWR1Y2UoKGFjY3VtdWxhdG9yLCBjdXJyZW50KSA9PiBhY2N1bXVsYXRvciArIGN1cnJlbnQudG90YWxDb21wbGV0ZSwgMCkgfHwgMDtcbiAgfVxuXG4gIGdldCB0b3RhbEZhaWxlZCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLndvcmtlcnMucmVkdWNlKChhY2N1bXVsYXRvciwgY3VycmVudCkgPT4gYWNjdW11bGF0b3IgKyBjdXJyZW50LnRvdGFsRmFpbGVkLCAwKSB8fCAwO1xuICB9XG5cbiAgZ2V0IHRvdGFsUHJvY2Vzc2VkKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMudG90YWxDb21wbGV0ZSArIHRoaXMudG90YWxGYWlsZWQ7XG4gIH1cblxuICBnZXQgaXNXb3JraW5nKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMucnVubmluZ1dvcmtlckNvdW50KTtcbiAgfVxuXG4gIGdldCBpc0NvbXBsZXRlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnN0YXJ0VGltZSAmJiAhdGhpcy5pc1dvcmtpbmc7XG4gIH1cblxuICBnZXQgaXNDYW5jZWxlZCgpOiBib29sZWFuIHtcbiAgICBjb25zdCBjYW5jZWxlZFdvcmtlcnNDb3VudCA9IHRoaXMud29ya2Vycy5maWx0ZXIod29ya2VyID0+IHdvcmtlci5pc0NhbmNlbGVkKS5sZW5ndGg7XG4gICAgcmV0dXJuIEJvb2xlYW4oY2FuY2VsZWRXb3JrZXJzQ291bnQgJiYgY2FuY2VsZWRXb3JrZXJzQ291bnQgPT09IHRoaXMud29ya2Vycy5sZW5ndGgpO1xuICB9XG5cbiAgZ2V0IHJ1bm5pbmdXb3JrZXJDb3VudCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLndvcmtlcnMuZmlsdGVyKHdvcmtlciA9PiB3b3JrZXIuaXNXb3JraW5nKS5sZW5ndGg7XG4gIH1cblxuICBnZXQgc3RhcnRUaW1lKCk6IERhdGUge1xuICAgIGNvbnN0IHN0YXJ0VGltZXM6IG51bWJlcltdID0gdGhpcy53b3JrZXJzXG4gICAgICAuZmlsdGVyKHdvcmtlciA9PiB3b3JrZXIuc3RhcnRUaW1lKVxuICAgICAgLm1hcCh3b3JrZXIgPT4gd29ya2VyLnN0YXJ0VGltZVxuICAgICAgICA/IHdvcmtlci5zdGFydFRpbWUuZ2V0VGltZSgpXG4gICAgICAgIDogbnVsbFxuICAgICAgKTtcblxuICAgIHJldHVybiBuZXcgRGF0ZShNYXRoLm1pbiguLi5zdGFydFRpbWVzKSk7XG4gIH1cblxuICBnZXQgZW5kVGltZSgpOiBEYXRlIHtcbiAgICBjb25zdCBzdGFydFRpbWVzOiBudW1iZXJbXSA9IHRoaXMud29ya2Vyc1xuICAgICAgLmZpbHRlcih3b3JrZXIgPT4gd29ya2VyLnN0YXJ0VGltZSlcbiAgICAgIC5tYXAod29ya2VyID0+IHdvcmtlci5zdGFydFRpbWVcbiAgICAgICAgPyB3b3JrZXIuc3RhcnRUaW1lLmdldFRpbWUoKVxuICAgICAgICA6IG51bGxcbiAgICAgICk7XG5cbiAgICByZXR1cm4gbmV3IERhdGUoTWF0aC5tYXgoLi4uc3RhcnRUaW1lcykpO1xuICB9XG5cbiAgZ2V0IHJlbWFpbmluZ1F1ZXVlU2l6ZSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnRvdGFsUXVldWVTaXplIC0gdGhpcy50b3RhbFByb2Nlc3NlZDtcbiAgfVxuXG4gIGdldCBlc3RpbWF0ZWRTZWNvbmRzTGVmdCgpOiBudW1iZXIge1xuICAgIGNvbnN0IHJlbWFpbmluZ0NvdW50ID0gdGhpcy5yZW1haW5pbmdRdWV1ZVNpemU7XG4gICAgcmV0dXJuIHJlbWFpbmluZ0NvdW50XG4gICAgICA/IGF2ZXJhZ2UoXG4gICAgICAgIHRoaXMud29ya2Vyc1xuICAgICAgICAgIC5tYXAod29ya2VyID0+IHdvcmtlci5jYWxjdWxhdGVSZW1haW5pbmdTZWNvbmRzKHJlbWFpbmluZ0NvdW50KSlcbiAgICAgIClcbiAgICAgIDogMDtcbiAgfVxuXG4gIGdldCBhdmVyYWdlUmVjb3Jkc1Byb2Nlc3NlZFBlck1pbnV0ZSgpOiBudW1iZXIge1xuICAgIHJldHVybiBhdmVyYWdlKFxuICAgICAgdGhpcy53b3JrZXJzXG4gICAgICAgIC5tYXAod29ya2VyID0+IHdvcmtlci5yZWNvcmRzUHJvY2Vzc2VkUGVyTWludXRlKVxuICAgICk7XG4gIH1cblxuICBzZXRRdWV1ZVNpemUodG90YWxRdWV1ZVNpemU6IG51bWJlcik6IFdvcmtRdWV1ZVN0YXR1c1RyYWNrZXIge1xuICAgIHRoaXMudG90YWxRdWV1ZVNpemUgPSB0b3RhbFF1ZXVlU2l6ZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNvbXBsZXRlKCk6IFdvcmtRdWV1ZVN0YXR1c1RyYWNrZXIge1xuICAgIHRoaXMud29ya2Vycy5zcGxpY2UoMCwgdGhpcy53b3JrZXJzLmxlbmd0aCk7XG4gICAgdGhpcy50b3RhbFF1ZXVlU2l6ZSA9IDA7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhZGRXb3JrZXIoLi4ud29ya2VyczogUXVldWVXb3JrZXJUb2tlbltdKTogV29ya1F1ZXVlU3RhdHVzVHJhY2tlciB7XG4gICAgd29ya2Vycy5mb3JFYWNoKHdvcmtlciA9PiB7XG4gICAgICB0aGlzLndvcmtlcnMucHVzaCh3b3JrZXIpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBnZXRTdGF0dXMoKTogV29ya1F1ZXVlU3RhdHVzIHtcbiAgICByZXR1cm4ge1xuICAgICAgaXNXb3JraW5nOiB0aGlzLmlzV29ya2luZyxcbiAgICAgIGlzQ2FuY2VsZWQ6IHRoaXMuaXNDYW5jZWxlZCxcbiAgICAgIGlzQ29tcGxldGU6IHRoaXMuaXNDb21wbGV0ZSxcbiAgICAgIHRvdGFsUHJvY2Vzc2VkOiB0aGlzLnRvdGFsUHJvY2Vzc2VkLFxuICAgICAgc3RhcnRUaW1lOiB0aGlzLnN0YXJ0VGltZSxcbiAgICAgIGVuZFRpbWU6IHRoaXMuZW5kVGltZSxcbiAgICAgIHBlcmNlbnRDb21wbGV0ZTogdGhpcy5wZXJjZW50Q29tcGxldGUsXG4gICAgICB0b3RhbFF1ZXVlU2l6ZTogdGhpcy50b3RhbFF1ZXVlU2l6ZSxcbiAgICAgIHJlbWFpbmluZ1F1ZXVlU2l6ZTogdGhpcy5yZW1haW5pbmdRdWV1ZVNpemUsXG4gICAgICB0b3RhbENvbXBsZXRlOiB0aGlzLnRvdGFsQ29tcGxldGUsXG4gICAgICB0b3RhbEZhaWxlZDogdGhpcy50b3RhbEZhaWxlZCxcbiAgICAgIGVzdGltYXRlZFNlY29uZHNMZWZ0OiB0aGlzLmVzdGltYXRlZFNlY29uZHNMZWZ0LFxuICAgICAgd29ya2VyQ291bnQ6IHRoaXMud29ya2Vycy5sZW5ndGgsXG4gICAgfTtcbiAgfVxufVxuIl19