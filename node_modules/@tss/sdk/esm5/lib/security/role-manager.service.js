/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { SecurityConfig } from './security-config';
import { isString } from '../core/type-check/is-string.function';
import { isArray } from '../core/type-check/is-array.function';
import { isValue } from '../core/type-check/is-value.function';
import { isNumber } from '../core/type-check/is-number.function';
import * as i0 from "@angular/core";
import * as i1 from "./security-config";
var RoleManagerService = /** @class */ (function () {
    function RoleManagerService(config) {
        this.config = config;
        this.roles = new Set();
        this.roleSplitterExpr = new RegExp(this.config.roleSplitterExp);
    }
    Object.defineProperty(RoleManagerService.prototype, "enabled", {
        get: /**
         * @return {?}
         */
        function () {
            return this.config.rolesEnabled;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RoleManagerService.prototype, "roleCount", {
        get: /**
         * @return {?}
         */
        function () {
            return this.roles.size;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    RoleManagerService.prototype.getRoles = /**
     * @return {?}
     */
    function () {
        return Array.from(this.roles);
    };
    /**
     * @param {?} roles
     * @return {?}
     */
    RoleManagerService.prototype.setRoles = /**
     * @param {?} roles
     * @return {?}
     */
    function (roles) {
        this.clearRoles();
        this.addRoles(roles);
    };
    /**
     * @param {?} roles
     * @return {?}
     */
    RoleManagerService.prototype.addRoles = /**
     * @param {?} roles
     * @return {?}
     */
    function (roles) {
        if (isString(roles) && ((/** @type {?} */ (roles))).includes(',')) {
            roles = this.toArray(((/** @type {?} */ (roles))));
        }
        if (isArray(roles)) {
            ((/** @type {?} */ (roles))).forEach(this.addRole, this);
        }
        else {
            this.addRole((/** @type {?} */ (roles)));
        }
    };
    /**
     * @param {?} role
     * @return {?}
     */
    RoleManagerService.prototype.addRole = /**
     * @param {?} role
     * @return {?}
     */
    function (role) {
        this.roles.add(String(role).trim());
    };
    /**
     * @return {?}
     */
    RoleManagerService.prototype.clearRoles = /**
     * @return {?}
     */
    function () {
        this.roles.clear();
    };
    /**
     * @param {?} role
     * @return {?}
     */
    RoleManagerService.prototype.hasRole = /**
     * @param {?} role
     * @return {?}
     */
    function (role) {
        if (!this.enabled) {
            return true;
        }
        if (!isValue(role)) {
            return false;
        }
        return this.hasRoles(String(role));
    };
    /**
     * @param {?} roles
     * @return {?}
     */
    RoleManagerService.prototype.hasRoles = /**
     * @param {?} roles
     * @return {?}
     */
    function (roles) {
        /** @type {?} */
        var splitRoles;
        if (!this.enabled) {
            return true;
        }
        if (!isValue(roles)) {
            return false;
        }
        splitRoles = this.toArray(roles);
        return String(roles).includes(',')
            ? this.hasAllRoles(splitRoles)
            : this.hasAnyRoles(splitRoles);
    };
    /**
     * @param {?} roles
     * @return {?}
     */
    RoleManagerService.prototype.hasAllRoles = /**
     * @param {?} roles
     * @return {?}
     */
    function (roles) {
        if (!this.enabled) {
            return true;
        }
        if (!isValue(roles)) {
            return false;
        }
        /** @type {?} */
        var roleList = this.toStringArray(roles);
        return roleList.every(this.forRealHasRole.bind(this));
    };
    /**
     * @param {?} roles
     * @return {?}
     */
    RoleManagerService.prototype.hasAnyRoles = /**
     * @param {?} roles
     * @return {?}
     */
    function (roles) {
        if (!this.enabled) {
            return true;
        }
        if (!isValue(roles)) {
            return false;
        }
        /** @type {?} */
        var roleList = this.toStringArray(roles);
        return roleList.some(this.forRealHasRole.bind(this));
    };
    /**
     * @private
     * @param {?} role
     * @return {?}
     */
    RoleManagerService.prototype.forRealHasRole = /**
     * @private
     * @param {?} role
     * @return {?}
     */
    function (role) {
        return this.roles.has(String(role).trim());
    };
    /**
     * @private
     * @param {?} roles
     * @return {?}
     */
    RoleManagerService.prototype.toStringArray = /**
     * @private
     * @param {?} roles
     * @return {?}
     */
    function (roles) {
        /** @type {?} */
        var rolesList = [];
        if (isString(roles)) {
            rolesList = this.toArray((/** @type {?} */ (roles)));
        }
        else if (isNumber(roles)) {
            rolesList.push(String(roles));
        }
        else {
            rolesList = (/** @type {?} */ (roles));
        }
        return rolesList;
    };
    /**
     * @private
     * @param {?} roles
     * @return {?}
     */
    RoleManagerService.prototype.toArray = /**
     * @private
     * @param {?} roles
     * @return {?}
     */
    function (roles) {
        return String(roles).split(this.roleSplitterExpr);
    };
    RoleManagerService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    RoleManagerService.ctorParameters = function () { return [
        { type: SecurityConfig }
    ]; };
    /** @nocollapse */ RoleManagerService.ngInjectableDef = i0.defineInjectable({ factory: function RoleManagerService_Factory() { return new RoleManagerService(i0.inject(i1.SecurityConfig)); }, token: RoleManagerService, providedIn: "root" });
    return RoleManagerService;
}());
export { RoleManagerService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    RoleManagerService.prototype.roles;
    /**
     * @type {?}
     * @private
     */
    RoleManagerService.prototype.roleSplitterExpr;
    /**
     * @type {?}
     * @private
     */
    RoleManagerService.prototype.config;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm9sZS1tYW5hZ2VyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdHNzL3Nkay8iLCJzb3VyY2VzIjpbImxpYi9zZWN1cml0eS9yb2xlLW1hbmFnZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbkQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMvRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDL0QsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHVDQUF1QyxDQUFDOzs7QUFHakU7SUFPRSw0QkFBb0IsTUFBc0I7UUFBdEIsV0FBTSxHQUFOLE1BQU0sQ0FBZ0I7UUFIekIsVUFBSyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7UUFJakMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDbEUsQ0FBQztJQUVELHNCQUFJLHVDQUFPOzs7O1FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDO1FBQ2xDLENBQUM7OztPQUFBO0lBRUQsc0JBQUkseUNBQVM7Ozs7UUFBYjtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDekIsQ0FBQzs7O09BQUE7Ozs7SUFFRCxxQ0FBUTs7O0lBQVI7UUFDRSxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2hDLENBQUM7Ozs7O0lBRUQscUNBQVE7Ozs7SUFBUixVQUFTLEtBQTRDO1FBQ25ELElBQUksQ0FBQyxVQUFVLEVBQUUs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QUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDdkQsQ0FBQzs7Ozs7O0lBRU8sMkNBQWM7Ozs7O0lBQXRCLFVBQXVCLElBQXFCO1FBQzFDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7SUFDN0MsQ0FBQzs7Ozs7O0lBRU8sMENBQWE7Ozs7O0lBQXJCLFVBQXNCLEtBQTRDOztZQUM1RCxTQUFTLEdBQWEsRUFBRTtRQUM1QixJQUFJLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNuQixTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxtQkFBQSxLQUFLLEVBQVUsQ0FBQyxDQUFDO1NBQzNDO2FBQU0sSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDMUIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUMvQjthQUFNO1lBQ0wsU0FBUyxHQUFHLG1CQUFBLEtBQUssRUFBWSxDQUFDO1NBQy9CO1FBRUQsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQzs7Ozs7O0lBRU8sb0NBQU87Ozs7O0lBQWYsVUFBZ0IsS0FBc0I7UUFDcEMsT0FBTyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3BELENBQUM7O2dCQTFIRixVQUFVLFNBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COzs7O2dCQVRRLGNBQWM7Ozs2QkFEdkI7Q0FtSUMsQUEzSEQsSUEySEM7U0F4SFksa0JBQWtCOzs7Ozs7SUFDN0IsbUNBQW1DOzs7OztJQUNuQyw4Q0FBMEM7Ozs7O0lBRTlCLG9DQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFNlY3VyaXR5Q29uZmlnIH0gZnJvbSAnLi9zZWN1cml0eS1jb25maWcnO1xuaW1wb3J0IHsgaXNTdHJpbmcgfSBmcm9tICcuLi9jb3JlL3R5cGUtY2hlY2svaXMtc3RyaW5nLmZ1bmN0aW9uJztcbmltcG9ydCB7IGlzQXJyYXkgfSBmcm9tICcuLi9jb3JlL3R5cGUtY2hlY2svaXMtYXJyYXkuZnVuY3Rpb24nO1xuaW1wb3J0IHsgaXNWYWx1ZSB9IGZyb20gJy4uL2NvcmUvdHlwZS1jaGVjay9pcy12YWx1ZS5mdW5jdGlvbic7XG5pbXBvcnQgeyBpc051bWJlciB9IGZyb20gJy4uL2NvcmUvdHlwZS1jaGVjay9pcy1udW1iZXIuZnVuY3Rpb24nO1xuXG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFJvbGVNYW5hZ2VyU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgcm9sZXMgPSBuZXcgU2V0KCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgcm9sZVNwbGl0dGVyRXhwcjogUmVnRXhwO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY29uZmlnOiBTZWN1cml0eUNvbmZpZykge1xuICAgIHRoaXMucm9sZVNwbGl0dGVyRXhwciA9IG5ldyBSZWdFeHAodGhpcy5jb25maWcucm9sZVNwbGl0dGVyRXhwKTtcbiAgfVxuXG4gIGdldCBlbmFibGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5yb2xlc0VuYWJsZWQ7XG4gIH1cblxuICBnZXQgcm9sZUNvdW50KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMucm9sZXMuc2l6ZTtcbiAgfVxuXG4gIGdldFJvbGVzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnJvbGVzKTtcbiAgfVxuXG4gIHNldFJvbGVzKHJvbGVzOiBzdHJpbmcgfCBzdHJpbmdbXSB8IG51bWJlciB8IG51bWJlcltdKTogdm9pZCB7XG4gICAgdGhpcy5jbGVhclJvbGVzKCk7XG4gICAgdGhpcy5hZGRSb2xlcyhyb2xlcyk7XG4gIH1cblxuICBhZGRSb2xlcyhyb2xlczogc3RyaW5nIHwgc3RyaW5nW10gfCBudW1iZXIgfCBudW1iZXJbXSk6IHZvaWQge1xuICAgIGlmIChpc1N0cmluZyhyb2xlcykgJiYgKHJvbGVzIGFzIHN0cmluZykuaW5jbHVkZXMoJywnKSkge1xuICAgICAgcm9sZXMgPSB0aGlzLnRvQXJyYXkoKHJvbGVzIGFzIHN0cmluZykpO1xuICAgIH1cblxuICAgIGlmIChpc0FycmF5KHJvbGVzKSkge1xuICAgICAgKHJvbGVzIGFzIHN0cmluZ1tdKS5mb3JFYWNoKHRoaXMuYWRkUm9sZSwgdGhpcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYWRkUm9sZShyb2xlcyBhcyBzdHJpbmcpO1xuICAgIH1cbiAgfVxuXG4gIGFkZFJvbGUocm9sZTogc3RyaW5nIHwgbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5yb2xlcy5hZGQoU3RyaW5nKHJvbGUpLnRyaW0oKSk7XG4gIH1cblxuICBjbGVhclJvbGVzKCk6IHZvaWQge1xuICAgIHRoaXMucm9sZXMuY2xlYXIoKTtcbiAgfVxuXG4gIGhhc1JvbGUocm9sZTogc3RyaW5nIHwgbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmICghaXNWYWx1ZShyb2xlKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmhhc1JvbGVzKFN0cmluZyhyb2xlKSk7XG4gIH1cblxuICBoYXNSb2xlcyhyb2xlczogc3RyaW5nIHwgbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgbGV0IHNwbGl0Um9sZXM7XG5cbiAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKCFpc1ZhbHVlKHJvbGVzKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHNwbGl0Um9sZXMgPSB0aGlzLnRvQXJyYXkocm9sZXMpO1xuICAgIHJldHVybiBTdHJpbmcocm9sZXMpLmluY2x1ZGVzKCcsJylcbiAgICAgID8gdGhpcy5oYXNBbGxSb2xlcyhzcGxpdFJvbGVzKVxuICAgICAgOiB0aGlzLmhhc0FueVJvbGVzKHNwbGl0Um9sZXMpO1xuICB9XG5cbiAgaGFzQWxsUm9sZXMocm9sZXM6IHN0cmluZyB8IHN0cmluZ1tdIHwgbnVtYmVyIHwgbnVtYmVyW10pOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKCFpc1ZhbHVlKHJvbGVzKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IHJvbGVMaXN0OiBzdHJpbmdbXSA9IHRoaXMudG9TdHJpbmdBcnJheShyb2xlcyk7XG4gICAgcmV0dXJuIHJvbGVMaXN0LmV2ZXJ5KHRoaXMuZm9yUmVhbEhhc1JvbGUuYmluZCh0aGlzKSk7XG4gIH1cblxuICBoYXNBbnlSb2xlcyhyb2xlczogc3RyaW5nIHwgc3RyaW5nW10gfCBudW1iZXIgfCBudW1iZXJbXSk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5lbmFibGVkKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoIWlzVmFsdWUocm9sZXMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3Qgcm9sZUxpc3Q6IHN0cmluZ1tdID0gdGhpcy50b1N0cmluZ0FycmF5KHJvbGVzKTtcbiAgICByZXR1cm4gcm9sZUxpc3Quc29tZSh0aGlzLmZvclJlYWxIYXNSb2xlLmJpbmQodGhpcykpO1xuICB9XG5cbiAgcHJpdmF0ZSBmb3JSZWFsSGFzUm9sZShyb2xlOiBzdHJpbmcgfCBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yb2xlcy5oYXMoU3RyaW5nKHJvbGUpLnRyaW0oKSk7XG4gIH1cblxuICBwcml2YXRlIHRvU3RyaW5nQXJyYXkocm9sZXM6IHN0cmluZyB8IHN0cmluZ1tdIHwgbnVtYmVyIHwgbnVtYmVyW10pOiBzdHJpbmdbXSB7XG4gICAgbGV0IHJvbGVzTGlzdDogc3RyaW5nW10gPSBbXTtcbiAgICBpZiAoaXNTdHJpbmcocm9sZXMpKSB7XG4gICAgICByb2xlc0xpc3QgPSB0aGlzLnRvQXJyYXkocm9sZXMgYXMgc3RyaW5nKTtcbiAgICB9IGVsc2UgaWYgKGlzTnVtYmVyKHJvbGVzKSkge1xuICAgICAgcm9sZXNMaXN0LnB1c2goU3RyaW5nKHJvbGVzKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvbGVzTGlzdCA9IHJvbGVzIGFzIHN0cmluZ1tdO1xuICAgIH1cblxuICAgIHJldHVybiByb2xlc0xpc3Q7XG4gIH1cblxuICBwcml2YXRlIHRvQXJyYXkocm9sZXM6IHN0cmluZyB8IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gU3RyaW5nKHJvbGVzKS5zcGxpdCh0aGlzLnJvbGVTcGxpdHRlckV4cHIpO1xuICB9XG59XG5cbiJdfQ==