/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { MISSING_ROLE_PARAM_EXCEPTION_MSG } from './role';
import { SecurityConfig } from '../security-config';
import { BaseResourceService } from '../../core/resource/base-resource.service';
import { join } from '../../core/url/join.function';
import { UNSUPPORTED_GET_EXCEPTION_MSG, UNSUPPORTED_CREATE_EXCEPTION_MSG } from '../../core/resource/resource.constants';
import { MISSING_USER_PARAM_EXCEPTION_MSG } from '../security.constants';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "../security-config";
/**
 * Service to provide all CRUD operations for user/role assignment.
 *
 * \@example
 * ## Gets roles for a given user:
 * service.rolesByUser('879e27e1-b139-4348-86ca-ec4d5651475f')
 *
 * // Which is just a shortcut for:
 * service.query({ userId: '879e27e1-b139-4348-86ca-ec4d5651475f' });
 *
 */
var UserRoleService = /** @class */ (function (_super) {
    tslib_1.__extends(UserRoleService, _super);
    function UserRoleService(http, config) {
        var _this = _super.call(this, http, {
            url: join(config.serviceUrl, config.userRolesEndpoint),
            idFieldName: 'userId'
        }) || this;
        _this.http = http;
        return _this;
    }
    /**
     * Retrieves a list of roles for a given user ID.
     */
    /**
     * Retrieves a list of roles for a given user ID.
     * @param {?=} routeTokens
     * @param {?=} params
     * @return {?}
     */
    UserRoleService.prototype.query = /**
     * Retrieves a list of roles for a given user ID.
     * @param {?=} routeTokens
     * @param {?=} params
     * @return {?}
     */
    function (routeTokens, params) {
        if (!routeTokens || !routeTokens.userId) {
            throw new Error(MISSING_USER_PARAM_EXCEPTION_MSG);
        }
        return _super.prototype.query.call(this, routeTokens, params);
    };
    /**
     * This method is not supported for this resource. Please use "rolesByUser".
     */
    /**
     * This method is not supported for this resource. Please use "rolesByUser".
     * @param {?} id
     * @param {?=} routeTokens
     * @param {?=} params
     * @return {?}
     */
    UserRoleService.prototype.get = /**
     * This method is not supported for this resource. Please use "rolesByUser".
     * @param {?} id
     * @param {?=} routeTokens
     * @param {?=} params
     * @return {?}
     */
    function (id, routeTokens, params) {
        throw new Error(UNSUPPORTED_GET_EXCEPTION_MSG);
    };
    /**
     * This method is not supported for this resource. Please use "addUserToRole".
     */
    /**
     * This method is not supported for this resource. Please use "addUserToRole".
     * @param {?} entity
     * @param {?=} routeTokens
     * @param {?=} params
     * @return {?}
     */
    UserRoleService.prototype.create = /**
     * This method is not supported for this resource. Please use "addUserToRole".
     * @param {?} entity
     * @param {?=} routeTokens
     * @param {?=} params
     * @return {?}
     */
    function (entity, routeTokens, params) {
        throw new Error(UNSUPPORTED_CREATE_EXCEPTION_MSG);
    };
    /**
     * Updates a users role assignment (adds a role to a user).
     */
    /**
     * Updates a users role assignment (adds a role to a user).
     * @param {?} entity
     * @param {?=} routeTokens
     * @param {?=} params
     * @return {?}
     */
    UserRoleService.prototype.update = /**
     * Updates a users role assignment (adds a role to a user).
     * @param {?} entity
     * @param {?=} routeTokens
     * @param {?=} params
     * @return {?}
     */
    function (entity, routeTokens, params) {
        if (!routeTokens || !routeTokens.userId) {
            throw new Error(MISSING_USER_PARAM_EXCEPTION_MSG);
        }
        else if (!routeTokens.roleName) {
            throw new Error(MISSING_ROLE_PARAM_EXCEPTION_MSG);
        }
        return _super.prototype.update.call(this, null, routeTokens, params);
    };
    /**
     * Removes a user from a role assignment.
     */
    /**
     * Removes a user from a role assignment.
     * @param {?} id
     * @param {?=} routeTokens
     * @param {?=} params
     * @return {?}
     */
    UserRoleService.prototype.delete = /**
     * Removes a user from a role assignment.
     * @param {?} id
     * @param {?=} routeTokens
     * @param {?=} params
     * @return {?}
     */
    function (id, routeTokens, params) {
        if (!routeTokens || !routeTokens.userId) {
            throw new Error(MISSING_USER_PARAM_EXCEPTION_MSG);
        }
        else if (!routeTokens.roleName) {
            throw new Error(MISSING_ROLE_PARAM_EXCEPTION_MSG);
        }
        return _super.prototype.delete.call(this, id, routeTokens, params);
    };
    /**
     * Retrieves all roles assigned to the given user ID.
     */
    /**
     * Retrieves all roles assigned to the given user ID.
     * @param {?} userId
     * @param {?=} params
     * @return {?}
     */
    UserRoleService.prototype.rolesByUser = /**
     * Retrieves all roles assigned to the given user ID.
     * @param {?} userId
     * @param {?=} params
     * @return {?}
     */
    function (userId, params) {
        return this.query({ userId: userId }, params);
    };
    /**
     * Adds a user to role.
     */
    /**
     * Adds a user to role.
     * @param {?} userId
     * @param {?} role
     * @param {?=} params
     * @return {?}
     */
    UserRoleService.prototype.addUserToRole = /**
     * Adds a user to role.
     * @param {?} userId
     * @param {?} role
     * @param {?=} params
     * @return {?}
     */
    function (userId, role, params) {
        // NOTE: We pass an arbitrary "_" role name because the route requires a role name,
        // however the role's name is going to be pulled from the role entity on the server.
        // The reason we don't pass "role.name" here is because of issues with IIS not
        // handling decoded backslashes (ex: TSS\TSS Users).
        return _super.prototype.update.call(this, role, { userId: userId, roleName: '_' }, params);
    };
    /**
     * Adds a user to role.
     */
    /**
     * Adds a user to role.
     * @param {?} userId
     * @param {?} roleName
     * @param {?=} params
     * @return {?}
     */
    UserRoleService.prototype.addUserToRoleByName = /**
     * Adds a user to role.
     * @param {?} userId
     * @param {?} roleName
     * @param {?=} params
     * @return {?}
     */
    function (userId, roleName, params) {
        roleName = decodeURIComponent(roleName);
        return this.update(null, { userId: userId, roleName: roleName }, params);
    };
    /**
     * Removes a user from the given role.
     */
    /**
     * Removes a user from the given role.
     * @param {?} userId
     * @param {?} role
     * @param {?=} params
     * @return {?}
     */
    UserRoleService.prototype.removeUserFromRole = /**
     * Removes a user from the given role.
     * @param {?} userId
     * @param {?} role
     * @param {?=} params
     * @return {?}
     */
    function (userId, role, params) {
        return this.removeUserFromRoleByName(userId, role.name, params);
    };
    /**
     * Removes a user from the given role.
     */
    /**
     * Removes a user from the given role.
     * @param {?} userId
     * @param {?} roleName
     * @param {?=} params
     * @return {?}
     */
    UserRoleService.prototype.removeUserFromRoleByName = /**
     * Removes a user from the given role.
     * @param {?} userId
     * @param {?} roleName
     * @param {?=} params
     * @return {?}
     */
    function (userId, roleName, params) {
        roleName = decodeURIComponent(roleName);
        return this.delete(userId, { userId: userId, roleName: roleName }, params);
    };
    UserRoleService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    UserRoleService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: SecurityConfig }
    ]; };
    /** @nocollapse */ UserRoleService.ngInjectableDef = i0.defineInjectable({ factory: function UserRoleService_Factory() { return new UserRoleService(i0.inject(i1.HttpClient), i0.inject(i2.SecurityConfig)); }, token: UserRoleService, providedIn: "root" });
    return UserRoleService;
}(BaseResourceService));
export { UserRoleService };
if (false) {
    /**
     * @type {?}
     * @protected
     */
    UserRoleService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1yb2xlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdHNzL3Nkay8iLCJzb3VyY2VzIjpbImxpYi9zZWN1cml0eS9yb2xlcy91c2VyLXJvbGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQWMsTUFBTSxzQkFBc0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSTNDLE9BQU8sRUFBUSxnQ0FBZ0MsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUNoRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFDaEYsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3BELE9BQU8sRUFBRSw2QkFBNkIsRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ3pILE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLHVCQUF1QixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7QUFjekU7SUFHcUMsMkNBQXlCO0lBQzVELHlCQUFzQixJQUFnQixFQUFFLE1BQXNCO1FBQTlELFlBQ0Usa0JBQU0sSUFBSSxFQUFFO1lBQ1YsR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQztZQUN0RCxXQUFXLEVBQUUsUUFBUTtTQUN0QixDQUFDLFNBQ0g7UUFMcUIsVUFBSSxHQUFKLElBQUksQ0FBWTs7SUFLdEMsQ0FBQztJQUVEOztPQUVHOzs7Ozs7O0lBQ0gsK0JBQUs7Ozs7OztJQUFMLFVBQU0sV0FBaUIsRUFBRSxNQUFtQjtRQUMxQyxJQUFJLENBQUMsV0FBVyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRTtZQUN2QyxNQUFNLElBQUksS0FBSyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7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QixFQUFFLE1BQW1CO1FBQzVFLFFBQVEsR0FBRyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN4QyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLEVBQUUsTUFBTSxRQUFBLEVBQUUsUUFBUSxVQUFBLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUMzRCxDQUFDOztnQkFyR0YsVUFBVSxTQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjs7OztnQkExQlEsVUFBVTtnQkFNVixjQUFjOzs7MEJBTnZCO0NBOEhDLEFBdEdELENBR3FDLG1CQUFtQixHQW1HdkQ7U0FuR1ksZUFBZTs7Ozs7O0lBQ2QsK0JBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cFBhcmFtcyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBSb2xlLCBNSVNTSU5HX1JPTEVfUEFSQU1fRVhDRVBUSU9OX01TRyB9IGZyb20gJy4vcm9sZSc7XG5pbXBvcnQgeyBTZWN1cml0eUNvbmZpZyB9IGZyb20gJy4uL3NlY3VyaXR5LWNvbmZpZyc7XG5pbXBvcnQgeyBCYXNlUmVzb3VyY2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9yZXNvdXJjZS9iYXNlLXJlc291cmNlLnNlcnZpY2UnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJy4uLy4uL2NvcmUvdXJsL2pvaW4uZnVuY3Rpb24nO1xuaW1wb3J0IHsgVU5TVVBQT1JURURfR0VUX0VYQ0VQVElPTl9NU0csIFVOU1VQUE9SVEVEX0NSRUFURV9FWENFUFRJT05fTVNHIH0gZnJvbSAnLi4vLi4vY29yZS9yZXNvdXJjZS9yZXNvdXJjZS5jb25zdGFudHMnO1xuaW1wb3J0IHsgTUlTU0lOR19VU0VSX1BBUkFNX0VYQ0VQVElPTl9NU0cgfSBmcm9tICcuLi9zZWN1cml0eS5jb25zdGFudHMnO1xuXG5cbi8qKlxuICogU2VydmljZSB0byBwcm92aWRlIGFsbCBDUlVEIG9wZXJhdGlvbnMgZm9yIHVzZXIvcm9sZSBhc3NpZ25tZW50LlxuICpcbiAqIEBleGFtcGxlXG4gKiAjIyBHZXRzIHJvbGVzIGZvciBhIGdpdmVuIHVzZXI6XG4gKiBzZXJ2aWNlLnJvbGVzQnlVc2VyKCc4NzllMjdlMS1iMTM5LTQzNDgtODZjYS1lYzRkNTY1MTQ3NWYnKVxuICpcbiAqIC8vIFdoaWNoIGlzIGp1c3QgYSBzaG9ydGN1dCBmb3I6XG4gKiBzZXJ2aWNlLnF1ZXJ5KHsgdXNlcklkOiAnODc5ZTI3ZTEtYjEzOS00MzQ4LTg2Y2EtZWM0ZDU2NTE0NzVmJyB9KTtcbiAqXG4gKi9cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFVzZXJSb2xlU2VydmljZSBleHRlbmRzIEJhc2VSZXNvdXJjZVNlcnZpY2U8Um9sZT4ge1xuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaHR0cDogSHR0cENsaWVudCwgY29uZmlnOiBTZWN1cml0eUNvbmZpZykge1xuICAgIHN1cGVyKGh0dHAsIHtcbiAgICAgIHVybDogam9pbihjb25maWcuc2VydmljZVVybCwgY29uZmlnLnVzZXJSb2xlc0VuZHBvaW50KSxcbiAgICAgIGlkRmllbGROYW1lOiAndXNlcklkJ1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhIGxpc3Qgb2Ygcm9sZXMgZm9yIGEgZ2l2ZW4gdXNlciBJRC5cbiAgICovXG4gIHF1ZXJ5KHJvdXRlVG9rZW5zPzogYW55LCBwYXJhbXM/OiBIdHRwUGFyYW1zKTogT2JzZXJ2YWJsZTxSb2xlW10+IHtcbiAgICBpZiAoIXJvdXRlVG9rZW5zIHx8ICFyb3V0ZVRva2Vucy51c2VySWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihNSVNTSU5HX1VTRVJfUEFSQU1fRVhDRVBUSU9OX01TRyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1cGVyLnF1ZXJ5KHJvdXRlVG9rZW5zLCBwYXJhbXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgbWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIHRoaXMgcmVzb3VyY2UuIFBsZWFzZSB1c2UgXCJyb2xlc0J5VXNlclwiLlxuICAgKi9cbiAgZ2V0KGlkOiBzdHJpbmcgfCBudW1iZXIsIHJvdXRlVG9rZW5zPzogYW55LCBwYXJhbXM/OiBIdHRwUGFyYW1zKTogT2JzZXJ2YWJsZTxSb2xlPiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFVOU1VQUE9SVEVEX0dFVF9FWENFUFRJT05fTVNHKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCBpcyBub3Qgc3VwcG9ydGVkIGZvciB0aGlzIHJlc291cmNlLiBQbGVhc2UgdXNlIFwiYWRkVXNlclRvUm9sZVwiLlxuICAgKi9cbiAgY3JlYXRlKGVudGl0eTogUm9sZSwgcm91dGVUb2tlbnM/OiBhbnksIHBhcmFtcz86IEh0dHBQYXJhbXMpOiBPYnNlcnZhYmxlPFJvbGU+IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoVU5TVVBQT1JURURfQ1JFQVRFX0VYQ0VQVElPTl9NU0cpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgYSB1c2VycyByb2xlIGFzc2lnbm1lbnQgKGFkZHMgYSByb2xlIHRvIGEgdXNlcikuXG4gICAqL1xuICB1cGRhdGUoZW50aXR5OiBSb2xlLCByb3V0ZVRva2Vucz86IGFueSwgcGFyYW1zPzogSHR0cFBhcmFtcyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgaWYgKCFyb3V0ZVRva2VucyB8fCAhcm91dGVUb2tlbnMudXNlcklkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoTUlTU0lOR19VU0VSX1BBUkFNX0VYQ0VQVElPTl9NU0cpO1xuICAgIH0gZWxzZSBpZiAoIXJvdXRlVG9rZW5zLnJvbGVOYW1lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoTUlTU0lOR19ST0xFX1BBUkFNX0VYQ0VQVElPTl9NU0cpO1xuICAgIH1cblxuICAgIHJldHVybiBzdXBlci51cGRhdGUobnVsbCwgcm91dGVUb2tlbnMsIHBhcmFtcyk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhIHVzZXIgZnJvbSBhIHJvbGUgYXNzaWdubWVudC5cbiAgICovXG4gIGRlbGV0ZShpZDogc3RyaW5nIHwgbnVtYmVyLCByb3V0ZVRva2Vucz86IGFueSwgcGFyYW1zPzogSHR0cFBhcmFtcyk6IE9ic2VydmFibGU8Um9sZT4ge1xuICAgIGlmICghcm91dGVUb2tlbnMgfHwgIXJvdXRlVG9rZW5zLnVzZXJJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKE1JU1NJTkdfVVNFUl9QQVJBTV9FWENFUFRJT05fTVNHKTtcbiAgICB9IGVsc2UgaWYgKCFyb3V0ZVRva2Vucy5yb2xlTmFtZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKE1JU1NJTkdfUk9MRV9QQVJBTV9FWENFUFRJT05fTVNHKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3VwZXIuZGVsZXRlKGlkLCByb3V0ZVRva2VucywgcGFyYW1zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYWxsIHJvbGVzIGFzc2lnbmVkIHRvIHRoZSBnaXZlbiB1c2VyIElELlxuICAgKi9cbiAgcm9sZXNCeVVzZXIodXNlcklkOiBzdHJpbmcsIHBhcmFtcz86IEh0dHBQYXJhbXMpOiBPYnNlcnZhYmxlPFJvbGVbXT4ge1xuICAgIHJldHVybiB0aGlzLnF1ZXJ5KHsgdXNlcklkIH0sIHBhcmFtcyk7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIHVzZXIgdG8gcm9sZS5cbiAgICovXG4gIGFkZFVzZXJUb1JvbGUodXNlcklkOiBzdHJpbmcsIHJvbGU6IFJvbGUsIHBhcmFtcz86IEh0dHBQYXJhbXMpOiBPYnNlcnZhYmxlPFJvbGU+IHtcbiAgICAvLyBOT1RFOiBXZSBwYXNzIGFuIGFyYml0cmFyeSBcIl9cIiByb2xlIG5hbWUgYmVjYXVzZSB0aGUgcm91dGUgcmVxdWlyZXMgYSByb2xlIG5hbWUsXG4gICAgLy8gaG93ZXZlciB0aGUgcm9sZSdzIG5hbWUgaXMgZ29pbmcgdG8gYmUgcHVsbGVkIGZyb20gdGhlIHJvbGUgZW50aXR5IG9uIHRoZSBzZXJ2ZXIuXG4gICAgLy8gVGhlIHJlYXNvbiB3ZSBkb24ndCBwYXNzIFwicm9sZS5uYW1lXCIgaGVyZSBpcyBiZWNhdXNlIG9mIGlzc3VlcyB3aXRoIElJUyBub3RcbiAgICAvLyBoYW5kbGluZyBkZWNvZGVkIGJhY2tzbGFzaGVzIChleDogVFNTXFxUU1MgVXNlcnMpLlxuICAgIHJldHVybiBzdXBlci51cGRhdGUocm9sZSwgeyB1c2VySWQsIHJvbGVOYW1lOiAnXycgfSwgcGFyYW1zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgdXNlciB0byByb2xlLlxuICAgKi9cbiAgYWRkVXNlclRvUm9sZUJ5TmFtZSh1c2VySWQ6IHN0cmluZywgcm9sZU5hbWU6IHN0cmluZywgcGFyYW1zPzogSHR0cFBhcmFtcyk6IE9ic2VydmFibGU8Um9sZT4ge1xuICAgIHJvbGVOYW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KHJvbGVOYW1lKTtcbiAgICByZXR1cm4gdGhpcy51cGRhdGUobnVsbCwgeyB1c2VySWQsIHJvbGVOYW1lIH0sIHBhcmFtcyk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhIHVzZXIgZnJvbSB0aGUgZ2l2ZW4gcm9sZS5cbiAgICovXG4gIHJlbW92ZVVzZXJGcm9tUm9sZSh1c2VySWQ6IHN0cmluZywgcm9sZTogUm9sZSwgcGFyYW1zPzogSHR0cFBhcmFtcyk6IE9ic2VydmFibGU8Um9sZT4ge1xuICAgIHJldHVybiB0aGlzLnJlbW92ZVVzZXJGcm9tUm9sZUJ5TmFtZSh1c2VySWQsIHJvbGUubmFtZSwgcGFyYW1zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIGEgdXNlciBmcm9tIHRoZSBnaXZlbiByb2xlLlxuICAgKi9cbiAgcmVtb3ZlVXNlckZyb21Sb2xlQnlOYW1lKHVzZXJJZDogc3RyaW5nLCByb2xlTmFtZTogc3RyaW5nLCBwYXJhbXM/OiBIdHRwUGFyYW1zKTogT2JzZXJ2YWJsZTxSb2xlPiB7XG4gICAgcm9sZU5hbWUgPSBkZWNvZGVVUklDb21wb25lbnQocm9sZU5hbWUpO1xuICAgIHJldHVybiB0aGlzLmRlbGV0ZSh1c2VySWQsIHsgdXNlcklkLCByb2xlTmFtZSB9LCBwYXJhbXMpO1xuICB9XG59XG4iXX0=