/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// Angular.
import { Injectable } from '@angular/core';
// TSS.
import { JSON_MIME_TYPE, TEXT_MIME_TYPE } from '../core/media/media.constants';
import { base64MimeType } from '../core/media/base64-mime-type.function';
import { base64toBlob } from '../core/media/base64-to-blob.function';
import { DEFAULT_EXPORT_GEOJSON_FILE_NAME } from './export.constants';
import { format } from '../core/formatting/format.function';
import { isString } from '../core/type-check/is-string.function';
import { formatDate } from '../core/date-time/format/format-date.function';
import * as i0 from "@angular/core";
var ExportService = /** @class */ (function () {
    function ExportService() {
    }
    /**
     * @param {?} fileNameTemplate
     * @param {?=} tokens
     * @param {?=} removeEmptyTokens
     * @return {?}
     */
    ExportService.prototype.replaceTokens = /**
     * @param {?} fileNameTemplate
     * @param {?=} tokens
     * @param {?=} removeEmptyTokens
     * @return {?}
     */
    function (fileNameTemplate, tokens, removeEmptyTokens) {
        if (tokens === void 0) { tokens = {}; }
        return format(fileNameTemplate, Object.assign(this.getReplaceTokens(), tokens), removeEmptyTokens);
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?=} fileNameTemplate
     * @param {...?} features
     * @return {THIS}
     */
    ExportService.prototype.exportFeatureCollection = /**
     * @template THIS
     * @this {THIS}
     * @param {?=} fileNameTemplate
     * @param {...?} features
     * @return {THIS}
     */
    function (fileNameTemplate) {
        if (fileNameTemplate === void 0) { fileNameTemplate = DEFAULT_EXPORT_GEOJSON_FILE_NAME; }
        var features = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            features[_i - 1] = arguments[_i];
        }
        /** @type {?} */
        var fileName = (/** @type {?} */ (this)).replaceTokens(fileNameTemplate, {
            featureLength: features.length,
        });
        /** @type {?} */
        var featureCollection = {
            type: 'FeatureCollection',
            features: features
        };
        return (/** @type {?} */ (this)).exportFile((/** @type {?} */ (this)).stringify(featureCollection), fileName, JSON_MIME_TYPE);
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?=} fileNameTemplate
     * @param {?=} feature
     * @return {THIS}
     */
    ExportService.prototype.exportFeature = /**
     * @template THIS
     * @this {THIS}
     * @param {?=} fileNameTemplate
     * @param {?=} feature
     * @return {THIS}
     */
    function (fileNameTemplate, feature) {
        if (fileNameTemplate === void 0) { fileNameTemplate = DEFAULT_EXPORT_GEOJSON_FILE_NAME; }
        return (/** @type {?} */ (this)).exportFile((/** @type {?} */ (this)).stringify(feature), fileNameTemplate, JSON_MIME_TYPE);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    ExportService.prototype.stringify = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        return JSON.stringify(data, (/**
         * @param {?} key
         * @param {?} value
         * @return {?}
         */
        function (key, value) {
            return key.startsWith('$$') ? undefined : value;
        }), 2);
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} data
     * @param {?} fileNameTemplate
     * @return {THIS}
     */
    ExportService.prototype.exportJson = /**
     * @template THIS
     * @this {THIS}
     * @param {?} data
     * @param {?} fileNameTemplate
     * @return {THIS}
     */
    function (data, fileNameTemplate) {
        /** @type {?} */
        var jsonString = isString(data)
            ? (/** @type {?} */ (data))
            : (/** @type {?} */ (this)).stringify(data);
        return (/** @type {?} */ (this)).exportFile(jsonString, fileNameTemplate, JSON_MIME_TYPE);
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} base64Data
     * @param {?} fileNameTemplate
     * @param {?=} contentType
     * @return {THIS}
     */
    ExportService.prototype.exportBase64 = /**
     * @template THIS
     * @this {THIS}
     * @param {?} base64Data
     * @param {?} fileNameTemplate
     * @param {?=} contentType
     * @return {THIS}
     */
    function (base64Data, fileNameTemplate, contentType) {
        /** @type {?} */
        var fileName = (/** @type {?} */ (this)).replaceTokens(fileNameTemplate);
        contentType = contentType || base64MimeType(base64Data);
        /** @type {?} */
        var blob = base64toBlob(base64Data, contentType);
        return (/** @type {?} */ (this)).exportFromUrl(URL.createObjectURL(blob), fileName);
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} data
     * @param {?} fileNameTemplate
     * @param {?=} contentType
     * @return {THIS}
     */
    ExportService.prototype.exportFile = /**
     * @template THIS
     * @this {THIS}
     * @param {?} data
     * @param {?} fileNameTemplate
     * @param {?=} contentType
     * @return {THIS}
     */
    function (data, fileNameTemplate, contentType) {
        if (contentType === void 0) { contentType = TEXT_MIME_TYPE; }
        /** @type {?} */
        var blob = new Blob([data], { type: contentType });
        /** @type {?} */
        var fileName = (/** @type {?} */ (this)).replaceTokens(fileNameTemplate);
        return (/** @type {?} */ (this)).exportBlob(blob, fileName);
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} blob
     * @param {?} fileNameTemplate
     * @return {THIS}
     */
    ExportService.prototype.exportBlob = /**
     * @template THIS
     * @this {THIS}
     * @param {?} blob
     * @param {?} fileNameTemplate
     * @return {THIS}
     */
    function (blob, fileNameTemplate) {
        /** @type {?} */
        var fileName = (/** @type {?} */ (this)).replaceTokens(fileNameTemplate);
        return (/** @type {?} */ (this)).exportFromUrl(window.URL.createObjectURL(blob), fileName);
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} url
     * @param {?} fileName
     * @return {THIS}
     */
    ExportService.prototype.exportFromUrl = /**
     * @template THIS
     * @this {THIS}
     * @param {?} url
     * @param {?} fileName
     * @return {THIS}
     */
    function (url, fileName) {
        /** @type {?} */
        var link = document.createElement('a');
        link.href = url;
        link.download = fileName;
        link.click();
        return (/** @type {?} */ (this));
    };
    /**
     * @protected
     * @return {?}
     */
    ExportService.prototype.getReplaceTokens = /**
     * @protected
     * @return {?}
     */
    function () {
        return {
            date: new Date(),
            shortDate: formatDate(new Date(), 'yyyy-MM-dd'),
            year: new Date().getFullYear(),
        };
    };
    ExportService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    ExportService.ctorParameters = function () { return []; };
    /** @nocollapse */ ExportService.ngInjectableDef = i0.defineInjectable({ factory: function ExportService_Factory() { return new ExportService(); }, token: ExportService, providedIn: "root" });
    return ExportService;
}());
export { ExportService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3J0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdHNzL3Nkay8iLCJzb3VyY2VzIjpbImxpYi9leHBvcnQvZXhwb3J0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQU8zQyxPQUFPLEVBQUUsY0FBYyxFQUFFLGNBQWMsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQy9FLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUN6RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDckUsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDdEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQzVELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUNqRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sK0NBQStDLENBQUM7O0FBRzNFO0lBSUU7SUFDQSxDQUFDOzs7Ozs7O0lBRUQscUNBQWE7Ozs7OztJQUFiLFVBQWMsZ0JBQXdCLEVBQUUsTUFBZ0IsRUFBRSxpQkFBMkI7UUFBN0MsdUJBQUEsRUFBQSxXQUFnQjtRQUN0RCxPQUFPLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUMzQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsRUFDdkIsTUFBTSxDQUNQLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztJQUN4QixDQUFDOzs7Ozs7OztJQUVELCtDQUF1Qjs7Ozs7OztJQUF2QixVQUF3QixnQkFBbUQ7UUFBbkQsaUNBQUEsRUFBQSxtREFBbUQ7UUFBRSxrQkFBc0I7YUFBdEIsVUFBc0IsRUFBdEIscUJBQXNCLEVBQXRCLElBQXNCO1lBQXRCLGlDQUFzQjs7O1lBQzNGLFFBQVEsR0FBRyxtQkFBQSxJQUFJLEVBQUEsQ0FBQyxhQUFh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Ozs7Ozs7O0lBRUQscUNBQWE7Ozs7Ozs7SUFBYixVQUFjLEdBQVcsRUFBRSxRQUFnQjs7WUFDbkMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDO1FBRXhDLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUViLE9BQU8sbUJBQUEsSUFBSSxFQUFBLENBQUM7SUFDZCxDQUFDOzs7OztJQUVTLHdDQUFnQjs7OztJQUExQjtRQUNFLE9BQU87WUFDTCxJQUFJLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFDaEIsU0FBUyxFQUFFLFVBQVUsQ0FBQyxJQUFJLElBQUksRUFBRSxFQUFFLFlBQVksQ0FBQztZQUMvQyxJQUFJLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7U0FDL0IsQ0FBQztJQUNKLENBQUM7O2dCQWpGRixVQUFVLFNBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COzs7Ozt3QkFuQkQ7Q0FtR0MsQUFsRkQsSUFrRkM7U0EvRVksYUFBYSIsInNvdXJjZXNDb250ZW50IjpbIi8vIEFuZ3VsYXIuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbi8vIDNyZCBwYXJ0eS5cbmltcG9ydCB7IEZlYXR1cmVDb2xsZWN0aW9uLCBGZWF0dXJlIH0gZnJvbSAnZ2VvanNvbic7XG5cblxuLy8gVFNTLlxuaW1wb3J0IHsgSlNPTl9NSU1FX1RZUEUsIFRFWFRfTUlNRV9UWVBFIH0gZnJvbSAnLi4vY29yZS9tZWRpYS9tZWRpYS5jb25zdGFudHMnO1xuaW1wb3J0IHsgYmFzZTY0TWltZVR5cGUgfSBmcm9tICcuLi9jb3JlL21lZGlhL2Jhc2U2NC1taW1lLXR5cGUuZnVuY3Rpb24nO1xuaW1wb3J0IHsgYmFzZTY0dG9CbG9iIH0gZnJvbSAnLi4vY29yZS9tZWRpYS9iYXNlNjQtdG8tYmxvYi5mdW5jdGlvbic7XG5pbXBvcnQgeyBERUZBVUxUX0VYUE9SVF9HRU9KU09OX0ZJTEVfTkFNRSB9IGZyb20gJy4vZXhwb3J0LmNvbnN0YW50cyc7XG5pbXBvcnQgeyBmb3JtYXQgfSBmcm9tICcuLi9jb3JlL2Zvcm1hdHRpbmcvZm9ybWF0LmZ1bmN0aW9uJztcbmltcG9ydCB7IGlzU3RyaW5nIH0gZnJvbSAnLi4vY29yZS90eXBlLWNoZWNrL2lzLXN0cmluZy5mdW5jdGlvbic7XG5pbXBvcnQgeyBmb3JtYXREYXRlIH0gZnJvbSAnLi4vY29yZS9kYXRlLXRpbWUvZm9ybWF0L2Zvcm1hdC1kYXRlLmZ1bmN0aW9uJztcblxuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBFeHBvcnRTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gIH1cblxuICByZXBsYWNlVG9rZW5zKGZpbGVOYW1lVGVtcGxhdGU6IHN0cmluZywgdG9rZW5zOiBhbnkgPSB7fSwgcmVtb3ZlRW1wdHlUb2tlbnM/OiBib29sZWFuKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZm9ybWF0KGZpbGVOYW1lVGVtcGxhdGUsIE9iamVjdC5hc3NpZ24oXG4gICAgICB0aGlzLmdldFJlcGxhY2VUb2tlbnMoKSxcbiAgICAgIHRva2Vuc1xuICAgICksIHJlbW92ZUVtcHR5VG9rZW5zKTtcbiAgfVxuXG4gIGV4cG9ydEZlYXR1cmVDb2xsZWN0aW9uKGZpbGVOYW1lVGVtcGxhdGUgPSBERUZBVUxUX0VYUE9SVF9HRU9KU09OX0ZJTEVfTkFNRSwgLi4uZmVhdHVyZXM6IEZlYXR1cmVbXSk6IHRoaXMge1xuICAgIGNvbnN0IGZpbGVOYW1lID0gdGhpcy5yZXBsYWNlVG9rZW5zKGZpbGVOYW1lVGVtcGxhdGUsIHtcbiAgICAgIGZlYXR1cmVMZW5ndGg6IGZlYXR1cmVzLmxlbmd0aCxcbiAgICB9KTtcblxuICAgIGNvbnN0IGZlYXR1cmVDb2xsZWN0aW9uOiBGZWF0dXJlQ29sbGVjdGlvbiA9IHtcbiAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsXG4gICAgICBmZWF0dXJlc1xuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5leHBvcnRGaWxlKHRoaXMuc3RyaW5naWZ5KGZlYXR1cmVDb2xsZWN0aW9uKSwgZmlsZU5hbWUsIEpTT05fTUlNRV9UWVBFKTtcbiAgfVxuXG4gIGV4cG9ydEZlYXR1cmUoZmlsZU5hbWVUZW1wbGF0ZSA9IERFRkFVTFRfRVhQT1JUX0dFT0pTT05fRklMRV9OQU1FLCBmZWF0dXJlOiBGZWF0dXJlKTogdGhpcyB7XG4gICAgcmV0dXJuIHRoaXMuZXhwb3J0RmlsZSh0aGlzLnN0cmluZ2lmeShmZWF0dXJlKSwgZmlsZU5hbWVUZW1wbGF0ZSwgSlNPTl9NSU1FX1RZUEUpO1xuICB9XG5cbiAgc3RyaW5naWZ5KGRhdGE6IGFueSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGRhdGEsIChrZXksIHZhbHVlKSA9PiB7XG4gICAgICByZXR1cm4ga2V5LnN0YXJ0c1dpdGgoJyQkJykgPyB1bmRlZmluZWQgOiB2YWx1ZTtcbiAgICB9LCAyKTtcbiAgfVxuXG4gIGV4cG9ydEpzb24oZGF0YTogYW55LCBmaWxlTmFtZVRlbXBsYXRlOiBzdHJpbmcpOiB0aGlzIHtcbiAgICBjb25zdCBqc29uU3RyaW5nOiBzdHJpbmcgPSBpc1N0cmluZyhkYXRhKVxuICAgICAgPyBkYXRhIGFzIHN0cmluZ1xuICAgICAgOiB0aGlzLnN0cmluZ2lmeShkYXRhKTtcblxuICAgIHJldHVybiB0aGlzLmV4cG9ydEZpbGUoanNvblN0cmluZywgZmlsZU5hbWVUZW1wbGF0ZSwgSlNPTl9NSU1FX1RZUEUpO1xuICB9XG5cbiAgZXhwb3J0QmFzZTY0KGJhc2U2NERhdGE6IHN0cmluZywgZmlsZU5hbWVUZW1wbGF0ZTogc3RyaW5nLCBjb250ZW50VHlwZT86IHN0cmluZyk6IHRoaXMge1xuICAgIGNvbnN0IGZpbGVOYW1lID0gdGhpcy5yZXBsYWNlVG9rZW5zKGZpbGVOYW1lVGVtcGxhdGUpO1xuICAgIGNvbnRlbnRUeXBlID0gY29udGVudFR5cGUgfHwgYmFzZTY0TWltZVR5cGUoYmFzZTY0RGF0YSk7XG4gICAgY29uc3QgYmxvYiA9IGJhc2U2NHRvQmxvYihiYXNlNjREYXRhLCBjb250ZW50VHlwZSk7XG5cbiAgICByZXR1cm4gdGhpcy5leHBvcnRGcm9tVXJsKFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYiksIGZpbGVOYW1lKTtcbiAgfVxuXG4gIGV4cG9ydEZpbGUoZGF0YTogYW55LCBmaWxlTmFtZVRlbXBsYXRlOiBzdHJpbmcsIGNvbnRlbnRUeXBlID0gVEVYVF9NSU1FX1RZUEUpOiB0aGlzIHtcbiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2RhdGFdLCB7IHR5cGU6IGNvbnRlbnRUeXBlIH0pO1xuICAgIGNvbnN0IGZpbGVOYW1lID0gdGhpcy5yZXBsYWNlVG9rZW5zKGZpbGVOYW1lVGVtcGxhdGUpO1xuXG4gICAgcmV0dXJuIHRoaXMuZXhwb3J0QmxvYihibG9iLCBmaWxlTmFtZSk7XG4gIH1cblxuICBleHBvcnRCbG9iKGJsb2I6IEJsb2IsIGZpbGVOYW1lVGVtcGxhdGU6IHN0cmluZyk6IHRoaXMge1xuICAgIGNvbnN0IGZpbGVOYW1lID0gdGhpcy5yZXBsYWNlVG9rZW5zKGZpbGVOYW1lVGVtcGxhdGUpO1xuICAgIHJldHVybiB0aGlzLmV4cG9ydEZyb21Vcmwod2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYiksIGZpbGVOYW1lKTtcbiAgfVxuXG4gIGV4cG9ydEZyb21VcmwodXJsOiBzdHJpbmcsIGZpbGVOYW1lOiBzdHJpbmcpOiB0aGlzIHtcbiAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuXG4gICAgbGluay5ocmVmID0gdXJsO1xuICAgIGxpbmsuZG93bmxvYWQgPSBmaWxlTmFtZTtcbiAgICBsaW5rLmNsaWNrKCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRSZXBsYWNlVG9rZW5zKCk6IHt9IHtcbiAgICByZXR1cm4ge1xuICAgICAgZGF0ZTogbmV3IERhdGUoKSxcbiAgICAgIHNob3J0RGF0ZTogZm9ybWF0RGF0ZShuZXcgRGF0ZSgpLCAneXl5eS1NTS1kZCcpLFxuICAgICAgeWVhcjogbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpLFxuICAgIH07XG4gIH1cbn1cbiJdfQ==