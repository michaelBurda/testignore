/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
// Angular.
import { Router } from '@angular/router';
import { Injector, Injectable } from '@angular/core';
import { CoreConfig } from '../core/core.config';
import { Logger } from '../core/logging/logger.service';
import { PersistentStorage } from '../core/storage/persistent-storage.service';
import { getQueryParams } from '../core/url/get-query-params.function';
import { getFirstHashRoutePath } from '../core/url/get-first-hash-route-path.function';
import { getFullUrl } from '../core/url/get-full-url.function';
import { isDate } from '../core/type-check/is-date.function';
import { toPrimitiveType } from '../core/type-conversion/to-primitive-type.function';
import { lowerCaseFirst } from '../core/formatting/lower-case-first.function';
import { isValue } from '../core/type-check/is-value.function';
import { setValue } from '../core/object/set-value.function';
import { AuthService } from '../security/auth.service';
import { SecurityConfig } from '../security/security-config';
import { RoleManagerService } from '../security/role-manager.service';
import { AppProfileService } from './app-profile.service';
import { AppConfig } from './app.config';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "../security/auth.service";
import * as i3 from "./app-profile.service";
import * as i4 from "../core/logging/logger.service";
import * as i5 from "./app.config";
import * as i6 from "../core/storage/persistent-storage.service";
import * as i7 from "../security/security-config";
import * as i8 from "../security/role-manager.service";
/**
 * @record
 */
function ModuleConfigInstanceMap() { }
if (false) {
    /** @type {?} */
    ModuleConfigInstanceMap.prototype.instance;
    /** @type {?} */
    ModuleConfigInstanceMap.prototype.config;
}
/**
 * Application initialization service that is responsible for bootstrapping
 * the application.
 */
var AppInitializerService = /** @class */ (function () {
    function AppInitializerService(router, auth, appProfiles, log, config, storage, securityConfig, roleMgr, injector) {
        var _this = this;
        this.router = router;
        this.auth = auth;
        this.appProfiles = appProfiles;
        this.log = log;
        this.config = config;
        this.storage = storage;
        this.securityConfig = securityConfig;
        this.roleMgr = roleMgr;
        this.injector = injector;
        this.ready = false;
        this.loading = false;
        this.moduleConfigInstances = new Map();
        this.queryParameters = getQueryParams();
        this.onReady = new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.resolveFn = resolve;
            _this.rejectFn = reject;
        }));
    }
    /**
     * Initializes/bootstraps a standard TSS application.
     */
    /**
     * Initializes/bootstraps a standard TSS application.
     * @return {?}
     */
    AppInitializerService.prototype.initialize = /**
     * Initializes/bootstraps a standard TSS application.
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var appId = this.config.appId;
        var _a = tslib_1.__read(this.router.url.split('/'), 1), firstRoutePath = _a[0];
        /** @type {?} */
        var profileId = this.queryParameters.profileId
            || firstRoutePath
            || getFirstHashRoutePath(getFullUrl())
            || this.config.defaultProfileId;
        // We override module configurations here because the user may be trying to debug the session. The
        // override has to happen again at the end of the process to override any settings that may have
        // been set through the app initialization process.
        this.overrideModuleConfigurationsFromQueryParams();
        this.log.debug("Initializing application with profile ID: " + profileId);
        // We need to try and read any stored security token before we make
        // a request to get profile info, so that the request is authenticated.
        this.auth.loadStoredToken();
        this.populateModuleConfigInstances();
        if (!this.config.queryProfile || !this.config.hasServiceUrl) {
            this.config.profile = {
                name: '',
                appId: appId,
                id: profileId,
            };
            this.log.debug(this.config.hasServiceUrl
                ? "Profile query skipped due to configuration option"
                : "No service URL configured, can't retrieve profile details - skipping profile retrieval");
            this.overrideModuleConfigurationsFromQueryParams();
            this.ready = true;
            this.resolveFn(this.config.profile);
        }
        else {
            this.loading = true;
            // We need to try and read any stored security token before we make
            // a request to get profile info, so that the request is authenticated.
            this.queryProfile(profileId)
                .then((/**
             * @param {?} profile
             * @return {?}
             */
            function (profile) { return _this.resolveFn(profile); }))
                .catch((/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                if (_this.config.continueOnAppBootstrapError) {
                    _this.resolveFn(_this.config.profile);
                }
                else {
                    _this.rejectFn(err);
                }
            }));
        }
    };
    /**
     * @private
     * @param {?} profileId
     * @return {?}
     */
    AppInitializerService.prototype.queryProfile = /**
     * @private
     * @param {?} profileId
     * @return {?}
     */
    function (profileId) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.appProfiles.get(profileId)
                .subscribe((/**
             * @param {?} profile
             * @return {?}
             */
            function (profile) {
                if (!profile) {
                    return reject("No profile found with ID '" + profileId + "'");
                }
                _this.config.profileId = profile.id;
                _this.config.profile = profile;
                _this.checkTokenInvalidationDate();
                _this.applyModuleConfigurations();
                _this.overrideModuleConfigurationsFromQueryParams();
                _this.retrieveUserAccount()
                    .then((/**
                 * @return {?}
                 */
                function () {
                    _this.configureRoleManager();
                    _this.ready = true;
                    _this.loading = false;
                    resolve(profile);
                }))
                    .catch((/**
                 * @param {?} err
                 * @return {?}
                 */
                function (err) {
                    _this.loading = false;
                    reject(err);
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                _this.loading = false;
                _this.log.error("Failed to retrieve application profile with app ID '" + _this.config.appId + "' and ID '" + profileId + "'");
                reject(err);
            }));
        }));
    };
    /**
     * Gets the date of the cached "invalidation" date.
     * The invalidation date is used to let the server force users to re-authenticate.
     */
    /**
     * Gets the date of the cached "invalidation" date.
     * The invalidation date is used to let the server force users to re-authenticate.
     * @private
     * @return {?}
     */
    AppInitializerService.prototype.getCachedTokenInvalidationDate = /**
     * Gets the date of the cached "invalidation" date.
     * The invalidation date is used to let the server force users to re-authenticate.
     * @private
     * @return {?}
     */
    function () {
        return new Date(this.storage.get(this.securityConfig.tokenInvalidationDateLookup));
    };
    /**
     * Caches the "invalidation" date.
     * The invalidation date is used to let the server force users to re-authenticate.
     */
    /**
     * Caches the "invalidation" date.
     * The invalidation date is used to let the server force users to re-authenticate.
     * @private
     * @param {?=} setDate
     * @return {?}
     */
    AppInitializerService.prototype.setCachedTokenExpireDate = /**
     * Caches the "invalidation" date.
     * The invalidation date is used to let the server force users to re-authenticate.
     * @private
     * @param {?=} setDate
     * @return {?}
     */
    function (setDate) {
        this.log.debug("Setting cached token invalidation date: " + setDate);
        if (setDate) {
            this.log.debug("Setting token invalidation date to: " + setDate);
            this.storage.set(this.securityConfig.tokenInvalidationDateLookup, setDate);
        }
        else {
            this.storage.remove(this.securityConfig.tokenInvalidationDateLookup);
        }
    };
    /**
     * Compares the cached token validation data with the invalidation date from the server.
     * If the invalidation date from the server is new than the cached date, then the user
     * must be forcibly signed out.
     */
    /**
     * Compares the cached token validation data with the invalidation date from the server.
     * If the invalidation date from the server is new than the cached date, then the user
     * must be forcibly signed out.
     * @private
     * @return {?}
     */
    AppInitializerService.prototype.checkTokenInvalidationDate = /**
     * Compares the cached token validation data with the invalidation date from the server.
     * If the invalidation date from the server is new than the cached date, then the user
     * must be forcibly signed out.
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var tokenExpireDate;
        /** @type {?} */
        var siteInfo = this.config.profile && this.config.profile.app && this.config.profile.app.siteInfo
            ? this.config.profile.app.siteInfo
            : null;
        if (siteInfo && siteInfo[AppInitializerService.tokenExpireDateKey]) {
            /** @type {?} */
            var lastTokenInvalidateDate = this.getCachedTokenInvalidationDate();
            tokenExpireDate = new Date(siteInfo[AppInitializerService.tokenExpireDateKey]);
            // Note, we are setting milliseconds to 0 because we don't care about that level of accuracy.
            // Also, the "setMilliseconds" method returns the "timestamp" so we can just compare those two results.
            /** @type {?} */
            var lastTokenValidationDatesMatch = isDate(lastTokenInvalidateDate) && isDate(tokenExpireDate)
                ? lastTokenInvalidateDate.setMilliseconds(0) === tokenExpireDate.setMilliseconds(0)
                : lastTokenInvalidateDate === tokenExpireDate;
            if (this.auth.account && this.auth.account.lastSignIn < tokenExpireDate && !lastTokenValidationDatesMatch) {
                this.log.info('Signing out user due to token invalidation date from security configuration');
                this.auth.onSignedOut();
            }
            else if (this.auth.account) {
                this.log.debug('User has been authenticated after the token invalidation date');
            }
            if (tokenExpireDate) {
                this.setCachedTokenExpireDate(tokenExpireDate);
            }
        }
    };
    /**
     * Retrieves the user account if the user is already signed in, logs the user out if
     * the token is expired, or refreshes the user account information - depending on
     * the configured authentication provider.
     */
    /**
     * Retrieves the user account if the user is already signed in, logs the user out if
     * the token is expired, or refreshes the user account information - depending on
     * the configured authentication provider.
     * @private
     * @return {?}
     */
    AppInitializerService.prototype.retrieveUserAccount = /**
     * Retrieves the user account if the user is already signed in, logs the user out if
     * the token is expired, or refreshes the user account information - depending on
     * the configured authentication provider.
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            try {
                /** @type {?} */
                var queryingInfo = false;
                /** @type {?} */
                var app_1 = _this.config.profile && _this.config.profile.app
                    ? _this.config.profile.app : null;
                // If the local auth status says that no one is logged in, but the service is recognizing that someone is
                // logged in, then this means that authentication is happening through windows via Active Directory or some
                // other means. We need to get the user info so we can set the app "state" as "logged in".
                if (app_1 && app_1.security && !_this.auth.isAuthenticated && app_1.security.isAuthenticated) {
                    _this.log.debug('Retrieving additional user info do to authentication state');
                    queryingInfo = true;
                    _this.auth.getUserInfo().subscribe((/**
                     * @param {?} info
                     * @return {?}
                     */
                    function (info) {
                        /** @type {?} */
                        var expiresDate = new Date();
                        expiresDate.setDate(expiresDate.getDate() + app_1.security.accessTokenExpireDays);
                        _this.auth.onSignedIn(Object.assign({ '.expires': expiresDate }, info));
                        resolve(info);
                    }), (/**
                     * @param {?} err
                     * @return {?}
                     */
                    function (err) {
                        reject(err);
                    }));
                }
                else if (_this.auth.isAuthenticated && app_1.security && !app_1.security.isAuthenticated) {
                    _this.log.debug("Signing out user do to out of sync authentication state");
                    // Sign out/clear the auth cache because the server says they don't know who this is, but
                    // the client side code thinks it knows who it is.
                    _this.auth.onSignedOut();
                }
                if (!queryingInfo) {
                    _this.log.debug("No request made for additional user account info");
                    resolve(_this.auth.account);
                }
            }
            catch (e) {
                _this.log.error('Failed to do pre-verification of user on app load. {0}', e);
                reject(e);
            }
        }));
    };
    /**
     * Set module configuration properties based on overrides from an object.
     * This object can come from multiple places - such as the server or query params.
     * See: the "applyModuleConfigurations" and "overrideModuleConfigurations" methods.
     */
    /**
     * Set module configuration properties based on overrides from an object.
     * This object can come from multiple places - such as the server or query params.
     * See: the "applyModuleConfigurations" and "overrideModuleConfigurations" methods.
     * @private
     * @param {?} sourceMapping
     * @return {?}
     */
    AppInitializerService.prototype.applyModuleConfigurationsFromObject = /**
     * Set module configuration properties based on overrides from an object.
     * This object can come from multiple places - such as the server or query params.
     * See: the "applyModuleConfigurations" and "overrideModuleConfigurations" methods.
     * @private
     * @param {?} sourceMapping
     * @return {?}
     */
    function (sourceMapping) {
        var _this = this;
        sourceMapping = sourceMapping || {};
        this.moduleConfigInstances
            .forEach((/**
         * @param {?} config
         * @return {?}
         */
        function (config) {
            /** @type {?} */
            var moduleConfigName = config.config.className;
            /** @type {?} */
            var configInstance = config.instance;
            Object.keys(sourceMapping)
                .forEach((/**
             * @param {?} key
             * @return {?}
             */
            function (key) {
                /** @type {?} */
                var value = toPrimitiveType(sourceMapping[key]);
                /** @type {?} */
                var modulePrefix = lowerCaseFirst(moduleConfigName + '.');
                /** @type {?} */
                var rootKey = key.replace(modulePrefix, '');
                if (isValue(value) && key.toLowerCase().startsWith(modulePrefix.toLowerCase())) {
                    // A config object has properties in our siteInfo object.
                    _this.log.debug("Setting " + moduleConfigName + " property '" + rootKey + "' to " + value);
                    setValue(configInstance, rootKey, value);
                }
            }));
        }));
    };
    /**
     * Set module configuration properties based on overrides from the server.
     * This functionality lets us dynamically override client side configuration
     * through the use of "App Settings" from the server.
     */
    /**
     * Set module configuration properties based on overrides from the server.
     * This functionality lets us dynamically override client side configuration
     * through the use of "App Settings" from the server.
     * @private
     * @return {?}
     */
    AppInitializerService.prototype.applyModuleConfigurations = /**
     * Set module configuration properties based on overrides from the server.
     * This functionality lets us dynamically override client side configuration
     * through the use of "App Settings" from the server.
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var profile = this.config.profile;
        if (!profile || !profile.app || !profile.app.siteInfo) {
            return;
        }
        this.applyModuleConfigurationsFromObject(profile.app.siteInfo);
    };
    /**
     * Set module configuration properties based on overrides from the URL query parameters.
     * This functionality lets us dynamically override client side and server side configurations
     * by passing explicit settings through query parameters. A good use case for this is to pass
     * "coreConfig.logLevel=1" as a query parameter in production to debug an issue in a production
     * environment.
     */
    /**
     * Set module configuration properties based on overrides from the URL query parameters.
     * This functionality lets us dynamically override client side and server side configurations
     * by passing explicit settings through query parameters. A good use case for this is to pass
     * "coreConfig.logLevel=1" as a query parameter in production to debug an issue in a production
     * environment.
     * @private
     * @return {?}
     */
    AppInitializerService.prototype.overrideModuleConfigurationsFromQueryParams = /**
     * Set module configuration properties based on overrides from the URL query parameters.
     * This functionality lets us dynamically override client side and server side configurations
     * by passing explicit settings through query parameters. A good use case for this is to pass
     * "coreConfig.logLevel=1" as a query parameter in production to debug an issue in a production
     * environment.
     * @private
     * @return {?}
     */
    function () {
        if (this.config.allowQueryParamInjections) {
            this.applyModuleConfigurationsFromObject(this.queryParameters);
        }
    };
    /**
     * Instantiates instances of each configured module configuration object. Properties of
     * these module config instances will later be set based on server-side overides.
     */
    /**
     * Instantiates instances of each configured module configuration object. Properties of
     * these module config instances will later be set based on server-side overides.
     * @private
     * @return {?}
     */
    AppInitializerService.prototype.populateModuleConfigInstances = /**
     * Instantiates instances of each configured module configuration object. Properties of
     * these module config instances will later be set based on server-side overides.
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        CoreConfig.moduleConfigs
            .forEach((/**
         * @param {?} moduleAutoConfig
         * @return {?}
         */
        function (moduleAutoConfig) {
            try {
                // Reason: https://github.com/angular/angular/issues/22063
                // tslint:disable-next-line
                /** @type {?} */
                var configInstance = _this.injector.get(moduleAutoConfig.injectorToken);
                _this.moduleConfigInstances.set(moduleAutoConfig.injectorToken, {
                    instance: configInstance,
                    config: moduleAutoConfig
                });
                _this.log.debug("Created module configuration instance for: " + moduleAutoConfig.className);
                if ('serviceUrl' in configInstance || 'hasServiceUrl' in configInstance) {
                    configInstance.serviceUrl = _this.config.serviceUrl;
                }
            }
            catch (err) {
                _this.log.error("Failed to get module config: " + moduleAutoConfig.className, err);
            }
        }));
    };
    /**
     * Updates security options based on information retrieved form the application profile.
     * For example, security may be enabled or disabled, guest roles will be set, etc.
     */
    /**
     * Updates security options based on information retrieved form the application profile.
     * For example, security may be enabled or disabled, guest roles will be set, etc.
     * @private
     * @return {?}
     */
    AppInitializerService.prototype.configureRoleManager = /**
     * Updates security options based on information retrieved form the application profile.
     * For example, security may be enabled or disabled, guest roles will be set, etc.
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var security = this.config.profile && this.config.profile.app && this.config.profile.app.security
            ? this.config.profile.app.security : null;
        if (!security) {
            return;
        }
        // We want to explicitly
        if (security.hasOwnProperty('enabled')) {
            this.securityConfig.rolesEnabled = !!security.enabled;
        }
        if (!this.roleMgr.enabled) {
            this.log.warn('Security is disabled');
        }
        security.guestPrivileges = security.guestPrivileges || [];
        this.roleMgr.addRoles(security.guestPrivileges);
        this.log.info("Configured default roles (guest roles) - total of " + security.guestPrivileges.length);
        this.log.info("User has a total of " + this.roleMgr.roleCount + " roles assigned to them");
    };
    AppInitializerService.tokenExpireDateKey = 'token-expire-date';
    AppInitializerService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    AppInitializerService.ctorParameters = function () { return [
        { type: Router },
        { type: AuthService },
        { type: AppProfileService },
        { type: Logger },
        { type: AppConfig },
        { type: PersistentStorage },
        { type: SecurityConfig },
        { type: RoleManagerService },
        { type: Injector }
    ]; };
    /** @nocollapse */ AppInitializerService.ngInjectableDef = i0.defineInjectable({ factory: function AppInitializerService_Factory() { return new AppInitializerService(i0.inject(i1.Router), i0.inject(i2.AuthService), i0.inject(i3.AppProfileService), i0.inject(i4.Logger), i0.inject(i5.AppConfig), i0.inject(i6.PersistentStorage), i0.inject(i7.SecurityConfig), i0.inject(i8.RoleManagerService), i0.inject(i0.INJECTOR)); }, token: AppInitializerService, providedIn: "root" });
    return AppInitializerService;
}());
export { AppInitializerService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.tokenExpireDateKey;
    /** @type {?} */
    AppInitializerService.prototype.ready;
    /** @type {?} */
    AppInitializerService.prototype.loading;
    /** @type {?} */
    AppInitializerService.prototype.onReady;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.moduleConfigInstances;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.queryParameters;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.resolveFn;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.rejectFn;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.router;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.auth;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.appProfiles;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.log;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.config;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.storage;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.securityConfig;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.roleMgr;
    /**
     * @type {?}
     * @private
     */
    AppInitializerService.prototype.injector;
}
/**
 * Application initialization factory that provides a hook into
 * the Angular bootstrapping process.
 * @param {?} injector
 * @return {?}
 */
export function AppInitializerFactory(injector) {
    return (/**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var initializer = injector.get(AppInitializerService);
        initializer.initialize();
        return initializer.onReady;
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLWluaXRpYWxpemVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdHNzL3Nkay8iLCJzb3VyY2VzIjpbImxpYi9hcHAvYXBwLWluaXRpYWxpemVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSXJELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDeEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sNENBQTRDLENBQUM7QUFDL0UsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGdEQUFnRCxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUMvRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDN0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9EQUFvRCxDQUFDO0FBQ3JGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw4Q0FBOEMsQ0FBQztBQUM5RSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDL0QsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBRTdELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFHdEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENB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WSxxQkFBcUI7Ozs7OztJQUNoQyx5Q0FBaUU7O0lBRWpFLHNDQUFjOztJQUNkLHdDQUFnQjs7SUFDaEIsd0NBQTZCOzs7OztJQUU3QixzREFBb0Y7Ozs7O0lBQ3BGLGdEQUFzQzs7Ozs7SUFDdEMsMENBQTBFOzs7OztJQUMxRSx5Q0FBeUM7Ozs7O0lBR3ZDLHVDQUFzQjs7Ozs7SUFDdEIscUNBQXlCOzs7OztJQUN6Qiw0Q0FBc0M7Ozs7O0lBQ3RDLG9DQUFtQjs7Ozs7SUFDbkIsdUNBQXlCOzs7OztJQUN6Qix3Q0FBa0M7Ozs7O0lBQ2xDLCtDQUFzQzs7Ozs7SUFDdEMsd0NBQW1DOzs7OztJQUNuQyx5Q0FBMEI7Ozs7Ozs7O0FBcVQ5QixNQUFNLFVBQVUscUJBQXFCLENBQUMsUUFBa0I7SUFDdEQ7OztJQUFPOztZQUNDLFdBQVcsR0FBMEIsUUFBUSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQztRQUM5RSxXQUFXLENBQUMsVUFBVSxFQUFFLENBQUM7UUFFekIsT0FBTyxXQUFXLENBQUMsT0FBTyxDQUFDO0lBQzdCLENBQUMsRUFBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBbmd1bGFyLlxuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IEluamVjdG9yLCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbi8vIFRTUy5cbmltcG9ydCB7IEF1dG9Db25maWdEYXRhIH0gZnJvbSAnLi4vY29yZS9hdXRvLWNvbmZpZy1kYXRhJztcbmltcG9ydCB7IENvcmVDb25maWcgfSBmcm9tICcuLi9jb3JlL2NvcmUuY29uZmlnJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL2NvcmUvbG9nZ2luZy9sb2dnZXIuc2VydmljZSc7XG5pbXBvcnQgeyBQZXJzaXN0ZW50U3RvcmFnZSB9IGZyb20gJy4uL2NvcmUvc3RvcmFnZS9wZXJzaXN0ZW50LXN0b3JhZ2Uuc2VydmljZSc7XG5pbXBvcnQgeyBnZXRRdWVyeVBhcmFtcyB9IGZyb20gJy4uL2NvcmUvdXJsL2dldC1xdWVyeS1wYXJhbXMuZnVuY3Rpb24nO1xuaW1wb3J0IHsgZ2V0Rmlyc3RIYXNoUm91dGVQYXRoIH0gZnJvbSAnLi4vY29yZS91cmwvZ2V0LWZpcnN0LWhhc2gtcm91dGUtcGF0aC5mdW5jdGlvbic7XG5pbXBvcnQgeyBnZXRGdWxsVXJsIH0gZnJvbSAnLi4vY29yZS91cmwvZ2V0LWZ1bGwtdXJsLmZ1bmN0aW9uJztcbmltcG9ydCB7IGlzRGF0ZSB9IGZyb20gJy4uL2NvcmUvdHlwZS1jaGVjay9pcy1kYXRlLmZ1bmN0aW9uJztcbmltcG9ydCB7IHRvUHJpbWl0aXZlVHlwZSB9IGZyb20gJy4uL2NvcmUvdHlwZS1jb252ZXJzaW9uL3RvLXByaW1pdGl2ZS10eXBlLmZ1bmN0aW9uJztcbmltcG9ydCB7IGxvd2VyQ2FzZUZpcnN0IH0gZnJvbSAnLi4vY29yZS9mb3JtYXR0aW5nL2xvd2VyLWNhc2UtZmlyc3QuZnVuY3Rpb24nO1xuaW1wb3J0IHsgaXNWYWx1ZSB9IGZyb20gJy4uL2NvcmUvdHlwZS1jaGVjay9pcy12YWx1ZS5mdW5jdGlvbic7XG5pbXBvcnQgeyBzZXRWYWx1ZSB9IGZyb20gJy4uL2NvcmUvb2JqZWN0L3NldC12YWx1ZS5mdW5jdGlvbic7XG5cbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vc2VjdXJpdHkvYXV0aC5zZXJ2aWNlJztcbmltcG9ydCB7IFNlY3VyaXR5Q29uZmlnIH0gZnJvbSAnLi4vc2VjdXJpdHkvc2VjdXJpdHktY29uZmlnJztcbmltcG9ydCB7IFJvbGVNYW5hZ2VyU2VydmljZSB9IGZyb20gJy4uL3NlY3VyaXR5L3JvbGUtbWFuYWdlci5zZXJ2aWNlJztcbmltcG9ydCB7IFVzZXJBY2NvdW50IH0gZnJvbSAnLi4vc2VjdXJpdHkvdXNlci1hY2NvdW50JztcblxuaW1wb3J0IHsgQXBwUHJvZmlsZVNlcnZpY2UgfSBmcm9tICcuL2FwcC1wcm9maWxlLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXBwQ29uZmlnIH0gZnJvbSAnLi9hcHAuY29uZmlnJztcbmltcG9ydCB7IEFwcFByb2ZpbGUgfSBmcm9tICcuL2FwcC1wcm9maWxlJztcblxuXG5pbnRlcmZhY2UgTW9kdWxlQ29uZmlnSW5zdGFuY2VNYXAge1xuICBpbnN0YW5jZTogYW55O1xuICBjb25maWc6IEF1dG9Db25maWdEYXRhO1xufVxuXG5cbi8qKlxuICogQXBwbGljYXRpb24gaW5pdGlhbGl6YXRpb24gc2VydmljZSB0aGF0IGlzIHJlc3BvbnNpYmxlIGZvciBib290c3RyYXBwaW5nXG4gKiB0aGUgYXBwbGljYXRpb24uXG4gKi9cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIEFwcEluaXRpYWxpemVyU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IHRva2VuRXhwaXJlRGF0ZUtleSA9ICd0b2tlbi1leHBpcmUtZGF0ZSc7XG5cbiAgcmVhZHkgPSBmYWxzZTtcbiAgbG9hZGluZyA9IGZhbHNlO1xuICBvblJlYWR5OiBQcm9taXNlPEFwcFByb2ZpbGU+O1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgbW9kdWxlQ29uZmlnSW5zdGFuY2VzID0gbmV3IE1hcDxzdHJpbmcsIE1vZHVsZUNvbmZpZ0luc3RhbmNlTWFwPigpO1xuICBwcml2YXRlIHJlYWRvbmx5IHF1ZXJ5UGFyYW1ldGVyczogYW55O1xuICBwcml2YXRlIHJlc29sdmVGbjogKHZhbHVlPzogQXBwUHJvZmlsZSB8IFByb21pc2VMaWtlPEFwcFByb2ZpbGU+KSA9PiB2b2lkO1xuICBwcml2YXRlIHJlamVjdEZuOiAocmVhc29uPzogYW55KSA9PiB2b2lkO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSBhdXRoOiBBdXRoU2VydmljZSxcbiAgICBwcml2YXRlIGFwcFByb2ZpbGVzOiBBcHBQcm9maWxlU2VydmljZSxcbiAgICBwcml2YXRlIGxvZzogTG9nZ2VyLFxuICAgIHByaXZhdGUgY29uZmlnOiBBcHBDb25maWcsXG4gICAgcHJpdmF0ZSBzdG9yYWdlOiBQZXJzaXN0ZW50U3RvcmFnZSxcbiAgICBwcml2YXRlIHNlY3VyaXR5Q29uZmlnOiBTZWN1cml0eUNvbmZpZyxcbiAgICBwcml2YXRlIHJvbGVNZ3I6IFJvbGVNYW5hZ2VyU2VydmljZSxcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvclxuICApIHtcbiAgICB0aGlzLnF1ZXJ5UGFyYW1ldGVycyA9IGdldFF1ZXJ5UGFyYW1zKCk7XG4gICAgdGhpcy5vblJlYWR5ID0gbmV3IFByb21pc2U8QXBwUHJvZmlsZT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5yZXNvbHZlRm4gPSByZXNvbHZlO1xuICAgICAgdGhpcy5yZWplY3RGbiA9IHJlamVjdDtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcy9ib290c3RyYXBzIGEgc3RhbmRhcmQgVFNTIGFwcGxpY2F0aW9uLlxuICAgKi9cbiAgaW5pdGlhbGl6ZSgpOiB2b2lkIHtcbiAgICBjb25zdCBhcHBJZDogc3RyaW5nID0gdGhpcy5jb25maWcuYXBwSWQ7XG4gICAgY29uc3QgW2ZpcnN0Um91dGVQYXRoXSA9IHRoaXMucm91dGVyLnVybC5zcGxpdCgnLycpO1xuICAgIGNvbnN0IHByb2ZpbGVJZDogc3RyaW5nID0gdGhpcy5xdWVyeVBhcmFtZXRlcnMucHJvZmlsZUlkXG4gICAgICB8fCBmaXJzdFJvdXRlUGF0aFxuICAgICAgfHwgZ2V0Rmlyc3RIYXNoUm91dGVQYXRoKGdldEZ1bGxVcmwoKSlcbiAgICAgIHx8IHRoaXMuY29uZmlnLmRlZmF1bHRQcm9maWxlSWQ7XG5cbiAgICAvLyBXZSBvdmVycmlkZSBtb2R1bGUgY29uZmlndXJhdGlvbnMgaGVyZSBiZWNhdXNlIHRoZSB1c2VyIG1heSBiZSB0cnlpbmcgdG8gZGVidWcgdGhlIHNlc3Npb24uIFRoZVxuICAgIC8vIG92ZXJyaWRlIGhhcyB0byBoYXBwZW4gYWdhaW4gYXQgdGhlIGVuZCBvZiB0aGUgcHJvY2VzcyB0byBvdmVycmlkZSBhbnkgc2V0dGluZ3MgdGhhdCBtYXkgaGF2ZVxuICAgIC8vIGJlZW4gc2V0IHRocm91Z2ggdGhlIGFwcCBpbml0aWFsaXphdGlvbiBwcm9jZXNzLlxuICAgIHRoaXMub3ZlcnJpZGVNb2R1bGVDb25maWd1cmF0aW9uc0Zyb21RdWVyeVBhcmFtcygpO1xuXG4gICAgdGhpcy5sb2cuZGVidWcoYEluaXRpYWxpemluZyBhcHBsaWNhdGlvbiB3aXRoIHByb2ZpbGUgSUQ6ICR7cHJvZmlsZUlkfWApO1xuXG4gICAgLy8gV2UgbmVlZCB0byB0cnkgYW5kIHJlYWQgYW55IHN0b3JlZCBzZWN1cml0eSB0b2tlbiBiZWZvcmUgd2UgbWFrZVxuICAgIC8vIGEgcmVxdWVzdCB0byBnZXQgcHJvZmlsZSBpbmZvLCBzbyB0aGF0IHRoZSByZXF1ZXN0IGlzIGF1dGhlbnRpY2F0ZWQuXG4gICAgdGhpcy5hdXRoLmxvYWRTdG9yZWRUb2tlbigpO1xuICAgIHRoaXMucG9wdWxhdGVNb2R1bGVDb25maWdJbnN0YW5jZXMoKTtcblxuICAgIGlmICghdGhpcy5jb25maWcucXVlcnlQcm9maWxlIHx8ICF0aGlzLmNvbmZpZy5oYXNTZXJ2aWNlVXJsKSB7XG4gICAgICB0aGlzLmNvbmZpZy5wcm9maWxlID0ge1xuICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgYXBwSWQsXG4gICAgICAgIGlkOiBwcm9maWxlSWQsXG4gICAgICB9O1xuXG4gICAgICB0aGlzLmxvZy5kZWJ1Zyh0aGlzLmNvbmZpZy5oYXNTZXJ2aWNlVXJsXG4gICAgICAgID8gYFByb2ZpbGUgcXVlcnkgc2tpcHBlZCBkdWUgdG8gY29uZmlndXJhdGlvbiBvcHRpb25gXG4gICAgICAgIDogYE5vIHNlcnZpY2UgVVJMIGNvbmZpZ3VyZWQsIGNhbid0IHJldHJpZXZlIHByb2ZpbGUgZGV0YWlscyAtIHNraXBwaW5nIHByb2ZpbGUgcmV0cmlldmFsYCk7XG5cbiAgICAgIHRoaXMub3ZlcnJpZGVNb2R1bGVDb25maWd1cmF0aW9uc0Zyb21RdWVyeVBhcmFtcygpO1xuICAgICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gICAgICB0aGlzLnJlc29sdmVGbih0aGlzLmNvbmZpZy5wcm9maWxlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcblxuICAgICAgLy8gV2UgbmVlZCB0byB0cnkgYW5kIHJlYWQgYW55IHN0b3JlZCBzZWN1cml0eSB0b2tlbiBiZWZvcmUgd2UgbWFrZVxuICAgICAgLy8gYSByZXF1ZXN0IHRvIGdldCBwcm9maWxlIGluZm8sIHNvIHRoYXQgdGhlIHJlcXVlc3QgaXMgYXV0aGVudGljYXRlZC5cbiAgICAgIHRoaXMucXVlcnlQcm9maWxlKHByb2ZpbGVJZClcbiAgICAgICAgLnRoZW4oKHByb2ZpbGU6IEFwcFByb2ZpbGUpID0+IHRoaXMucmVzb2x2ZUZuKHByb2ZpbGUpKVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5jb250aW51ZU9uQXBwQm9vdHN0cmFwRXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZUZuKHRoaXMuY29uZmlnLnByb2ZpbGUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlamVjdEZuKGVycik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHF1ZXJ5UHJvZmlsZShwcm9maWxlSWQ6IHN0cmluZyk6IFByb21pc2U8QXBwUHJvZmlsZT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmFwcFByb2ZpbGVzLmdldChwcm9maWxlSWQpXG4gICAgICAgIC5zdWJzY3JpYmUoKHByb2ZpbGUpID0+IHtcbiAgICAgICAgICBpZiAoIXByb2ZpbGUpIHtcbiAgICAgICAgICAgIHJldHVybiByZWplY3QoYE5vIHByb2ZpbGUgZm91bmQgd2l0aCBJRCAnJHtwcm9maWxlSWR9J2ApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuY29uZmlnLnByb2ZpbGVJZCA9IHByb2ZpbGUuaWQ7XG4gICAgICAgICAgdGhpcy5jb25maWcucHJvZmlsZSA9IHByb2ZpbGU7XG5cbiAgICAgICAgICB0aGlzLmNoZWNrVG9rZW5JbnZhbGlkYXRpb25EYXRlKCk7XG4gICAgICAgICAgdGhpcy5hcHBseU1vZHVsZUNvbmZpZ3VyYXRpb25zKCk7XG4gICAgICAgICAgdGhpcy5vdmVycmlkZU1vZHVsZUNvbmZpZ3VyYXRpb25zRnJvbVF1ZXJ5UGFyYW1zKCk7XG4gICAgICAgICAgdGhpcy5yZXRyaWV2ZVVzZXJBY2NvdW50KClcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5jb25maWd1cmVSb2xlTWFuYWdlcigpO1xuICAgICAgICAgICAgICB0aGlzLnJlYWR5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgIHJlc29sdmUocHJvZmlsZSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIChlcnIpID0+IHtcbiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLmxvZy5lcnJvcihgRmFpbGVkIHRvIHJldHJpZXZlIGFwcGxpY2F0aW9uIHByb2ZpbGUgd2l0aCBhcHAgSUQgJyR7dGhpcy5jb25maWcuYXBwSWR9JyBhbmQgSUQgJyR7cHJvZmlsZUlkfSdgKTtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgZGF0ZSBvZiB0aGUgY2FjaGVkIFwiaW52YWxpZGF0aW9uXCIgZGF0ZS5cbiAgICogVGhlIGludmFsaWRhdGlvbiBkYXRlIGlzIHVzZWQgdG8gbGV0IHRoZSBzZXJ2ZXIgZm9yY2UgdXNlcnMgdG8gcmUtYXV0aGVudGljYXRlLlxuICAgKi9cbiAgcHJpdmF0ZSBnZXRDYWNoZWRUb2tlbkludmFsaWRhdGlvbkRhdGUoKTogRGF0ZSB7XG4gICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMuc3RvcmFnZS5nZXQodGhpcy5zZWN1cml0eUNvbmZpZy50b2tlbkludmFsaWRhdGlvbkRhdGVMb29rdXApKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWNoZXMgdGhlIFwiaW52YWxpZGF0aW9uXCIgZGF0ZS5cbiAgICogVGhlIGludmFsaWRhdGlvbiBkYXRlIGlzIHVzZWQgdG8gbGV0IHRoZSBzZXJ2ZXIgZm9yY2UgdXNlcnMgdG8gcmUtYXV0aGVudGljYXRlLlxuICAgKi9cbiAgcHJpdmF0ZSBzZXRDYWNoZWRUb2tlbkV4cGlyZURhdGUoc2V0RGF0ZT86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMubG9nLmRlYnVnKGBTZXR0aW5nIGNhY2hlZCB0b2tlbiBpbnZhbGlkYXRpb24gZGF0ZTogJHtzZXREYXRlfWApO1xuXG4gICAgaWYgKHNldERhdGUpIHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGBTZXR0aW5nIHRva2VuIGludmFsaWRhdGlvbiBkYXRlIHRvOiAke3NldERhdGV9YCk7XG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0KHRoaXMuc2VjdXJpdHlDb25maWcudG9rZW5JbnZhbGlkYXRpb25EYXRlTG9va3VwLCBzZXREYXRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdG9yYWdlLnJlbW92ZSh0aGlzLnNlY3VyaXR5Q29uZmlnLnRva2VuSW52YWxpZGF0aW9uRGF0ZUxvb2t1cCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbXBhcmVzIHRoZSBjYWNoZWQgdG9rZW4gdmFsaWRhdGlvbiBkYXRhIHdpdGggdGhlIGludmFsaWRhdGlvbiBkYXRlIGZyb20gdGhlIHNlcnZlci5cbiAgICogSWYgdGhlIGludmFsaWRhdGlvbiBkYXRlIGZyb20gdGhlIHNlcnZlciBpcyBuZXcgdGhhbiB0aGUgY2FjaGVkIGRhdGUsIHRoZW4gdGhlIHVzZXJcbiAgICogbXVzdCBiZSBmb3JjaWJseSBzaWduZWQgb3V0LlxuICAgKi9cbiAgcHJpdmF0ZSBjaGVja1Rva2VuSW52YWxpZGF0aW9uRGF0ZSgpOiB2b2lkIHtcbiAgICBsZXQgdG9rZW5FeHBpcmVEYXRlO1xuICAgIGNvbnN0IHNpdGVJbmZvID0gdGhpcy5jb25maWcucHJvZmlsZSAmJiB0aGlzLmNvbmZpZy5wcm9maWxlLmFwcCAmJiB0aGlzLmNvbmZpZy5wcm9maWxlLmFwcC5zaXRlSW5mb1xuICAgICAgPyB0aGlzLmNvbmZpZy5wcm9maWxlLmFwcC5zaXRlSW5mb1xuICAgICAgOiBudWxsO1xuXG4gICAgaWYgKHNpdGVJbmZvICYmIHNpdGVJbmZvW0FwcEluaXRpYWxpemVyU2VydmljZS50b2tlbkV4cGlyZURhdGVLZXldKSB7XG4gICAgICBjb25zdCBsYXN0VG9rZW5JbnZhbGlkYXRlRGF0ZSA9IHRoaXMuZ2V0Q2FjaGVkVG9rZW5JbnZhbGlkYXRpb25EYXRlKCk7XG4gICAgICB0b2tlbkV4cGlyZURhdGUgPSBuZXcgRGF0ZShzaXRlSW5mb1tBcHBJbml0aWFsaXplclNlcnZpY2UudG9rZW5FeHBpcmVEYXRlS2V5XSk7XG5cbiAgICAgIC8vIE5vdGUsIHdlIGFyZSBzZXR0aW5nIG1pbGxpc2Vjb25kcyB0byAwIGJlY2F1c2Ugd2UgZG9uJ3QgY2FyZSBhYm91dCB0aGF0IGxldmVsIG9mIGFjY3VyYWN5LlxuICAgICAgLy8gQWxzbywgdGhlIFwic2V0TWlsbGlzZWNvbmRzXCIgbWV0aG9kIHJldHVybnMgdGhlIFwidGltZXN0YW1wXCIgc28gd2UgY2FuIGp1c3QgY29tcGFyZSB0aG9zZSB0d28gcmVzdWx0cy5cbiAgICAgIGNvbnN0IGxhc3RUb2tlblZhbGlkYXRpb25EYXRlc01hdGNoID0gaXNEYXRlKGxhc3RUb2tlbkludmFsaWRhdGVEYXRlKSAmJiBpc0RhdGUodG9rZW5FeHBpcmVEYXRlKVxuICAgICAgICA/IGxhc3RUb2tlbkludmFsaWRhdGVEYXRlLnNldE1pbGxpc2Vjb25kcygwKSA9PT0gdG9rZW5FeHBpcmVEYXRlLnNldE1pbGxpc2Vjb25kcygwKVxuICAgICAgICA6IGxhc3RUb2tlbkludmFsaWRhdGVEYXRlID09PSB0b2tlbkV4cGlyZURhdGU7XG5cbiAgICAgIGlmICh0aGlzLmF1dGguYWNjb3VudCAmJiB0aGlzLmF1dGguYWNjb3VudC5sYXN0U2lnbkluIDwgdG9rZW5FeHBpcmVEYXRlICYmICFsYXN0VG9rZW5WYWxpZGF0aW9uRGF0ZXNNYXRjaCkge1xuICAgICAgICB0aGlzLmxvZy5pbmZvKCdTaWduaW5nIG91dCB1c2VyIGR1ZSB0byB0b2tlbiBpbnZhbGlkYXRpb24gZGF0ZSBmcm9tIHNlY3VyaXR5IGNvbmZpZ3VyYXRpb24nKTtcbiAgICAgICAgdGhpcy5hdXRoLm9uU2lnbmVkT3V0KCk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuYXV0aC5hY2NvdW50KSB7XG4gICAgICAgIHRoaXMubG9nLmRlYnVnKCdVc2VyIGhhcyBiZWVuIGF1dGhlbnRpY2F0ZWQgYWZ0ZXIgdGhlIHRva2VuIGludmFsaWRhdGlvbiBkYXRlJyk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0b2tlbkV4cGlyZURhdGUpIHtcbiAgICAgICAgdGhpcy5zZXRDYWNoZWRUb2tlbkV4cGlyZURhdGUodG9rZW5FeHBpcmVEYXRlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSB1c2VyIGFjY291bnQgaWYgdGhlIHVzZXIgaXMgYWxyZWFkeSBzaWduZWQgaW4sIGxvZ3MgdGhlIHVzZXIgb3V0IGlmXG4gICAqIHRoZSB0b2tlbiBpcyBleHBpcmVkLCBvciByZWZyZXNoZXMgdGhlIHVzZXIgYWNjb3VudCBpbmZvcm1hdGlvbiAtIGRlcGVuZGluZyBvblxuICAgKiB0aGUgY29uZmlndXJlZCBhdXRoZW50aWNhdGlvbiBwcm92aWRlci5cbiAgICovXG4gIHByaXZhdGUgcmV0cmlldmVVc2VyQWNjb3VudCgpOiBQcm9taXNlPFVzZXJBY2NvdW50PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCBxdWVyeWluZ0luZm8gPSBmYWxzZTtcbiAgICAgICAgY29uc3QgYXBwID0gdGhpcy5jb25maWcucHJvZmlsZSAmJiB0aGlzLmNvbmZpZy5wcm9maWxlLmFwcFxuICAgICAgICAgID8gdGhpcy5jb25maWcucHJvZmlsZS5hcHAgOiBudWxsO1xuXG4gICAgICAgIC8vIElmIHRoZSBsb2NhbCBhdXRoIHN0YXR1cyBzYXlzIHRoYXQgbm8gb25lIGlzIGxvZ2dlZCBpbiwgYnV0IHRoZSBzZXJ2aWNlIGlzIHJlY29nbml6aW5nIHRoYXQgc29tZW9uZSBpc1xuICAgICAgICAvLyBsb2dnZWQgaW4sIHRoZW4gdGhpcyBtZWFucyB0aGF0IGF1dGhlbnRpY2F0aW9uIGlzIGhhcHBlbmluZyB0aHJvdWdoIHdpbmRvd3MgdmlhIEFjdGl2ZSBEaXJlY3Rvcnkgb3Igc29tZVxuICAgICAgICAvLyBvdGhlciBtZWFucy4gV2UgbmVlZCB0byBnZXQgdGhlIHVzZXIgaW5mbyBzbyB3ZSBjYW4gc2V0IHRoZSBhcHAgXCJzdGF0ZVwiIGFzIFwibG9nZ2VkIGluXCIuXG4gICAgICAgIGlmIChhcHAgJiYgYXBwLnNlY3VyaXR5ICYmICF0aGlzLmF1dGguaXNBdXRoZW50aWNhdGVkICYmIGFwcC5zZWN1cml0eS5pc0F1dGhlbnRpY2F0ZWQpIHtcbiAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnUmV0cmlldmluZyBhZGRpdGlvbmFsIHVzZXIgaW5mbyBkbyB0byBhdXRoZW50aWNhdGlvbiBzdGF0ZScpO1xuICAgICAgICAgIHF1ZXJ5aW5nSW5mbyA9IHRydWU7XG4gICAgICAgICAgdGhpcy5hdXRoLmdldFVzZXJJbmZvKCkuc3Vic2NyaWJlKGluZm8gPT4ge1xuICAgICAgICAgICAgY29uc3QgZXhwaXJlc0RhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgZXhwaXJlc0RhdGUuc2V0RGF0ZShleHBpcmVzRGF0ZS5nZXREYXRlKCkgKyBhcHAuc2VjdXJpdHkuYWNjZXNzVG9rZW5FeHBpcmVEYXlzKTtcbiAgICAgICAgICAgIHRoaXMuYXV0aC5vblNpZ25lZEluKE9iamVjdC5hc3NpZ24oeyAnLmV4cGlyZXMnOiBleHBpcmVzRGF0ZSB9LCBpbmZvKSk7XG4gICAgICAgICAgICByZXNvbHZlKGluZm8pO1xuICAgICAgICAgIH0sIGVyciA9PiB7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmF1dGguaXNBdXRoZW50aWNhdGVkICYmIGFwcC5zZWN1cml0eSAmJiAhYXBwLnNlY3VyaXR5LmlzQXV0aGVudGljYXRlZCkge1xuICAgICAgICAgIHRoaXMubG9nLmRlYnVnKGBTaWduaW5nIG91dCB1c2VyIGRvIHRvIG91dCBvZiBzeW5jIGF1dGhlbnRpY2F0aW9uIHN0YXRlYCk7XG4gICAgICAgICAgLy8gU2lnbiBvdXQvY2xlYXIgdGhlIGF1dGggY2FjaGUgYmVjYXVzZSB0aGUgc2VydmVyIHNheXMgdGhleSBkb24ndCBrbm93IHdobyB0aGlzIGlzLCBidXRcbiAgICAgICAgICAvLyB0aGUgY2xpZW50IHNpZGUgY29kZSB0aGlua3MgaXQga25vd3Mgd2hvIGl0IGlzLlxuICAgICAgICAgIHRoaXMuYXV0aC5vblNpZ25lZE91dCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFxdWVyeWluZ0luZm8pIHtcbiAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhgTm8gcmVxdWVzdCBtYWRlIGZvciBhZGRpdGlvbmFsIHVzZXIgYWNjb3VudCBpbmZvYCk7XG4gICAgICAgICAgcmVzb2x2ZSh0aGlzLmF1dGguYWNjb3VudCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhpcy5sb2cuZXJyb3IoJ0ZhaWxlZCB0byBkbyBwcmUtdmVyaWZpY2F0aW9uIG9mIHVzZXIgb24gYXBwIGxvYWQuIHswfScsIGUpO1xuICAgICAgICByZWplY3QoZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IG1vZHVsZSBjb25maWd1cmF0aW9uIHByb3BlcnRpZXMgYmFzZWQgb24gb3ZlcnJpZGVzIGZyb20gYW4gb2JqZWN0LlxuICAgKiBUaGlzIG9iamVjdCBjYW4gY29tZSBmcm9tIG11bHRpcGxlIHBsYWNlcyAtIHN1Y2ggYXMgdGhlIHNlcnZlciBvciBxdWVyeSBwYXJhbXMuXG4gICAqIFNlZTogdGhlIFwiYXBwbHlNb2R1bGVDb25maWd1cmF0aW9uc1wiIGFuZCBcIm92ZXJyaWRlTW9kdWxlQ29uZmlndXJhdGlvbnNcIiBtZXRob2RzLlxuICAgKi9cbiAgcHJpdmF0ZSBhcHBseU1vZHVsZUNvbmZpZ3VyYXRpb25zRnJvbU9iamVjdChzb3VyY2VNYXBwaW5nOiBhbnkpIHtcbiAgICBzb3VyY2VNYXBwaW5nID0gc291cmNlTWFwcGluZyB8fCB7fTtcbiAgICB0aGlzLm1vZHVsZUNvbmZpZ0luc3RhbmNlc1xuICAgICAgLmZvckVhY2goY29uZmlnID0+IHtcbiAgICAgICAgY29uc3QgbW9kdWxlQ29uZmlnTmFtZSA9IGNvbmZpZy5jb25maWcuY2xhc3NOYW1lO1xuICAgICAgICBjb25zdCBjb25maWdJbnN0YW5jZSA9IGNvbmZpZy5pbnN0YW5jZTtcblxuICAgICAgICBPYmplY3Qua2V5cyhzb3VyY2VNYXBwaW5nKVxuICAgICAgICAgIC5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdG9QcmltaXRpdmVUeXBlKHNvdXJjZU1hcHBpbmdba2V5XSk7XG4gICAgICAgICAgICBjb25zdCBtb2R1bGVQcmVmaXggPSBsb3dlckNhc2VGaXJzdChtb2R1bGVDb25maWdOYW1lICsgJy4nKTtcbiAgICAgICAgICAgIGNvbnN0IHJvb3RLZXkgPSBrZXkucmVwbGFjZShtb2R1bGVQcmVmaXgsICcnKTsgLy8gVHVybiBhcHBDb25maWcuZm9vLmJhciAtLT4gZm9vLmJhclxuXG4gICAgICAgICAgICBpZiAoaXNWYWx1ZSh2YWx1ZSkgJiYga2V5LnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChtb2R1bGVQcmVmaXgudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgICAgICAgLy8gQSBjb25maWcgb2JqZWN0IGhhcyBwcm9wZXJ0aWVzIGluIG91ciBzaXRlSW5mbyBvYmplY3QuXG4gICAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKGBTZXR0aW5nICR7bW9kdWxlQ29uZmlnTmFtZX0gcHJvcGVydHkgJyR7cm9vdEtleX0nIHRvICR7dmFsdWV9YCk7XG4gICAgICAgICAgICAgIHNldFZhbHVlKGNvbmZpZ0luc3RhbmNlLCByb290S2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgbW9kdWxlIGNvbmZpZ3VyYXRpb24gcHJvcGVydGllcyBiYXNlZCBvbiBvdmVycmlkZXMgZnJvbSB0aGUgc2VydmVyLlxuICAgKiBUaGlzIGZ1bmN0aW9uYWxpdHkgbGV0cyB1cyBkeW5hbWljYWxseSBvdmVycmlkZSBjbGllbnQgc2lkZSBjb25maWd1cmF0aW9uXG4gICAqIHRocm91Z2ggdGhlIHVzZSBvZiBcIkFwcCBTZXR0aW5nc1wiIGZyb20gdGhlIHNlcnZlci5cbiAgICovXG4gIHByaXZhdGUgYXBwbHlNb2R1bGVDb25maWd1cmF0aW9ucygpOiB2b2lkIHtcbiAgICBjb25zdCBwcm9maWxlID0gdGhpcy5jb25maWcucHJvZmlsZTtcbiAgICBpZiAoIXByb2ZpbGUgfHwgIXByb2ZpbGUuYXBwIHx8ICFwcm9maWxlLmFwcC5zaXRlSW5mbykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYXBwbHlNb2R1bGVDb25maWd1cmF0aW9uc0Zyb21PYmplY3QocHJvZmlsZS5hcHAuc2l0ZUluZm8pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBtb2R1bGUgY29uZmlndXJhdGlvbiBwcm9wZXJ0aWVzIGJhc2VkIG9uIG92ZXJyaWRlcyBmcm9tIHRoZSBVUkwgcXVlcnkgcGFyYW1ldGVycy5cbiAgICogVGhpcyBmdW5jdGlvbmFsaXR5IGxldHMgdXMgZHluYW1pY2FsbHkgb3ZlcnJpZGUgY2xpZW50IHNpZGUgYW5kIHNlcnZlciBzaWRlIGNvbmZpZ3VyYXRpb25zXG4gICAqIGJ5IHBhc3NpbmcgZXhwbGljaXQgc2V0dGluZ3MgdGhyb3VnaCBxdWVyeSBwYXJhbWV0ZXJzLiBBIGdvb2QgdXNlIGNhc2UgZm9yIHRoaXMgaXMgdG8gcGFzc1xuICAgKiBcImNvcmVDb25maWcubG9nTGV2ZWw9MVwiIGFzIGEgcXVlcnkgcGFyYW1ldGVyIGluIHByb2R1Y3Rpb24gdG8gZGVidWcgYW4gaXNzdWUgaW4gYSBwcm9kdWN0aW9uXG4gICAqIGVudmlyb25tZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBvdmVycmlkZU1vZHVsZUNvbmZpZ3VyYXRpb25zRnJvbVF1ZXJ5UGFyYW1zKCkge1xuICAgIGlmICh0aGlzLmNvbmZpZy5hbGxvd1F1ZXJ5UGFyYW1JbmplY3Rpb25zKSB7XG4gICAgICB0aGlzLmFwcGx5TW9kdWxlQ29uZmlndXJhdGlvbnNGcm9tT2JqZWN0KHRoaXMucXVlcnlQYXJhbWV0ZXJzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5zdGFudGlhdGVzIGluc3RhbmNlcyBvZiBlYWNoIGNvbmZpZ3VyZWQgbW9kdWxlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LiBQcm9wZXJ0aWVzIG9mXG4gICAqIHRoZXNlIG1vZHVsZSBjb25maWcgaW5zdGFuY2VzIHdpbGwgbGF0ZXIgYmUgc2V0IGJhc2VkIG9uIHNlcnZlci1zaWRlIG92ZXJpZGVzLlxuICAgKi9cbiAgcHJpdmF0ZSBwb3B1bGF0ZU1vZHVsZUNvbmZpZ0luc3RhbmNlcygpOiB2b2lkIHtcbiAgICBDb3JlQ29uZmlnLm1vZHVsZUNvbmZpZ3NcbiAgICAgIC5mb3JFYWNoKG1vZHVsZUF1dG9Db25maWcgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIFJlYXNvbjogaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci9pc3N1ZXMvMjIwNjNcbiAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgICAgICBjb25zdCBjb25maWdJbnN0YW5jZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KG1vZHVsZUF1dG9Db25maWcuaW5qZWN0b3JUb2tlbik7XG4gICAgICAgICAgdGhpcy5tb2R1bGVDb25maWdJbnN0YW5jZXMuc2V0KG1vZHVsZUF1dG9Db25maWcuaW5qZWN0b3JUb2tlbiwge1xuICAgICAgICAgICAgaW5zdGFuY2U6IGNvbmZpZ0luc3RhbmNlLFxuICAgICAgICAgICAgY29uZmlnOiBtb2R1bGVBdXRvQ29uZmlnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5sb2cuZGVidWcoYENyZWF0ZWQgbW9kdWxlIGNvbmZpZ3VyYXRpb24gaW5zdGFuY2UgZm9yOiAke21vZHVsZUF1dG9Db25maWcuY2xhc3NOYW1lfWApO1xuXG4gICAgICAgICAgaWYgKCdzZXJ2aWNlVXJsJyBpbiBjb25maWdJbnN0YW5jZSB8fCAnaGFzU2VydmljZVVybCcgaW4gY29uZmlnSW5zdGFuY2UpIHtcbiAgICAgICAgICAgIGNvbmZpZ0luc3RhbmNlLnNlcnZpY2VVcmwgPSB0aGlzLmNvbmZpZy5zZXJ2aWNlVXJsO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgdGhpcy5sb2cuZXJyb3IoYEZhaWxlZCB0byBnZXQgbW9kdWxlIGNvbmZpZzogJHttb2R1bGVBdXRvQ29uZmlnLmNsYXNzTmFtZX1gLCBlcnIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHNlY3VyaXR5IG9wdGlvbnMgYmFzZWQgb24gaW5mb3JtYXRpb24gcmV0cmlldmVkIGZvcm0gdGhlIGFwcGxpY2F0aW9uIHByb2ZpbGUuXG4gICAqIEZvciBleGFtcGxlLCBzZWN1cml0eSBtYXkgYmUgZW5hYmxlZCBvciBkaXNhYmxlZCwgZ3Vlc3Qgcm9sZXMgd2lsbCBiZSBzZXQsIGV0Yy5cbiAgICovXG4gIHByaXZhdGUgY29uZmlndXJlUm9sZU1hbmFnZXIoKTogdm9pZCB7XG4gICAgY29uc3Qgc2VjdXJpdHkgPSB0aGlzLmNvbmZpZy5wcm9maWxlICYmIHRoaXMuY29uZmlnLnByb2ZpbGUuYXBwICYmIHRoaXMuY29uZmlnLnByb2ZpbGUuYXBwLnNlY3VyaXR5XG4gICAgICA/IHRoaXMuY29uZmlnLnByb2ZpbGUuYXBwLnNlY3VyaXR5IDogbnVsbDtcblxuICAgIGlmICghc2VjdXJpdHkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBXZSB3YW50IHRvIGV4cGxpY2l0bHlcbiAgICBpZiAoc2VjdXJpdHkuaGFzT3duUHJvcGVydHkoJ2VuYWJsZWQnKSkge1xuICAgICAgdGhpcy5zZWN1cml0eUNvbmZpZy5yb2xlc0VuYWJsZWQgPSAhIXNlY3VyaXR5LmVuYWJsZWQ7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnJvbGVNZ3IuZW5hYmxlZCkge1xuICAgICAgdGhpcy5sb2cud2FybignU2VjdXJpdHkgaXMgZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICBzZWN1cml0eS5ndWVzdFByaXZpbGVnZXMgPSBzZWN1cml0eS5ndWVzdFByaXZpbGVnZXMgfHwgW107XG4gICAgdGhpcy5yb2xlTWdyLmFkZFJvbGVzKHNlY3VyaXR5Lmd1ZXN0UHJpdmlsZWdlcyk7XG4gICAgdGhpcy5sb2cuaW5mbyhgQ29uZmlndXJlZCBkZWZhdWx0IHJvbGVzIChndWVzdCByb2xlcykgLSB0b3RhbCBvZiAke3NlY3VyaXR5Lmd1ZXN0UHJpdmlsZWdlcy5sZW5ndGh9YCk7XG4gICAgdGhpcy5sb2cuaW5mbyhgVXNlciBoYXMgYSB0b3RhbCBvZiAke3RoaXMucm9sZU1nci5yb2xlQ291bnR9IHJvbGVzIGFzc2lnbmVkIHRvIHRoZW1gKTtcbiAgfVxufVxuXG4vKipcbiAqIEFwcGxpY2F0aW9uIGluaXRpYWxpemF0aW9uIGZhY3RvcnkgdGhhdCBwcm92aWRlcyBhIGhvb2sgaW50b1xuICogdGhlIEFuZ3VsYXIgYm9vdHN0cmFwcGluZyBwcm9jZXNzLlxuICovXG5leHBvcnQgZnVuY3Rpb24gQXBwSW5pdGlhbGl6ZXJGYWN0b3J5KGluamVjdG9yOiBJbmplY3Rvcik6ICgpID0+IFByb21pc2U8YW55PiB7XG4gIHJldHVybiAoKTogUHJvbWlzZTxBcHBQcm9maWxlPiA9PiB7XG4gICAgY29uc3QgaW5pdGlhbGl6ZXI6IEFwcEluaXRpYWxpemVyU2VydmljZSA9IGluamVjdG9yLmdldChBcHBJbml0aWFsaXplclNlcnZpY2UpO1xuICAgIGluaXRpYWxpemVyLmluaXRpYWxpemUoKTtcblxuICAgIHJldHVybiBpbml0aWFsaXplci5vblJlYWR5O1xuICB9O1xufVxuIl19