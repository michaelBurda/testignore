/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { isFunction } from '../type-check/is-function.function';
import { errorMsg } from '../error/error-msg.function';
/**
 * @abstract
 * @template T
 */
var /**
 * @abstract
 * @template T
 */
BaseNotificationTracker = /** @class */ (function () {
    function BaseNotificationTracker(notify, log, config) {
        if (config === void 0) { config = { logErrors: true }; }
        this.notify = notify;
        this.log = log;
        this.config = config;
        this.eventWatchers = [];
    }
    /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    BaseNotificationTracker.prototype.wait = /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    function (message, title, config) {
        this.waitResponse = this.notify.wait(message, title, config);
        // This method needs implemented in each implementation.
        this.emit('wait');
        return this;
    };
    /**
     * @param {?} predicate
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    BaseNotificationTracker.prototype.waitIf = /**
     * @param {?} predicate
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    function (predicate, message, title, config) {
        /** @type {?} */
        var doWait = isFunction(predicate)
            ? ((/** @type {?} */ (predicate)))()
            : Boolean(predicate);
        return doWait ? this.wait(message, title, config) : this;
    };
    /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    BaseNotificationTracker.prototype.success = /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    function (message, title, config) {
        this.config.showSuccess = true;
        this.config.successMsg = message;
        this.config.successTitle = title;
        this.config.successConfiguration = config;
        this.emit('success');
        return this;
    };
    /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    BaseNotificationTracker.prototype.error = /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    function (message, title, config) {
        this.config.showError = true;
        this.config.errorMsg = message;
        this.config.errorTitle = title;
        this.config.errorConfiguration = config;
        this.emit('error');
        return this;
    };
    /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    BaseNotificationTracker.prototype.warn = /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    function (message, title, config) {
        this.config.showWarn = true;
        this.config.warnMsg = message;
        this.config.warnTitle = title;
        this.config.warnConfiguration = config;
        this.emit('warn');
        return this;
    };
    /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    BaseNotificationTracker.prototype.info = /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    function (message, title, config) {
        this.config.showInfo = true;
        this.config.infoMsg = message;
        this.config.infoTitle = title;
        this.config.infoConfiguration = config;
        this.emit('info');
        return this;
    };
    /**
     * @param {?} onDone
     * @return {?}
     */
    BaseNotificationTracker.prototype.finally = /**
     * @param {?} onDone
     * @return {?}
     */
    function (onDone) {
        this.onDone = onDone;
        this.emit('finally');
        return this;
    };
    /**
     * @param {?} eventType
     * @param {?} callback
     * @return {?}
     */
    BaseNotificationTracker.prototype.on = /**
     * @param {?} eventType
     * @param {?} callback
     * @return {?}
     */
    function (eventType, callback) {
        this.eventWatchers.push({ eventType: eventType, callback: callback });
    };
    /**
     * @protected
     * @param {?} eventType
     * @param {?=} event
     * @return {?}
     */
    BaseNotificationTracker.prototype.emit = /**
     * @protected
     * @param {?} eventType
     * @param {?=} event
     * @return {?}
     */
    function (eventType, event) {
        this.eventWatchers
            .filter((/**
         * @param {?} watcher
         * @return {?}
         */
        function (watcher) { return watcher.eventType === eventType; }))
            .forEach((/**
         * @param {?} watcher
         * @return {?}
         */
        function (watcher) { return watcher.callback(event); }));
    };
    /**
     * @protected
     * @param {?=} response
     * @return {?}
     */
    BaseNotificationTracker.prototype.done = /**
     * @protected
     * @param {?=} response
     * @return {?}
     */
    function (response) {
        if (this.waitResponse) {
            this.notify.clear(this.waitResponse.notifyId, this.waitResponse.containerId);
        }
        if (this.onDone) {
            this.onDone(response);
        }
    };
    /**
     * @protected
     * @param {?} response
     * @return {?}
     */
    BaseNotificationTracker.prototype.onSuccess = /**
     * @protected
     * @param {?} response
     * @return {?}
     */
    function (response) {
        if (this.config.showSuccess) {
            this.notify.success(this.config.successMsg, this.config.successTitle, this.config.successConfiguration);
        }
        if (this.config.showInfo) {
            this.notify.info(this.config.infoMsg, this.config.infoTitle, this.config.infoConfiguration);
        }
        this.done(response);
    };
    /**
     * @protected
     * @param {?} error
     * @return {?}
     */
    BaseNotificationTracker.prototype.onFail = /**
     * @protected
     * @param {?} error
     * @return {?}
     */
    function (error) {
        /** @type {?} */
        var responseError = (error.error || error) || error;
        /** @type {?} */
        var msg = errorMsg(this.config.errorMsg, responseError);
        if (this.log && this.config.logErrors) {
            this.log.error(msg);
        }
        if (this.config.showError) {
            this.notify.error(msg, this.config.errorTitle, responseError, this.config.errorConfiguration);
        }
        if (this.config.showWarn) {
            this.notify.warn(msg, this.config.infoTitle, this.config.warnConfiguration);
        }
        this.done();
    };
    return BaseNotificationTracker;
}());
/**
 * @abstract
 * @template T
 */
export { BaseNotificationTracker };
if (false) {
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.onDone;
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.waitResponse;
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.eventWatchers;
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.notify;
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.log;
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.config;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1ub3RpZmljYXRpb24tdHJhY2tlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0c3Mvc2RrLyIsInNvdXJjZXMiOlsibGliL2NvcmUvbm90aWZ5L2Jhc2Utbm90aWZpY2F0aW9uLXRyYWNrZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQU1BLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7Ozs7O0FBR3ZEOzs7OztJQVFFLGlDQUFzQixNQUFxQixFQUFZLEdBQVksRUFBWSxNQUFnRDtRQUFoRCx1QkFBQSxFQUFBLFdBQStCLFNBQVMsRUFBRSxJQUFJLEVBQUU7UUFBekcsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUFZLFFBQUcsR0FBSCxHQUFHLENBQVM7UUFBWSxXQUFNLEdBQU4sTUFBTSxDQUEwQztRQUxySCxrQkFBYSxHQUdqQixFQUFFLENBQUM7SUFHVCxDQUFDOzs7Ozs7O0lBRUQsc0NBQUk7Ozs7OztJQUFKLFVBQUssT0FBZSxFQUFFLEtBQWMsRUFBRSxNQUFZO1FBQ2hELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztRQUU3RCx3REFBd0Q7UUFDeEQsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNsQixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Ozs7Ozs7O0lBRUQsd0NBQU07Ozs7Ozs7SUFBTixVQUFPLFNBQW9DLEVBQUUsT0FBZSxFQUFFLEtBQWMsRUFBRSxNQUFZOztZQUNsRixNQUFNLEdBQUcsVUFBVSxDQUFDLFNBQVMsQ0FBQztZQUNsQyxDQUFDLENBQUMsQ0FBQyxtQkFBQSxTQUFTLEVBQWlCLENBQUMsRUFBRTtZQUNoQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQztRQUV0QixPQUFPLE1B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OztZQUMvQyxHQUFHLEdBQVcsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLGFBQWEsQ0FBQztRQUVqRSxJQUFJLElBQUksQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUU7WUFDckMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDckI7UUFFRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFO1lBQ3pCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxhQUFhLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1NBQy9GO1FBRUQsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRTtZQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1NBQzdFO1FBRUQsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUNILDhCQUFDO0FBQUQsQ0FBQyxBQXZIRCxJQXVIQzs7Ozs7Ozs7Ozs7SUF0SEMseUNBQXlFOzs7OztJQUN6RSwrQ0FBdUM7Ozs7O0lBQ3ZDLGdEQUdTOzs7OztJQUVHLHlDQUErQjs7Ozs7SUFBRSxzQ0FBc0I7Ozs7O0lBQUUseUNBQTBEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTm90aWZpY2F0aW9uVHJhY2tlciB9IGZyb20gJy4vbm90aWZpY2F0aW9uLXRyYWNrZXInO1xuaW1wb3J0IHsgTm90aWZ5UmVzcG9uc2UgfSBmcm9tICcuL25vdGlmeS1yZXNwb25zZSc7XG5pbXBvcnQgeyBOb3RpZnlFdmVudFR5cGUgfSBmcm9tICcuL25vdGlmeS1ldmVudC10eXBlJztcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICcuL25vdGlmeS5zZXJ2aWNlJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL2xvZ2dpbmcvbG9nZ2VyLnNlcnZpY2UnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uQ29uZmlnIH0gZnJvbSAnLi9ub3RpZmljYXRpb24tY29uZmlnJztcbmltcG9ydCB7IGlzRnVuY3Rpb24gfSBmcm9tICcuLi90eXBlLWNoZWNrL2lzLWZ1bmN0aW9uLmZ1bmN0aW9uJztcbmltcG9ydCB7IGVycm9yTXNnIH0gZnJvbSAnLi4vZXJyb3IvZXJyb3ItbXNnLmZ1bmN0aW9uJztcblxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFzZU5vdGlmaWNhdGlvblRyYWNrZXI8VD4gaW1wbGVtZW50cyBOb3RpZmljYXRpb25UcmFja2VyPFQ+IHtcbiAgcHJvdGVjdGVkIG9uRG9uZTogKHZhbHVlOiBUIHwgdW5kZWZpbmVkIHwgbnVsbCB8IFByb21pc2VMaWtlPFQ+KSA9PiB2b2lkO1xuICBwcm90ZWN0ZWQgd2FpdFJlc3BvbnNlOiBOb3RpZnlSZXNwb25zZTtcbiAgcHJvdGVjdGVkIGV2ZW50V2F0Y2hlcnM6IHtcbiAgICBldmVudFR5cGU6IE5vdGlmeUV2ZW50VHlwZSxcbiAgICBjYWxsYmFjazogKChlPzogYW55KSA9PiB2b2lkKVxuICB9W10gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgbm90aWZ5OiBOb3RpZnlTZXJ2aWNlLCBwcm90ZWN0ZWQgbG9nPzogTG9nZ2VyLCBwcm90ZWN0ZWQgY29uZmlnOiBOb3RpZmljYXRpb25Db25maWcgPSB7IGxvZ0Vycm9yczogdHJ1ZSB9KSB7XG4gIH1cblxuICB3YWl0KG1lc3NhZ2U6IHN0cmluZywgdGl0bGU/OiBzdHJpbmcsIGNvbmZpZz86IGFueSk6IE5vdGlmaWNhdGlvblRyYWNrZXI8VD4ge1xuICAgIHRoaXMud2FpdFJlc3BvbnNlID0gdGhpcy5ub3RpZnkud2FpdChtZXNzYWdlLCB0aXRsZSwgY29uZmlnKTtcblxuICAgIC8vIFRoaXMgbWV0aG9kIG5lZWRzIGltcGxlbWVudGVkIGluIGVhY2ggaW1wbGVtZW50YXRpb24uXG4gICAgdGhpcy5lbWl0KCd3YWl0Jyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB3YWl0SWYocHJlZGljYXRlOiBib29sZWFuIHwgKCgpID0+IGJvb2xlYW4pLCBtZXNzYWdlOiBzdHJpbmcsIHRpdGxlPzogc3RyaW5nLCBjb25maWc/OiBhbnkpOiBOb3RpZmljYXRpb25UcmFja2VyPFQ+IHtcbiAgICBjb25zdCBkb1dhaXQgPSBpc0Z1bmN0aW9uKHByZWRpY2F0ZSlcbiAgICAgID8gKHByZWRpY2F0ZSBhcyAoKSA9PiBib29sZWFuKSgpXG4gICAgICA6IEJvb2xlYW4ocHJlZGljYXRlKTtcblxuICAgIHJldHVybiBkb1dhaXQgPyB0aGlzLndhaXQobWVzc2FnZSwgdGl0bGUsIGNvbmZpZykgOiB0aGlzO1xuICB9XG5cbiAgc3VjY2VzcyhtZXNzYWdlOiBzdHJpbmcsIHRpdGxlPzogc3RyaW5nLCBjb25maWc/OiBhbnkpOiBOb3RpZmljYXRpb25UcmFja2VyPFQ+IHtcbiAgICB0aGlzLmNvbmZpZy5zaG93U3VjY2VzcyA9IHRydWU7XG4gICAgdGhpcy5jb25maWcuc3VjY2Vzc01zZyA9IG1lc3NhZ2U7XG4gICAgdGhpcy5jb25maWcuc3VjY2Vzc1RpdGxlID0gdGl0bGU7XG4gICAgdGhpcy5jb25maWcuc3VjY2Vzc0NvbmZpZ3VyYXRpb24gPSBjb25maWc7XG4gICAgdGhpcy5lbWl0KCdzdWNjZXNzJyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBlcnJvcihtZXNzYWdlOiBzdHJpbmcsIHRpdGxlPzogc3RyaW5nLCBjb25maWc/OiBhbnkpOiBOb3RpZmljYXRpb25UcmFja2VyPFQ+IHtcbiAgICB0aGlzLmNvbmZpZy5zaG93RXJyb3IgPSB0cnVlO1xuICAgIHRoaXMuY29uZmlnLmVycm9yTXNnID0gbWVzc2FnZTtcbiAgICB0aGlzLmNvbmZpZy5lcnJvclRpdGxlID0gdGl0bGU7XG4gICAgdGhpcy5jb25maWcuZXJyb3JDb25maWd1cmF0aW9uID0gY29uZmlnO1xuICAgIHRoaXMuZW1pdCgnZXJyb3InKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHdhcm4obWVzc2FnZTogc3RyaW5nLCB0aXRsZT86IHN0cmluZywgY29uZmlnPzogYW55KTogTm90aWZpY2F0aW9uVHJhY2tlcjxUPiB7XG4gICAgdGhpcy5jb25maWcuc2hvd1dhcm4gPSB0cnVlO1xuICAgIHRoaXMuY29uZmlnLndhcm5Nc2cgPSBtZXNzYWdlO1xuICAgIHRoaXMuY29uZmlnLndhcm5UaXRsZSA9IHRpdGxlO1xuICAgIHRoaXMuY29uZmlnLndhcm5Db25maWd1cmF0aW9uID0gY29uZmlnO1xuICAgIHRoaXMuZW1pdCgnd2FybicpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaW5mbyhtZXNzYWdlOiBzdHJpbmcsIHRpdGxlPzogc3RyaW5nLCBjb25maWc/OiBhbnkpOiBOb3RpZmljYXRpb25UcmFja2VyPFQ+IHtcbiAgICB0aGlzLmNvbmZpZy5zaG93SW5mbyA9IHRydWU7XG4gICAgdGhpcy5jb25maWcuaW5mb01zZyA9IG1lc3NhZ2U7XG4gICAgdGhpcy5jb25maWcuaW5mb1RpdGxlID0gdGl0bGU7XG4gICAgdGhpcy5jb25maWcuaW5mb0NvbmZpZ3VyYXRpb24gPSBjb25maWc7XG4gICAgdGhpcy5lbWl0KCdpbmZvJyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBmaW5hbGx5KG9uRG9uZTogKHZhbHVlOiBUIHwgdW5kZWZpbmVkIHwgbnVsbCB8IFByb21pc2VMaWtlPFQ+KSA9PiB2b2lkKTogTm90aWZpY2F0aW9uVHJhY2tlcjxUPiB7XG4gICAgdGhpcy5vbkRvbmUgPSBvbkRvbmU7XG4gICAgdGhpcy5lbWl0KCdmaW5hbGx5Jyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBvbihldmVudFR5cGU6IE5vdGlmeUV2ZW50VHlwZSwgY2FsbGJhY2s6IChlPzogYW55KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5ldmVudFdhdGNoZXJzLnB1c2goeyBldmVudFR5cGUsIGNhbGxiYWNrIH0pO1xuICB9XG5cbiAgcHJvdGVjdGVkIGVtaXQoZXZlbnRUeXBlOiBOb3RpZnlFdmVudFR5cGUsIGV2ZW50PzogYW55KSB7XG4gICAgdGhpcy5ldmVudFdhdGNoZXJzXG4gICAgICAuZmlsdGVyKHdhdGNoZXIgPT4gd2F0Y2hlci5ldmVudFR5cGUgPT09IGV2ZW50VHlwZSlcbiAgICAgIC5mb3JFYWNoKHdhdGNoZXIgPT4gd2F0Y2hlci5jYWxsYmFjayhldmVudCkpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGRvbmUocmVzcG9uc2U/OiBhbnkpIHtcbiAgICBpZiAodGhpcy53YWl0UmVzcG9uc2UpIHtcbiAgICAgIHRoaXMubm90aWZ5LmNsZWFyKHRoaXMud2FpdFJlc3BvbnNlLm5vdGlmeUlkLCB0aGlzLndhaXRSZXNwb25zZS5jb250YWluZXJJZCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub25Eb25lKSB7XG4gICAgICB0aGlzLm9uRG9uZShyZXNwb25zZSk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIG9uU3VjY2VzcyhyZXNwb25zZTogYW55KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY29uZmlnLnNob3dTdWNjZXNzKSB7XG4gICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuY29uZmlnLnN1Y2Nlc3NNc2csIHRoaXMuY29uZmlnLnN1Y2Nlc3NUaXRsZSwgdGhpcy5jb25maWcuc3VjY2Vzc0NvbmZpZ3VyYXRpb24pO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbmZpZy5zaG93SW5mbykge1xuICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmNvbmZpZy5pbmZvTXNnLCB0aGlzLmNvbmZpZy5pbmZvVGl0bGUsIHRoaXMuY29uZmlnLmluZm9Db25maWd1cmF0aW9uKTtcbiAgICB9XG5cbiAgICB0aGlzLmRvbmUocmVzcG9uc2UpO1xuICB9XG5cbiAgcHJvdGVjdGVkIG9uRmFpbChlcnJvcjogYW55KTogdm9pZCB7XG4gICAgY29uc3QgcmVzcG9uc2VFcnJvciA9IChlcnJvci5lcnJvciB8fCBlcnJvcikgfHwgZXJyb3I7XG4gICAgY29uc3QgbXNnOiBzdHJpbmcgPSBlcnJvck1zZyh0aGlzLmNvbmZpZy5lcnJvck1zZywgcmVzcG9uc2VFcnJvcik7XG5cbiAgICBpZiAodGhpcy5sb2cgJiYgdGhpcy5jb25maWcubG9nRXJyb3JzKSB7XG4gICAgICB0aGlzLmxvZy5lcnJvcihtc2cpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbmZpZy5zaG93RXJyb3IpIHtcbiAgICAgIHRoaXMubm90aWZ5LmVycm9yKG1zZywgdGhpcy5jb25maWcuZXJyb3JUaXRsZSwgcmVzcG9uc2VFcnJvciwgdGhpcy5jb25maWcuZXJyb3JDb25maWd1cmF0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb25maWcuc2hvd1dhcm4pIHtcbiAgICAgIHRoaXMubm90aWZ5Lndhcm4obXNnLCB0aGlzLmNvbmZpZy5pbmZvVGl0bGUsIHRoaXMuY29uZmlnLndhcm5Db25maWd1cmF0aW9uKTtcbiAgICB9XG5cbiAgICB0aGlzLmRvbmUoKTtcbiAgfVxufVxuIl19