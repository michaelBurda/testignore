/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { isFieldValueNumeric } from './fields/layer-field';
/** @type {?} */
export var FIELD_QUOTE = '"';
/** @enum {string} */
var CriteriaOperator = {
    Equals: '=',
    DoesNotEqual: '<>',
    // In = 'IN',
    // OneOf, NotOneOf, Between, NotBetween, Contains...
    GreaterThan: '>',
    LessThan: '<',
    GreaterOrEqualTo: '>=',
    LessThanOrEqualTo: '<=',
};
export { CriteriaOperator };
/** @enum {string} */
var TargetOperator = {
    Is: 'IS',
    Not: 'NOT',
    In: 'IN',
    Like: 'LIKE',
    Between: 'BETWEEN',
};
export { TargetOperator };
/** @enum {string} */
var ValueOperator = {
    Wildcard: '%',
    Null: 'NULL',
};
export { ValueOperator };
/** @enum {string} */
var GroupingOperator = {
    OpenParenthesis: '(',
    ClosedParenthesis: ')',
    Parenthesis: '()',
};
export { GroupingOperator };
/** @enum {string} */
var CombiningOperator = {
    And: 'AND',
    Or: 'OR',
};
export { CombiningOperator };
/**
 * @record
 */
export function WhereClauseBuilderOptions() { }
if (false) {
    /** @type {?|undefined} */
    WhereClauseBuilderOptions.prototype.quoteFields;
}
/** @type {?} */
export var DefaultWhereClauseBuilderOptions = {
    quoteFields: true
};
var WhereClauseBuilder = /** @class */ (function () {
    function WhereClauseBuilder(options) {
        this.statements = [];
        this.options = Object.assign({}, DefaultWhereClauseBuilderOptions, options);
    }
    Object.defineProperty(WhereClauseBuilder.prototype, "criteriaCount", {
        get: /**
         * @return {?}
         */
        function () {
            return this.statements.length;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} statement
     * @return {THIS}
     */
    WhereClauseBuilder.prototype.add = /**
     * @template THIS
     * @this {THIS}
     * @param {?} statement
     * @return {THIS}
     */
    function (statement) {
        (/** @type {?} */ (this)).statements.push(statement);
        return (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    WhereClauseBuilder.prototype.whereEqual = /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    function (field, value) {
        return value === null
            ? (/** @type {?} */ (this)).whereIsNull(field.name)
            : (/** @type {?} */ (this)).where(field.name, CriteriaOperator.Equals, value, isFieldValueNumeric(field, value));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    WhereClauseBuilder.prototype.whereLike = /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    function (field, value) {
        return (/** @type {?} */ (this)).add((/** @type {?} */ (this)).formatField(field) + " " + TargetOperator.Like + " '%" + value + "%'");
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    WhereClauseBuilder.prototype.whereStartsWith = /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    function (field, value) {
        return (/** @type {?} */ (this)).add((/** @type {?} */ (this)).formatField(field) + " " + TargetOperator.Like + " '" + value + "%'");
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    WhereClauseBuilder.prototype.whereEndsWith = /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    function (field, value) {
        return (/** @type {?} */ (this)).add((/** @type {?} */ (this)).formatField(field) + " " + TargetOperator.Like + " '%" + value + "'");
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    WhereClauseBuilder.prototype.whereNotEqual = /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    function (field, value) {
        return value === null
            ? (/** @type {?} */ (this)).whereIsNotNull(field.name)
            : (/** @type {?} */ (this)).where(field.name, CriteriaOperator.DoesNotEqual, value, isFieldValueNumeric(field, value));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @return {THIS}
     */
    WhereClauseBuilder.prototype.whereIsNull = /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @return {THIS}
     */
    function (field) {
        return (/** @type {?} */ (this)).add((/** @type {?} */ (this)).formatField(field) + " " + TargetOperator.Is + " " + ValueOperator.Null);
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @return {THIS}
     */
    WhereClauseBuilder.prototype.whereIsNotNull = /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @return {THIS}
     */
    function (field) {
        return (/** @type {?} */ (this)).add((/** @type {?} */ (this)).formatField(field) + " " + TargetOperator.Is + " " + TargetOperator.Not + " " + ValueOperator.Null);
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} operator
     * @param {?} value
     * @param {?=} isNumeric
     * @return {THIS}
     */
    WhereClauseBuilder.prototype.where = /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} operator
     * @param {?} value
     * @param {?=} isNumeric
     * @return {THIS}
     */
    function (field, operator, value, isNumeric) {
        if (isNumeric === void 0) { isNumeric = false; }
        value = isNumeric ? value : "'" + value + "'";
        (/** @type {?} */ (this)).add("" + (/** @type {?} */ (this)).formatField(field) + operator + value);
        return (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    WhereClauseBuilder.prototype.whereNumeric = /**
     * @template THIS
     * @this {THIS}
     * @param {?} field
     * @param {?} value
     * @return {THIS}
     */
    function (field, value) {
        (/** @type {?} */ (this)).where(field, value, true);
        return (/** @type {?} */ (this));
    };
    /**
     * @return {?}
     */
    WhereClauseBuilder.prototype.toWhereClause = /**
     * @return {?}
     */
    function () {
        return this.statements.join(" " + CombiningOperator.And + " ");
    };
    /**
     * @return {?}
     */
    WhereClauseBuilder.prototype.toString = /**
     * @return {?}
     */
    function () {
        return this.toWhereClause();
    };
    /**
     * @return {?}
     */
    WhereClauseBuilder.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.statements.length = 0;
    };
    /**
     * @protected
     * @param {?} field
     * @return {?}
     */
    WhereClauseBuilder.prototype.formatField = /**
     * @protected
     * @param {?} field
     * @return {?}
     */
    function (field) {
        field = field || '';
        /** @type {?} */
        var addQuotes = this.options.quoteFields;
        if (addQuotes) {
            if (!field.startsWith(FIELD_QUOTE)) {
                field = "" + FIELD_QUOTE + field;
            }
            if (!field.endsWith(FIELD_QUOTE)) {
                field = "" + field + FIELD_QUOTE;
            }
        }
        else {
            /** @type {?} */
            var quoteRegex = new RegExp(FIELD_QUOTE, 'i');
            return field.replace(quoteRegex, '');
        }
        return field;
    };
    return WhereClauseBuilder;
}());
export { WhereClauseBuilder };
if (false) {
    /**
     * @type {?}
     * @private
     */
    WhereClauseBuilder.prototype.statements;
    /**
     * @type {?}
     * @private
     */
    WhereClauseBuilder.prototype.options;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2hlcmUtY2xhdXNlLWJ1aWxkZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdHNzL3Nkay8iLCJzb3VyY2VzIjpbImxpYi9tYXBzL3doZXJlLWNsYXVzZS1idWlsZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWMsbUJBQW1CLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7QUFHdkUsTUFBTSxLQUFPLFdBQVcsR0FBRyxHQUFHOzs7SUFFNUIsUUFBUyxHQUFHO0lBQ1osY0FBZSxJQUFJO0lBQ25CLGFBQWE7SUFDYixvREFBb0Q7SUFDcEQsYUFBYyxHQUFHO0lBQ2pCLFVBQVcsR0FBRztJQUNkLGtCQUFtQixJQUFJO0lBQ3ZCLG1CQUFvQixJQUFJOzs7OztJQUl4QixJQUFLLElBQUk7SUFDVCxLQUFNLEtBQUs7SUFDWCxJQUFLLElBQUk7SUFDVCxNQUFPLE1BQU07SUFDYixTQUFVLFNBQVM7Ozs7O0lBSW5CLFVBQVcsR0FBRztJQUNkLE1BQU8sTUFBTTs7Ozs7SUFJYixpQkFBa0IsR0FBRztJQUNyQixtQkFBb0IsR0FBRztJQUN2QixhQUFjLElBQUk7Ozs7O0lBSWxCLEtBQU0sS0FBSztJQUNYLElBQUssSUFBSTs7Ozs7O0FBR1gsK0NBRUM7OztJQURDLGdEQUFzQjs7O0FBR3hCLE1BQU0sS0FBTyxnQ0FBZ0MsR0FBRztJQUM5QyxXQUFXLEVBQUUsSUFBSTtDQUNsQjtBQUVEO0lBSUUsNEJBQVksT0FBbUM7UUFIOUIsZUFBVSxHQUFhLEVBQUUsQ0FBQztRQUl6QyxJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLGdDQUFnQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzlFLENBQUM7SUFFRCxzQkFBSSw2Q0FBYTs7OztRQUFqQjtZQUNFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7UUFDaEMsQ0FBQzs7O09BQUE7Ozs7Ozs7SUFFRCxnQ0FBRzs7Ozs7O0lBQUgsVUFBSSxT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SyxHQUFHLFdBQWEsQ0FBQzthQUNsQztTQUNGO2FBQU07O2dCQUNDLFVBQVUsR0FBRyxJQUFJLE1BQU0sQ0FBQyxXQUFXLEVBQUUsR0FBRyxDQUFDO1lBQy9DLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLENBQUM7U0FDdEM7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFDSCx5QkFBQztBQUFELENBQUMsQUEzRkQsSUEyRkM7Ozs7Ozs7SUExRkMsd0NBQTJDOzs7OztJQUMzQyxxQ0FBb0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMYXllckZpZWxkLCBpc0ZpZWxkVmFsdWVOdW1lcmljIH0gZnJvbSAnLi9maWVsZHMvbGF5ZXItZmllbGQnO1xuXG5cbmV4cG9ydCBjb25zdCBGSUVMRF9RVU9URSA9ICdcIic7XG5leHBvcnQgZW51bSBDcml0ZXJpYU9wZXJhdG9yIHtcbiAgRXF1YWxzID0gJz0nLFxuICBEb2VzTm90RXF1YWwgPSAnPD4nLFxuICAvLyBJbiA9ICdJTicsXG4gIC8vIE9uZU9mLCBOb3RPbmVPZiwgQmV0d2VlbiwgTm90QmV0d2VlbiwgQ29udGFpbnMuLi5cbiAgR3JlYXRlclRoYW4gPSAnPicsXG4gIExlc3NUaGFuID0gJzwnLFxuICBHcmVhdGVyT3JFcXVhbFRvID0gJz49JyxcbiAgTGVzc1RoYW5PckVxdWFsVG8gPSAnPD0nLFxufVxuXG5leHBvcnQgZW51bSBUYXJnZXRPcGVyYXRvciB7XG4gIElzID0gJ0lTJyxcbiAgTm90ID0gJ05PVCcsXG4gIEluID0gJ0lOJyxcbiAgTGlrZSA9ICdMSUtFJyxcbiAgQmV0d2VlbiA9ICdCRVRXRUVOJyxcbn1cblxuZXhwb3J0IGVudW0gVmFsdWVPcGVyYXRvciB7XG4gIFdpbGRjYXJkID0gJyUnLFxuICBOdWxsID0gJ05VTEwnLFxufVxuXG5leHBvcnQgZW51bSBHcm91cGluZ09wZXJhdG9yIHtcbiAgT3BlblBhcmVudGhlc2lzID0gJygnLFxuICBDbG9zZWRQYXJlbnRoZXNpcyA9ICcpJyxcbiAgUGFyZW50aGVzaXMgPSAnKCknLFxufVxuXG5leHBvcnQgZW51bSBDb21iaW5pbmdPcGVyYXRvciB7XG4gIEFuZCA9ICdBTkQnLFxuICBPciA9ICdPUicsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV2hlcmVDbGF1c2VCdWlsZGVyT3B0aW9ucyB7XG4gIHF1b3RlRmllbGRzPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNvbnN0IERlZmF1bHRXaGVyZUNsYXVzZUJ1aWxkZXJPcHRpb25zID0ge1xuICBxdW90ZUZpZWxkczogdHJ1ZVxufTtcblxuZXhwb3J0IGNsYXNzIFdoZXJlQ2xhdXNlQnVpbGRlciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgc3RhdGVtZW50czogc3RyaW5nW10gPSBbXTtcbiAgcHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBXaGVyZUNsYXVzZUJ1aWxkZXJPcHRpb25zO1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM/OiBXaGVyZUNsYXVzZUJ1aWxkZXJPcHRpb25zKSB7XG4gICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgRGVmYXVsdFdoZXJlQ2xhdXNlQnVpbGRlck9wdGlvbnMsIG9wdGlvbnMpO1xuICB9XG5cbiAgZ2V0IGNyaXRlcmlhQ291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZW1lbnRzLmxlbmd0aDtcbiAgfVxuXG4gIGFkZChzdGF0ZW1lbnQ6IHN0cmluZyk6IHRoaXMge1xuICAgIHRoaXMuc3RhdGVtZW50cy5wdXNoKHN0YXRlbWVudCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB3aGVyZUVxdWFsKGZpZWxkOiBMYXllckZpZWxkLCB2YWx1ZTogYW55KTogdGhpcyB7XG4gICAgcmV0dXJuIHZhbHVlID09PSBudWxsXG4gICAgICA/IHRoaXMud2hlcmVJc051bGwoZmllbGQubmFtZSlcbiAgICAgIDogdGhpcy53aGVyZShmaWVsZC5uYW1lLCBDcml0ZXJpYU9wZXJhdG9yLkVxdWFscywgdmFsdWUsIGlzRmllbGRWYWx1ZU51bWVyaWMoZmllbGQsIHZhbHVlKSk7XG4gIH1cblxuICB3aGVyZUxpa2UoZmllbGQ6IHN0cmluZywgdmFsdWU6IGFueSk6IHRoaXMge1xuICAgIHJldHVybiB0aGlzLmFkZChgJHt0aGlzLmZvcm1hdEZpZWxkKGZpZWxkKX0gJHtUYXJnZXRPcGVyYXRvci5MaWtlfSAnJSR7dmFsdWV9JSdgKTtcbiAgfVxuXG4gIHdoZXJlU3RhcnRzV2l0aChmaWVsZDogc3RyaW5nLCB2YWx1ZTogYW55KTogdGhpcyB7XG4gICAgcmV0dXJuIHRoaXMuYWRkKGAke3RoaXMuZm9ybWF0RmllbGQoZmllbGQpfSAke1RhcmdldE9wZXJhdG9yLkxpa2V9ICcke3ZhbHVlfSUnYCk7XG4gIH1cblxuICB3aGVyZUVuZHNXaXRoKGZpZWxkOiBzdHJpbmcsIHZhbHVlOiBhbnkpOiB0aGlzIHtcbiAgICByZXR1cm4gdGhpcy5hZGQoYCR7dGhpcy5mb3JtYXRGaWVsZChmaWVsZCl9ICR7VGFyZ2V0T3BlcmF0b3IuTGlrZX0gJyUke3ZhbHVlfSdgKTtcbiAgfVxuXG4gIHdoZXJlTm90RXF1YWwoZmllbGQ6IExheWVyRmllbGQsIHZhbHVlOiBhbnkpOiB0aGlzIHtcbiAgICByZXR1cm4gdmFsdWUgPT09IG51bGxcbiAgICAgID8gdGhpcy53aGVyZUlzTm90TnVsbChmaWVsZC5uYW1lKVxuICAgICAgOiB0aGlzLndoZXJlKGZpZWxkLm5hbWUsIENyaXRlcmlhT3BlcmF0b3IuRG9lc05vdEVxdWFsLCB2YWx1ZSwgaXNGaWVsZFZhbHVlTnVtZXJpYyhmaWVsZCwgdmFsdWUpKTtcbiAgfVxuXG4gIHdoZXJlSXNOdWxsKGZpZWxkOiBzdHJpbmcpOiB0aGlzIHtcbiAgICByZXR1cm4gdGhpcy5hZGQoYCR7dGhpcy5mb3JtYXRGaWVsZChmaWVsZCl9ICR7VGFyZ2V0T3BlcmF0b3IuSXN9ICR7VmFsdWVPcGVyYXRvci5OdWxsfWApO1xuICB9XG5cbiAgd2hlcmVJc05vdE51bGwoZmllbGQ6IHN0cmluZyk6IHRoaXMge1xuICAgIHJldHVybiB0aGlzLmFkZChgJHt0aGlzLmZvcm1hdEZpZWxkKGZpZWxkKX0gJHtUYXJnZXRPcGVyYXRvci5Jc30gJHtUYXJnZXRPcGVyYXRvci5Ob3R9ICR7VmFsdWVPcGVyYXRvci5OdWxsfWApO1xuICB9XG5cbiAgd2hlcmUoZmllbGQ6IHN0cmluZywgb3BlcmF0b3I6IENyaXRlcmlhT3BlcmF0b3IgfCBUYXJnZXRPcGVyYXRvciwgdmFsdWU6IGFueSwgaXNOdW1lcmljID0gZmFsc2UpOiB0aGlzIHtcbiAgICB2YWx1ZSA9IGlzTnVtZXJpYyA/IHZhbHVlIDogYCcke3ZhbHVlfSdgO1xuICAgIHRoaXMuYWRkKGAke3RoaXMuZm9ybWF0RmllbGQoZmllbGQpfSR7b3BlcmF0b3J9JHt2YWx1ZX1gKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHdoZXJlTnVtZXJpYyhmaWVsZDogc3RyaW5nLCB2YWx1ZTogYW55KTogdGhpcyB7XG4gICAgdGhpcy53aGVyZShmaWVsZCwgdmFsdWUsIHRydWUpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdG9XaGVyZUNsYXVzZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnN0YXRlbWVudHMuam9pbihgICR7Q29tYmluaW5nT3BlcmF0b3IuQW5kfSBgKTtcbiAgfVxuXG4gIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMudG9XaGVyZUNsYXVzZSgpO1xuICB9XG5cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5zdGF0ZW1lbnRzLmxlbmd0aCA9IDA7XG4gIH1cblxuICBwcm90ZWN0ZWQgZm9ybWF0RmllbGQoZmllbGQ6IHN0cmluZykge1xuICAgIGZpZWxkID0gZmllbGQgfHwgJyc7XG4gICAgY29uc3QgYWRkUXVvdGVzID0gdGhpcy5vcHRpb25zLnF1b3RlRmllbGRzO1xuXG4gICAgaWYgKGFkZFF1b3Rlcykge1xuICAgICAgaWYgKCFmaWVsZC5zdGFydHNXaXRoKEZJRUxEX1FVT1RFKSkge1xuICAgICAgICBmaWVsZCA9IGAke0ZJRUxEX1FVT1RFfSR7ZmllbGR9YDtcbiAgICAgIH1cblxuICAgICAgaWYgKCFmaWVsZC5lbmRzV2l0aChGSUVMRF9RVU9URSkpIHtcbiAgICAgICAgZmllbGQgPSBgJHtmaWVsZH0ke0ZJRUxEX1FVT1RFfWA7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHF1b3RlUmVnZXggPSBuZXcgUmVnRXhwKEZJRUxEX1FVT1RFLCAnaScpO1xuICAgICAgcmV0dXJuIGZpZWxkLnJlcGxhY2UocXVvdGVSZWdleCwgJycpO1xuICAgIH1cblxuICAgIHJldHVybiBmaWVsZDtcbiAgfVxufVxuIl19