/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// TSS.
import { getMeasureExtent } from '../geometry/geometry/get-measure-extent.function';
import { isLine } from '../geometry/geometry/is-line.function';
import { getIdFieldFieldName, isFieldExpression } from './fields/layer-field';
import { getCodedValueNameOrDefault } from './fields/get-coded-value-name-or-default.function';
import { evaluteFeatureDataExpression } from '../lrs/data/evaluate-feature-data-expression.function';
import { isPoint } from '../geometry/geometry/is-point.function';
import { isPolygon } from '../geometry/geometry/is-polygon.function';
import { WGS_84_SRID } from '../geometry/geometry.constants';
import { clone } from '../core/clone/clone.function';
var MapFeature = /** @class */ (function () {
    function MapFeature(feature, layer, spatialReferenceId) {
        if (spatialReferenceId === void 0) { spatialReferenceId = WGS_84_SRID; }
        this.id = feature.id;
        this.properties = feature.properties;
        this.type = feature.type;
        this.bbox = feature.bbox;
        this.layer = layer;
        this.spatialReferenceId = spatialReferenceId;
        /** @type {?} */
        var idFieldName = this.getIdFieldName();
        this.id = this.id || this.getValue(idFieldName);
        this.displayValue = this.getValue(layer.displayField);
        this.setGeometry(feature.geometry);
    }
    Object.defineProperty(MapFeature.prototype, "layerId", {
        get: /**
         * @return {?}
         */
        function () {
            return this.layer ? this.layer.id : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MapFeature.prototype, "hasZ", {
        get: /**
         * @return {?}
         */
        function () {
            return this.layer.hasZ;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MapFeature.prototype, "hasM", {
        get: /**
         * @return {?}
         */
        function () {
            return this.layer.hasM;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    MapFeature.prototype.getIdFieldName = /**
     * @return {?}
     */
    function () {
        return getIdFieldFieldName(this.layer.fields);
    };
    /**
     * @param {?} fieldNameOrExpression
     * @return {?}
     */
    MapFeature.prototype.getValue = /**
     * @param {?} fieldNameOrExpression
     * @return {?}
     */
    function (fieldNameOrExpression) {
        return isFieldExpression(fieldNameOrExpression)
            ? evaluteFeatureDataExpression(fieldNameOrExpression, this)
            : this.properties && this.properties[fieldNameOrExpression];
    };
    /**
     * @param {?} fieldName
     * @return {?}
     */
    MapFeature.prototype.getCodedValueNameOrDefault = /**
     * @param {?} fieldName
     * @return {?}
     */
    function (fieldName) {
        /** @type {?} */
        var value = this.getValue(fieldName);
        /** @type {?} */
        var field = this.layer.getField(fieldName);
        return getCodedValueNameOrDefault(field, value);
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} fieldName
     * @param {?} value
     * @return {THIS}
     */
    MapFeature.prototype.setValue = /**
     * @template THIS
     * @this {THIS}
     * @param {?} fieldName
     * @param {?} value
     * @return {THIS}
     */
    function (fieldName, value) {
        (/** @type {?} */ (this)).properties[fieldName] = value;
        return (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} id
     * @return {THIS}
     */
    MapFeature.prototype.setId = /**
     * @template THIS
     * @this {THIS}
     * @param {?} id
     * @return {THIS}
     */
    function (id) {
        (/** @type {?} */ (this)).id = id;
        (/** @type {?} */ (this)).setValue(getIdFieldFieldName((/** @type {?} */ (this)).layer.fields), id);
        return (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} geometry
     * @return {THIS}
     */
    MapFeature.prototype.setGeometry = /**
     * @template THIS
     * @this {THIS}
     * @param {?} geometry
     * @return {THIS}
     */
    function (geometry) {
        (/** @type {?} */ (this)).geometry = geometry;
        return (/** @type {?} */ (this)).setGeometryTypeProperties();
    };
    /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    MapFeature.prototype.setMeasureFromGeometry = /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        if ((/** @type {?} */ (this)).geometry) {
            /** @type {?} */
            var extent = getMeasureExtent((/** @type {?} */ (this)).geometry);
            (/** @type {?} */ (this)).fromMeasure = extent.min;
            (/** @type {?} */ (this)).toMeasure = extent.max;
        }
        return (/** @type {?} */ (this));
    };
    /**
     * @return {?}
     */
    MapFeature.prototype.isSpatialReferenceWgs84 = /**
     * @return {?}
     */
    function () {
        return this.spatialReferenceId === WGS_84_SRID;
    };
    /**
     * @return {?}
     */
    MapFeature.prototype.clone = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var copyFeature = clone(this.toFeature());
        return new MapFeature(copyFeature, this.layer);
    };
    /**
     * @return {?}
     */
    MapFeature.prototype.toFeature = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var feature = {
            type: 'Feature',
            geometry: this.geometry,
            properties: this.properties,
            id: this.id,
            bbox: this.bbox,
        };
        return feature;
    };
    /**
     * @return {?}
     */
    MapFeature.prototype.toGeoJson = /**
     * @return {?}
     */
    function () {
        return this.toFeature();
    };
    /**
     * @protected
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    MapFeature.prototype.setGeometryTypeProperties = /**
     * @protected
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        (/** @type {?} */ (this)).isLinear = isLine((/** @type {?} */ (this)).geometry);
        (/** @type {?} */ (this)).isPoint = isPoint((/** @type {?} */ (this)).geometry);
        (/** @type {?} */ (this)).isPolygon = isPolygon((/** @type {?} */ (this)).geometry);
        return (/** @type {?} */ (this));
    };
    return MapFeature;
}());
export { MapFeature };
if (false) {
    /** @type {?} */
    MapFeature.prototype.id;
    /** @type {?} */
    MapFeature.prototype.geometry;
    /** @type {?} */
    MapFeature.prototype.properties;
    /** @type {?} */
    MapFeature.prototype.bbox;
    /** @type {?} */
    MapFeature.prototype.type;
    /** @type {?} */
    MapFeature.prototype.routeId;
    /** @type {?} */
    MapFeature.prototype.fromMeasure;
    /** @type {?} */
    MapFeature.prototype.toMeasure;
    /** @type {?} */
    MapFeature.prototype.layer;
    /** @type {?} */
    MapFeature.prototype.displayValue;
    /** @type {?} */
    MapFeature.prototype.styleValue;
    /** @type {?} */
    MapFeature.prototype.isLinear;
    /** @type {?} */
    MapFeature.prototype.isPoint;
    /** @type {?} */
    MapFeature.prototype.isPolygon;
    /** @type {?} */
    MapFeature.prototype.viewDate;
    /** @type {?} */
    MapFeature.prototype.gdbVersion;
    /** @type {?} */
    MapFeature.prototype.spatialReferenceId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFwLWZlYXR1cmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdHNzL3Nkay8iLCJzb3VyY2VzIjpbImxpYi9tYXBzL21hcC1mZWF0dXJlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBSUEsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDcEYsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQy9ELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzlFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLG1EQUFtRCxDQUFDO0FBQy9GLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLHVEQUF1RCxDQUFDO0FBRXJHLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNqRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFDckUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRTdELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUdyRDtJQWdDRSxvQkFBWSxPQUFnQixFQUFFLEtBQXdCLEVBQUUsa0JBQWdDO1FBQWhDLG1DQUFBLEVBQUEsZ0NBQWdDO1FBQ3RGLElBQUksQ0FBQyxFQUFFLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUM7UUFDckMsSUFBSSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztRQUN6QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsa0JBQWtCLEdBQUcsa0JBQWtCLENBQUM7O1lBRXZDLFdBQVcsR0FBRyxJQUFJLENBQUMsY0FB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dEhDLHdCQUFxQjs7SUFDckIsOEJBQW1COztJQUNuQixnQ0FBOEI7O0lBQzlCLDBCQUFXOztJQUNYLDBCQUFnQjs7SUFFaEIsNkJBQWdCOztJQUNoQixpQ0FBb0I7O0lBQ3BCLCtCQUFrQjs7SUFDbEIsMkJBQXlCOztJQUN6QixrQ0FBa0I7O0lBQ2xCLGdDQUFnQjs7SUFDaEIsOEJBQWtCOztJQUNsQiw2QkFBaUI7O0lBQ2pCLCtCQUFtQjs7SUFDbkIsOEJBQWdCOztJQUNoQixnQ0FBb0I7O0lBQ3BCLHdDQUE0QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIDNyZCBQYXJ0eS5cbmltcG9ydCB7IEZlYXR1cmUsIEdlb21ldHJ5LCBHZW9Kc29uUHJvcGVydGllcywgQkJveCB9IGZyb20gJ2dlb2pzb24nO1xuXG4vLyBUU1MuXG5pbXBvcnQgeyBnZXRNZWFzdXJlRXh0ZW50IH0gZnJvbSAnLi4vZ2VvbWV0cnkvZ2VvbWV0cnkvZ2V0LW1lYXN1cmUtZXh0ZW50LmZ1bmN0aW9uJztcbmltcG9ydCB7IGlzTGluZSB9IGZyb20gJy4uL2dlb21ldHJ5L2dlb21ldHJ5L2lzLWxpbmUuZnVuY3Rpb24nO1xuaW1wb3J0IHsgZ2V0SWRGaWVsZEZpZWxkTmFtZSwgaXNGaWVsZEV4cHJlc3Npb24gfSBmcm9tICcuL2ZpZWxkcy9sYXllci1maWVsZCc7XG5pbXBvcnQgeyBnZXRDb2RlZFZhbHVlTmFtZU9yRGVmYXVsdCB9IGZyb20gJy4vZmllbGRzL2dldC1jb2RlZC12YWx1ZS1uYW1lLW9yLWRlZmF1bHQuZnVuY3Rpb24nO1xuaW1wb3J0IHsgZXZhbHV0ZUZlYXR1cmVEYXRhRXhwcmVzc2lvbiB9IGZyb20gJy4uL2xycy9kYXRhL2V2YWx1YXRlLWZlYXR1cmUtZGF0YS1leHByZXNzaW9uLmZ1bmN0aW9uJztcbmltcG9ydCB7IEZlYXR1cmVDbGFzc0xheWVyIH0gZnJvbSAnLi9mZWF0dXJlLWNsYXNzLWxheWVyJztcbmltcG9ydCB7IGlzUG9pbnQgfSBmcm9tICcuLi9nZW9tZXRyeS9nZW9tZXRyeS9pcy1wb2ludC5mdW5jdGlvbic7XG5pbXBvcnQgeyBpc1BvbHlnb24gfSBmcm9tICcuLi9nZW9tZXRyeS9nZW9tZXRyeS9pcy1wb2x5Z29uLmZ1bmN0aW9uJztcbmltcG9ydCB7IFdHU184NF9TUklEIH0gZnJvbSAnLi4vZ2VvbWV0cnkvZ2VvbWV0cnkuY29uc3RhbnRzJztcbmltcG9ydCB7IENsb25lYWJsZSB9IGZyb20gJy4uL2NvcmUvY2xvbmUvY2xvbmVhYmxlJztcbmltcG9ydCB7IGNsb25lIH0gZnJvbSAnLi4vY29yZS9jbG9uZS9jbG9uZS5mdW5jdGlvbic7XG5cblxuZXhwb3J0IGNsYXNzIE1hcEZlYXR1cmUgaW1wbGVtZW50cyBGZWF0dXJlLCBDbG9uZWFibGU8TWFwRmVhdHVyZT4ge1xuICBpZD86IHN0cmluZyB8IG51bWJlcjtcbiAgZ2VvbWV0cnk6IEdlb21ldHJ5O1xuICBwcm9wZXJ0aWVzOiBHZW9Kc29uUHJvcGVydGllcztcbiAgYmJveDogQkJveDtcbiAgdHlwZTogJ0ZlYXR1cmUnO1xuXG4gIHJvdXRlSWQ6IHN0cmluZztcbiAgZnJvbU1lYXN1cmU6IG51bWJlcjtcbiAgdG9NZWFzdXJlOiBudW1iZXI7XG4gIGxheWVyOiBGZWF0dXJlQ2xhc3NMYXllcjtcbiAgZGlzcGxheVZhbHVlOiBhbnk7XG4gIHN0eWxlVmFsdWU6IGFueTtcbiAgaXNMaW5lYXI6IGJvb2xlYW47XG4gIGlzUG9pbnQ6IGJvb2xlYW47XG4gIGlzUG9seWdvbjogYm9vbGVhbjtcbiAgdmlld0RhdGU/OiBEYXRlO1xuICBnZGJWZXJzaW9uPzogc3RyaW5nO1xuICBzcGF0aWFsUmVmZXJlbmNlSWQ/OiBudW1iZXI7XG5cbiAgZ2V0IGxheWVySWQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5sYXllciA/IHRoaXMubGF5ZXIuaWQgOiBudWxsO1xuICB9XG5cbiAgZ2V0IGhhc1ooKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMubGF5ZXIuaGFzWjtcbiAgfVxuXG4gIGdldCBoYXNNKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmxheWVyLmhhc007XG4gIH1cblxuICBjb25zdHJ1Y3RvcihmZWF0dXJlOiBGZWF0dXJlLCBsYXllcjogRmVhdHVyZUNsYXNzTGF5ZXIsIHNwYXRpYWxSZWZlcmVuY2VJZCA9IFdHU184NF9TUklEKSB7XG4gICAgdGhpcy5pZCA9IGZlYXR1cmUuaWQ7XG4gICAgdGhpcy5wcm9wZXJ0aWVzID0gZmVhdHVyZS5wcm9wZXJ0aWVzO1xuICAgIHRoaXMudHlwZSA9IGZlYXR1cmUudHlwZTtcbiAgICB0aGlzLmJib3ggPSBmZWF0dXJlLmJib3g7XG4gICAgdGhpcy5sYXllciA9IGxheWVyO1xuICAgIHRoaXMuc3BhdGlhbFJlZmVyZW5jZUlkID0gc3BhdGlhbFJlZmVyZW5jZUlkO1xuXG4gICAgY29uc3QgaWRGaWVsZE5hbWUgPSB0aGlzLmdldElkRmllbGROYW1lKCk7XG5cbiAgICB0aGlzLmlkID0gdGhpcy5pZCB8fCB0aGlzLmdldFZhbHVlKGlkRmllbGROYW1lKTtcbiAgICB0aGlzLmRpc3BsYXlWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUobGF5ZXIuZGlzcGxheUZpZWxkKTtcbiAgICB0aGlzLnNldEdlb21ldHJ5KGZlYXR1cmUuZ2VvbWV0cnkpO1xuICB9XG5cbiAgZ2V0SWRGaWVsZE5hbWUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZ2V0SWRGaWVsZEZpZWxkTmFtZSh0aGlzLmxheWVyLmZpZWxkcyk7XG4gIH1cblxuICBnZXRWYWx1ZShmaWVsZE5hbWVPckV4cHJlc3Npb246IHN0cmluZyk6IGFueSB7XG4gICAgcmV0dXJuIGlzRmllbGRFeHByZXNzaW9uKGZpZWxkTmFtZU9yRXhwcmVzc2lvbilcbiAgICAgID8gZXZhbHV0ZUZlYXR1cmVEYXRhRXhwcmVzc2lvbihmaWVsZE5hbWVPckV4cHJlc3Npb24sIHRoaXMpXG4gICAgICA6IHRoaXMucHJvcGVydGllcyAmJiB0aGlzLnByb3BlcnRpZXNbZmllbGROYW1lT3JFeHByZXNzaW9uXTtcbiAgfVxuXG4gIGdldENvZGVkVmFsdWVOYW1lT3JEZWZhdWx0KGZpZWxkTmFtZTogc3RyaW5nKTogYW55IHtcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWUoZmllbGROYW1lKTtcbiAgICBjb25zdCBmaWVsZCA9IHRoaXMubGF5ZXIuZ2V0RmllbGQoZmllbGROYW1lKTtcbiAgICByZXR1cm4gZ2V0Q29kZWRWYWx1ZU5hbWVPckRlZmF1bHQoZmllbGQsIHZhbHVlKTtcbiAgfVxuXG4gIHNldFZhbHVlKGZpZWxkTmFtZTogc3RyaW5nLCB2YWx1ZTogYW55KTogdGhpcyB7XG4gICAgdGhpcy5wcm9wZXJ0aWVzW2ZpZWxkTmFtZV0gPSB2YWx1ZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNldElkKGlkOiBzdHJpbmcgfCBudW1iZXIpOiB0aGlzIHtcbiAgICB0aGlzLmlkID0gaWQ7XG4gICAgdGhpcy5zZXRWYWx1ZShnZXRJZEZpZWxkRmllbGROYW1lKHRoaXMubGF5ZXIuZmllbGRzKSwgaWQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2V0R2VvbWV0cnkoZ2VvbWV0cnk6IEdlb21ldHJ5KTogdGhpcyB7XG4gICAgdGhpcy5nZW9tZXRyeSA9IGdlb21ldHJ5O1xuICAgIHJldHVybiB0aGlzLnNldEdlb21ldHJ5VHlwZVByb3BlcnRpZXMoKTtcbiAgfVxuXG4gIHNldE1lYXN1cmVGcm9tR2VvbWV0cnkoKTogdGhpcyB7XG4gICAgaWYgKHRoaXMuZ2VvbWV0cnkpIHtcbiAgICAgIGNvbnN0IGV4dGVudCA9IGdldE1lYXN1cmVFeHRlbnQodGhpcy5nZW9tZXRyeSk7XG4gICAgICB0aGlzLmZyb21NZWFzdXJlID0gZXh0ZW50Lm1pbjtcbiAgICAgIHRoaXMudG9NZWFzdXJlID0gZXh0ZW50Lm1heDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBpc1NwYXRpYWxSZWZlcmVuY2VXZ3M4NCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zcGF0aWFsUmVmZXJlbmNlSWQgPT09IFdHU184NF9TUklEO1xuICB9XG5cbiAgY2xvbmUoKTogTWFwRmVhdHVyZSB7XG4gICAgY29uc3QgY29weUZlYXR1cmUgPSBjbG9uZSh0aGlzLnRvRmVhdHVyZSgpKTtcbiAgICByZXR1cm4gbmV3IE1hcEZlYXR1cmUoY29weUZlYXR1cmUsIHRoaXMubGF5ZXIpO1xuICB9XG5cbiAgdG9GZWF0dXJlKCk6IEZlYXR1cmUge1xuICAgIGNvbnN0IGZlYXR1cmU6IEZlYXR1cmUgPSB7XG4gICAgICB0eXBlOiAnRmVhdHVyZScsXG4gICAgICBnZW9tZXRyeTogdGhpcy5nZW9tZXRyeSxcbiAgICAgIHByb3BlcnRpZXM6IHRoaXMucHJvcGVydGllcyxcbiAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgYmJveDogdGhpcy5iYm94LFxuICAgIH07XG5cbiAgICByZXR1cm4gZmVhdHVyZTtcbiAgfVxuXG4gIHRvR2VvSnNvbigpOiBGZWF0dXJlIHtcbiAgICByZXR1cm4gdGhpcy50b0ZlYXR1cmUoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzZXRHZW9tZXRyeVR5cGVQcm9wZXJ0aWVzKCk6IHRoaXMge1xuICAgIHRoaXMuaXNMaW5lYXIgPSBpc0xpbmUodGhpcy5nZW9tZXRyeSk7XG4gICAgdGhpcy5pc1BvaW50ID0gaXNQb2ludCh0aGlzLmdlb21ldHJ5KTtcbiAgICB0aGlzLmlzUG9seWdvbiA9IGlzUG9seWdvbih0aGlzLmdlb21ldHJ5KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuIl19