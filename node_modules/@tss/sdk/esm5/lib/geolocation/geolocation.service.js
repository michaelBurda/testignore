/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// Angular.
import { Injectable } from '@angular/core';
// 3rd Party.
import { ReplaySubject, Subject } from 'rxjs';
import distance from '@turf/distance';
import bearing from '@turf/bearing';
// App.
import { isPositionAcceptable } from './is-position-acceptable.function';
import { Logger } from '../core/logging/logger.service';
import { NotifyService } from '../core/notify/notify.service';
import { GeolocationConfig } from './geolocation.config';
import { GeolocatorAccuracyUnit } from './geolocator/geolocator-accuracy-unit';
import { GeolocatorCapability } from './geolocator/geolocator-capability';
import { isPositionError } from './gps-position/is-position-error.function';
import { toReadableTime } from '../core/date-time/readable/to-readable-time.function';
import { isNumber } from '../core/type-check/is-number.function';
import { isNotNumber } from '../core/type-check/is-not-number.function';
import { formatNumber } from '../core/formatting/format-number.function';
import { errorMsg } from '../core/error/error-msg.function';
import { isNotValue } from '../core/type-check/is-not-value.function';
import { gpsPositionToPoint } from './gps-position/gps-position-to-point';
import { millisecondsToSeconds } from '../core/date-time/conversion/milliseconds-to-seconds.function';
import { convertLengthUnits } from '../core/units/convert-length-units.function';
import { LengthUnit } from '../core/units/length-unit';
import { BaseGeolocator } from './geolocator/base-geolocator.service';
import { isNotValidLocation } from './gps-position/is-not-valid-location.function';
import { gpsPositionsAlmostEqual } from './gps-position/gps-positions-almost-equal';
import * as i0 from "@angular/core";
import * as i1 from "./geolocator/base-geolocator.service";
import * as i2 from "../core/logging/logger.service";
import * as i3 from "../core/notify/notify.service";
import * as i4 from "./geolocation.config";
/**
 * Geolocator service. Provides a single point of GPS interaction.
 */
var GeolocationService = /** @class */ (function () {
    function GeolocationService(geolocator, log, notify, config) {
        this.log = log;
        this.notify = notify;
        this.config = config;
        this.isTrackingPosition = false;
        this.geolocator = geolocator;
        this.positionChangeSubject = new ReplaySubject(1);
        this.positionRecievedSubject = new Subject();
        this.positionChange = this.positionChangeSubject.asObservable();
        this.positionRecieved = this.positionRecievedSubject.asObservable();
    }
    Object.defineProperty(GeolocationService.prototype, "positionText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.position
                ? this.position.longitude.toFixed(this.config.gpsDisplayDecimalPlaces) + "\n       , " + this.position.latitude.toFixed(this.config.gpsDisplayDecimalPlaces)
                : '';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "positionReceivedEllapsedTime", {
        get: /**
         * @return {?}
         */
        function () {
            if (!this.positionRecievedTime) {
                return '';
            }
            /** @type {?} */
            var differenceMilliseconds = Date.now() - this.positionRecievedTime.getTime();
            return toReadableTime(differenceMilliseconds) + " ago";
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "isPositionAcceptable", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var accuracyThreshold = this.geolocator.accuracyUnit === GeolocatorAccuracyUnit.Meter
                ? this.config.gpsRequiredAccuracyMeters
                : this.config.gpsRequiredDilutionOfPrecision;
            return isPositionAcceptable(this.position, accuracyThreshold);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "isPositionUnacceptable", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.isPositionAcceptable;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "isPositionWarnable", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var accuracyThreshold = this.geolocator.accuracyUnit === GeolocatorAccuracyUnit.Meter
                ? this.config.gpsWarnableAccuracyMeters
                : this.config.gpsWarnableDilutionOfPrecision;
            return !isPositionAcceptable(this.position, accuracyThreshold);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "hasAccuracyCapability", {
        get: /**
         * @return {?}
         */
        function () {
            return this.geolocator.capabilities.indexOf(GeolocatorCapability.Accuracy) > -1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "isPositionAccuracyKnown", {
        get: /**
         * @return {?}
         */
        function () {
            return this.position && isNumber(this.position.accuracy);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "isPositionAccuracyUnknown", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.isPositionAccuracyKnown;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "isPositionAccuracyInMeters", {
        get: /**
         * @return {?}
         */
        function () {
            return this.geolocator.accuracyUnit === GeolocatorAccuracyUnit.Meter;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "isPositionAccuracyInDilutionOfPrecision", {
        get: /**
         * @return {?}
         */
        function () {
            return this.geolocator.accuracyUnit === GeolocatorAccuracyUnit.Pdop
                || this.geolocator.accuracyUnit === GeolocatorAccuracyUnit.Hdop
                || this.geolocator.accuracyUnit === GeolocatorAccuracyUnit.Vdop
                || this.geolocator.accuracyUnit === GeolocatorAccuracyUnit.Tdop;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "geolocatorService", {
        get: /**
         * @return {?}
         */
        function () {
            return this.geolocator;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GeolocationService.prototype, "accuracyStatement", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var noPosition = !this.position;
            if (noPosition) {
                return this.config.gpsNoAccuracyReading;
            }
            /** @type {?} */
            var isPositionAccuracyKnown = this.isPositionAccuracyKnown;
            /** @type {?} */
            var accuracy = isPositionAccuracyKnown ? this.position.accuracy : null;
            /** @type {?} */
            var suffix;
            if (isPositionAccuracyKnown && this.geolocator.hasCapability(GeolocatorCapability.Accuracy)) {
                suffix = this.geolocator.accuracyUnit === GeolocatorAccuracyUnit.Meter
                    ? 'm'
                    : String(this.geolocator.accuracyUnit).toUpperCase();
            }
            else if (this.geolocator.hasCapability(GeolocatorCapability.PDOP)) {
                accuracy = this.position.pdop;
                suffix = String(GeolocatorCapability.PDOP).toUpperCase();
            }
            else if (this.geolocator.hasCapability(GeolocatorCapability.HDOP)) {
                accuracy = this.position.hdop;
                suffix = String(GeolocatorCapability.HDOP).toUpperCase();
            }
            else if (this.geolocator.hasCapability(GeolocatorCapability.VDOP)) {
                accuracy = this.position.vdop;
                suffix = String(GeolocatorCapability.VDOP).toUpperCase();
            }
            else if (this.geolocator.hasCapability(GeolocatorCapability.TDOP)) {
                accuracy = this.position.tdop;
                suffix = String(GeolocatorCapability.TDOP).toUpperCase();
            }
            if (isNotNumber(accuracy)) {
                return this.config.gpsNoAccuracyReading;
            }
            return formatNumber(accuracy) + " " + suffix;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    GeolocationService.prototype.enableGpsTracking = /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var geoOptions = {
            enableHighAccuracy: (/** @type {?} */ (this)).config.gpsEnableHighAccuracy
        };
        (/** @type {?} */ (this)).position = null;
        (/** @type {?} */ (this)).tryUnsubscribe();
        (/** @type {?} */ (this)).log.debug("Subscribing to GPS watching for '" + (/** @type {?} */ (this)).geolocator.name + "' with high accuracy set to '" + geoOptions.enableHighAccuracy + "'");
        (/** @type {?} */ (this)).gpsLocatorSubscription = (/** @type {?} */ (this)).geolocator.watchPosition(geoOptions)
            .subscribe((/**
         * @template THIS
         * @this {THIS}
         * @param {?} position
         * @return {THIS}
         */
        function (position) { return (/** @type {?} */ (_this)).onPositionRecieved(position); }), (/**
         * @template THIS
         * @this {THIS}
         * @param {?} error
         * @return {THIS}
         */
        function (error) { return (/** @type {?} */ (_this)).onLocationError(error); }));
        return (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    GeolocationService.prototype.disableGpsTracking = /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        (/** @type {?} */ (this)).isTrackingPosition = false;
        (/** @type {?} */ (this)).tryUnsubscribe();
        return (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} geolocator
     * @return {THIS}
     */
    GeolocationService.prototype.setGeoLocator = /**
     * @template THIS
     * @this {THIS}
     * @param {?} geolocator
     * @return {THIS}
     */
    function (geolocator) {
        (/** @type {?} */ (this)).tryUnsubscribe();
        (/** @type {?} */ (this)).geolocator = geolocator;
        if ((/** @type {?} */ (this)).isTrackingPosition) {
            (/** @type {?} */ (this)).enableGpsTracking();
        }
        return (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} isTrackingLocation
     * @return {THIS}
     */
    GeolocationService.prototype.setGpsTracking = /**
     * @template THIS
     * @this {THIS}
     * @param {?} isTrackingLocation
     * @return {THIS}
     */
    function (isTrackingLocation) {
        if (isTrackingLocation) {
            (/** @type {?} */ (this)).enableGpsTracking();
        }
        else {
            (/** @type {?} */ (this)).disableGpsTracking();
        }
        return (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    GeolocationService.prototype.toggleGpsTracking = /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        (/** @type {?} */ (this)).setGpsTracking(!(/** @type {?} */ (this)).isTrackingPosition);
        return (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} position
     * @return {THIS}
     */
    GeolocationService.prototype.mockGpsPosition = /**
     * @template THIS
     * @this {THIS}
     * @param {?} position
     * @return {THIS}
     */
    function (position) {
        if (!(/** @type {?} */ (this)).config.allowGpsMocking) {
            throw new Error('Permission denied to mock GPS location');
        }
        return (/** @type {?} */ (this)).onPositionRecieved(position);
    };
    /**
     * @protected
     * @template THIS
     * @this {THIS}
     * @param {?} position
     * @return {THIS}
     */
    GeolocationService.prototype.onPositionRecieved = /**
     * @protected
     * @template THIS
     * @this {THIS}
     * @param {?} position
     * @return {THIS}
     */
    function (position) {
        if (isPositionError(position)) {
            (/** @type {?} */ (this)).onLocationError((/** @type {?} */ (position)));
            return (/** @type {?} */ (this));
        }
        /** @type {?} */
        var gpsPosition = (/** @type {?} */ (position));
        if (isNotValidLocation(gpsPosition)) {
            return (/** @type {?} */ (this));
        }
        /** @type {?} */
        var isPreviousPointSameAsNew = (/** @type {?} */ (this)).position
            && gpsPositionsAlmostEqual((/** @type {?} */ (this)).position, gpsPosition, (/** @type {?} */ (this)).config.gpsPositionDuplicatePrecision);
        if (isPreviousPointSameAsNew && !(/** @type {?} */ (this)).config.emitDuplicateGpsPositions) {
            (/** @type {?} */ (this)).positionRecievedSubject.next(gpsPosition);
            return (/** @type {?} */ (this));
        }
        (/** @type {?} */ (this)).log.trace("Location recieved from '" + (/** @type {?} */ (this)).geolocator.name + "': " + gpsPosition.latitude + ", " + gpsPosition.longitude);
        (/** @type {?} */ (this)).adjustCoordinates(gpsPosition);
        (/** @type {?} */ (this)).position = gpsPosition;
        (/** @type {?} */ (this)).isTrackingPosition = true;
        (/** @type {?} */ (this)).positionRecievedTime = new Date((/** @type {?} */ (this)).position.timestamp || Date.now());
        (/** @type {?} */ (this)).positionRecievedSubject.next((/** @type {?} */ (this)).position);
        (/** @type {?} */ (this)).positionChangeSubject.next((/** @type {?} */ (this)).position);
        return (/** @type {?} */ (this));
    };
    /**
     * @protected
     * @template THIS
     * @this {THIS}
     * @param {?} error
     * @return {THIS}
     */
    GeolocationService.prototype.onLocationError = /**
     * @protected
     * @template THIS
     * @this {THIS}
     * @param {?} error
     * @return {THIS}
     */
    function (error) {
        /** @type {?} */
        var errorMessage = errorMsg('Failed to retrieve location position. {error}', error);
        (/** @type {?} */ (this)).positionChangeSubject.error(error);
        (/** @type {?} */ (this)).log.error(errorMessage);
        (/** @type {?} */ (this)).notify.error(errorMessage);
        return (/** @type {?} */ (this));
    };
    /**
     * @private
     * @template THIS
     * @this {THIS}
     * @param {?} position
     * @return {THIS}
     */
    GeolocationService.prototype.adjustCoordinates = /**
     * @private
     * @template THIS
     * @this {THIS}
     * @param {?} position
     * @return {THIS}
     */
    function (position) {
        (/** @type {?} */ (this)).tryAdjustMissingPositionValues(position);
        if ((/** @type {?} */ (this)).config.adjustForGpsAntennaHeight && (/** @type {?} */ (this)).config.gpsAntennaHeight) {
            /** @type {?} */
            var adjustedHeight = position.altitude - (/** @type {?} */ (this)).config.gpsAntennaHeight;
            adjustedHeight = adjustedHeight < 0 ? 0 : adjustedHeight;
            (/** @type {?} */ (this)).log.trace("Adjusting coordinate altitude from " + position.altitude + " to " + adjustedHeight);
            Object.assign(position, {
                altitude: adjustedHeight
            });
        }
        return (/** @type {?} */ (this));
    };
    /**
     * @private
     * @param {?} newPosition
     * @return {?}
     */
    GeolocationService.prototype.tryAdjustMissingPositionValues = /**
     * @private
     * @param {?} newPosition
     * @return {?}
     */
    function (newPosition) {
        /** @type {?} */
        var missingSpeed = isNotValue(newPosition.speed);
        /** @type {?} */
        var missingHeading = isNotValue(newPosition.heading);
        /** @type {?} */
        var positionValuesMissing = missingSpeed || missingHeading;
        /** @type {?} */
        var shouldAdjustPositionValues = this.position && positionValuesMissing && this.config.calculateMissingPositionValues;
        if (shouldAdjustPositionValues) {
            /** @type {?} */
            var fromPoint = gpsPositionToPoint(this.position);
            /** @type {?} */
            var toPoint = gpsPositionToPoint(newPosition);
            if (missingSpeed) {
                // meters per second
                /** @type {?} */
                var kilometersTraveled = distance(fromPoint, toPoint, { units: 'kilometers' });
                if (kilometersTraveled) {
                    /** @type {?} */
                    var metersTraveled = convertLengthUnits(kilometersTraveled, LengthUnit.Kilometer, LengthUnit.Meter);
                    /** @type {?} */
                    var secondsDelta = millisecondsToSeconds(Math.abs(newPosition.timestamp - this.position.timestamp));
                    /** @type {?} */
                    var speed = metersTraveled / secondsDelta;
                    Object.assign(newPosition, { speed: speed });
                }
            }
            if (missingHeading) {
                /** @type {?} */
                var heading = bearing(fromPoint, toPoint);
                Object.assign(newPosition, { heading: heading });
            }
        }
    };
    /**
     * @private
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    GeolocationService.prototype.tryUnsubscribe = /**
     * @private
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        if ((/** @type {?} */ (this)).gpsLocatorSubscription) {
            (/** @type {?} */ (this)).log.debug("Unsubscribing from watching GPS stream from '" + (/** @type {?} */ (this)).geolocator.name + "'");
            (/** @type {?} */ (this)).gpsLocatorSubscription.unsubscribe();
        }
        return (/** @type {?} */ (this));
    };
    GeolocationService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    GeolocationService.ctorParameters = function () { return [
        { type: BaseGeolocator },
        { type: Logger },
        { type: NotifyService },
        { type: GeolocationConfig }
    ]; };
    /** @nocollapse */ GeolocationService.ngInjectableDef = i0.defineInjectable({ factory: function GeolocationService_Factory() { return new GeolocationService(i0.inject(i1.BaseGeolocator), i0.inject(i2.Logger), i0.inject(i3.NotifyService), i0.inject(i4.GeolocationConfig)); }, token: GeolocationService, providedIn: "root" });
    return GeolocationService;
}());
export { GeolocationService };
if (false) {
    /** @type {?} */
    GeolocationService.prototype.position;
    /** @type {?} */
    GeolocationService.prototype.positionRecievedTime;
    /** @type {?} */
    GeolocationService.prototype.isTrackingPosition;
    /**
     * Fired when ever a new position is received and the value is different than the previous (unless the Geolocation config
     * value "emitDuplicateGpsPositions" is set to true - in which case duplicates will be published).
     * This value will alway emit the last recieved position (if you subscribe after it was emitted you will still receive it).
     * @type {?}
     */
    GeolocationService.prototype.positionChange;
    /**
     * Fired when ever a new position is received regardless of whether the position has changed since the last position was recieved.
     * @type {?}
     */
    GeolocationService.prototype.positionRecieved;
    /**
     * @type {?}
     * @private
     */
    GeolocationService.prototype.positionChangeSubject;
    /**
     * @type {?}
     * @private
     */
    GeolocationService.prototype.positionRecievedSubject;
    /**
     * @type {?}
     * @private
     */
    GeolocationService.prototype.gpsLocatorSubscription;
    /**
     * @type {?}
     * @private
     */
    GeolocationService.prototype.geolocator;
    /**
     * @type {?}
     * @private
     */
    GeolocationService.prototype.log;
    /**
     * @type {?}
     * @private
     */
    GeolocationService.prototype.notify;
    /**
     * @type {?}
     * @protected
     */
    GeolocationService.prototype.config;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VvbG9jYXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0c3Mvc2RrLyIsInNvdXJjZXMiOlsibGliL2dlb2xvY2F0aW9uL2dlb2xvY2F0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQUczQyxPQUFPLEVBQWMsYUFBYSxFQUFnQixPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDeEUsT0FBTyxRQUFRLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEMsT0FBTyxPQUFPLE1BQU0sZUFBZSxDQUFDOztBQUdwQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUN6RSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDeEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzlELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBRS9FLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQzFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUM1RSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sc0RBQXNELENBQUM7QUFDdEYsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUN4RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFDekUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQzVELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUN0RSxPQUFPLEVBQUUsa0JB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QUEsSUFBSSxFQUFBLENBQUM7SUFDZCxDQUFDOztnQkFoU0YsVUFBVSxTQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjs7OztnQkFWUSxjQUFjO2dCQWxCZCxNQUFNO2dCQUNOLGFBQWE7Z0JBQ2IsaUJBQWlCOzs7NkJBWjFCO0NBcVVDLEFBalNELElBaVNDO1NBOVJZLGtCQUFrQjs7O0lBQzdCLHNDQUFzQjs7SUFDdEIsa0RBQTJCOztJQUMzQixnREFBMkI7Ozs7Ozs7SUFNM0IsNENBQWlEOzs7OztJQUtqRCw4Q0FBbUQ7Ozs7O0lBRW5ELG1EQUEwRDs7Ozs7SUFDMUQscURBQXNEOzs7OztJQUN0RCxvREFBNkM7Ozs7O0lBQzdDLHdDQUErQjs7Ozs7SUF1RzdCLGlDQUE0Qjs7Ozs7SUFDNUIsb0NBQXNDOzs7OztJQUN0QyxvQ0FBNEMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBbmd1bGFyLlxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG4vLyAzcmQgUGFydHkuXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBSZXBsYXlTdWJqZWN0LCBTdWJzY3JpcHRpb24sIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCBkaXN0YW5jZSBmcm9tICdAdHVyZi9kaXN0YW5jZSc7XG5pbXBvcnQgYmVhcmluZyBmcm9tICdAdHVyZi9iZWFyaW5nJztcblxuLy8gQXBwLlxuaW1wb3J0IHsgaXNQb3NpdGlvbkFjY2VwdGFibGUgfSBmcm9tICcuL2lzLXBvc2l0aW9uLWFjY2VwdGFibGUuZnVuY3Rpb24nO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vY29yZS9sb2dnaW5nL2xvZ2dlci5zZXJ2aWNlJztcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICcuLi9jb3JlL25vdGlmeS9ub3RpZnkuc2VydmljZSc7XG5pbXBvcnQgeyBHZW9sb2NhdGlvbkNvbmZpZyB9IGZyb20gJy4vZ2VvbG9jYXRpb24uY29uZmlnJztcbmltcG9ydCB7IEdlb2xvY2F0b3JBY2N1cmFjeVVuaXQgfSBmcm9tICcuL2dlb2xvY2F0b3IvZ2VvbG9jYXRvci1hY2N1cmFjeS11bml0JztcbmltcG9ydCB7IEdwc1Bvc2l0aW9uIH0gZnJvbSAnLi9ncHMtcG9zaXRpb24vZ3BzLXBvc2l0aW9uJztcbmltcG9ydCB7IEdlb2xvY2F0b3JDYXBhYmlsaXR5IH0gZnJvbSAnLi9nZW9sb2NhdG9yL2dlb2xvY2F0b3ItY2FwYWJpbGl0eSc7XG5pbXBvcnQgeyBpc1Bvc2l0aW9uRXJyb3IgfSBmcm9tICcuL2dwcy1wb3NpdGlvbi9pcy1wb3NpdGlvbi1lcnJvci5mdW5jdGlvbic7XG5pbXBvcnQgeyB0b1JlYWRhYmxlVGltZSB9IGZyb20gJy4uL2NvcmUvZGF0ZS10aW1lL3JlYWRhYmxlL3RvLXJlYWRhYmxlLXRpbWUuZnVuY3Rpb24nO1xuaW1wb3J0IHsgaXNOdW1iZXIgfSBmcm9tICcuLi9jb3JlL3R5cGUtY2hlY2svaXMtbnVtYmVyLmZ1bmN0aW9uJztcbmltcG9ydCB7IGlzTm90TnVtYmVyIH0gZnJvbSAnLi4vY29yZS90eXBlLWNoZWNrL2lzLW5vdC1udW1iZXIuZnVuY3Rpb24nO1xuaW1wb3J0IHsgZm9ybWF0TnVtYmVyIH0gZnJvbSAnLi4vY29yZS9mb3JtYXR0aW5nL2Zvcm1hdC1udW1iZXIuZnVuY3Rpb24nO1xuaW1wb3J0IHsgZXJyb3JNc2cgfSBmcm9tICcuLi9jb3JlL2Vycm9yL2Vycm9yLW1zZy5mdW5jdGlvbic7XG5pbXBvcnQgeyBpc05vdFZhbHVlIH0gZnJvbSAnLi4vY29yZS90eXBlLWNoZWNrL2lzLW5vdC12YWx1ZS5mdW5jdGlvbic7XG5pbXBvcnQgeyBncHNQb3NpdGlvblRvUG9pbnQgfSBmcm9tICcuL2dwcy1wb3NpdGlvbi9ncHMtcG9zaXRpb24tdG8tcG9pbnQnO1xuaW1wb3J0IHsgbWlsbGlzZWNvbmRzVG9TZWNvbmRzIH0gZnJvbSAnLi4vY29yZS9kYXRlLXRpbWUvY29udmVyc2lvbi9taWxsaXNlY29uZHMtdG8tc2Vjb25kcy5mdW5jdGlvbic7XG5pbXBvcnQgeyBjb252ZXJ0TGVuZ3RoVW5pdHMgfSBmcm9tICcuLi9jb3JlL3VuaXRzL2NvbnZlcnQtbGVuZ3RoLXVuaXRzLmZ1bmN0aW9uJztcbmltcG9ydCB7IExlbmd0aFVuaXQgfSBmcm9tICcuLi9jb3JlL3VuaXRzL2xlbmd0aC11bml0JztcbmltcG9ydCB7IEdlb2xvY2F0b3IgfSBmcm9tICcuL2dlb2xvY2F0b3IvZ2VvbG9jYXRvcic7XG5pbXBvcnQgeyBCYXNlR2VvbG9jYXRvciB9IGZyb20gJy4vZ2VvbG9jYXRvci9iYXNlLWdlb2xvY2F0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBpc05vdFZhbGlkTG9jYXRpb24gfSBmcm9tICcuL2dwcy1wb3NpdGlvbi9pcy1ub3QtdmFsaWQtbG9jYXRpb24uZnVuY3Rpb24nO1xuaW1wb3J0IHsgZ3BzUG9zaXRpb25zQWxtb3N0RXF1YWwgfSBmcm9tICcuL2dwcy1wb3NpdGlvbi9ncHMtcG9zaXRpb25zLWFsbW9zdC1lcXVhbCc7XG5cblxuLyoqXG4gKiBHZW9sb2NhdG9yIHNlcnZpY2UuIFByb3ZpZGVzIGEgc2luZ2xlIHBvaW50IG9mIEdQUyBpbnRlcmFjdGlvbi5cbiAqL1xuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgR2VvbG9jYXRpb25TZXJ2aWNlIHtcbiAgcG9zaXRpb246IEdwc1Bvc2l0aW9uO1xuICBwb3NpdGlvblJlY2lldmVkVGltZTogRGF0ZTtcbiAgaXNUcmFja2luZ1Bvc2l0aW9uID0gZmFsc2U7XG4gIC8qKlxuICAgKiBGaXJlZCB3aGVuIGV2ZXIgYSBuZXcgcG9zaXRpb24gaXMgcmVjZWl2ZWQgYW5kIHRoZSB2YWx1ZSBpcyBkaWZmZXJlbnQgdGhhbiB0aGUgcHJldmlvdXMgKHVubGVzcyB0aGUgR2VvbG9jYXRpb24gY29uZmlnXG4gICAqIHZhbHVlIFwiZW1pdER1cGxpY2F0ZUdwc1Bvc2l0aW9uc1wiIGlzIHNldCB0byB0cnVlIC0gaW4gd2hpY2ggY2FzZSBkdXBsaWNhdGVzIHdpbGwgYmUgcHVibGlzaGVkKS5cbiAgICogVGhpcyB2YWx1ZSB3aWxsIGFsd2F5IGVtaXQgdGhlIGxhc3QgcmVjaWV2ZWQgcG9zaXRpb24gKGlmIHlvdSBzdWJzY3JpYmUgYWZ0ZXIgaXQgd2FzIGVtaXR0ZWQgeW91IHdpbGwgc3RpbGwgcmVjZWl2ZSBpdCkuXG4gICAqL1xuICByZWFkb25seSBwb3NpdGlvbkNoYW5nZTogT2JzZXJ2YWJsZTxHcHNQb3NpdGlvbj47XG5cbiAgLyoqXG4gICAqIEZpcmVkIHdoZW4gZXZlciBhIG5ldyBwb3NpdGlvbiBpcyByZWNlaXZlZCByZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhlIHBvc2l0aW9uIGhhcyBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IHBvc2l0aW9uIHdhcyByZWNpZXZlZC5cbiAgICovXG4gIHJlYWRvbmx5IHBvc2l0aW9uUmVjaWV2ZWQ6IE9ic2VydmFibGU8R3BzUG9zaXRpb24+O1xuXG4gIHByaXZhdGUgcG9zaXRpb25DaGFuZ2VTdWJqZWN0OiBSZXBsYXlTdWJqZWN0PEdwc1Bvc2l0aW9uPjtcbiAgcHJpdmF0ZSBwb3NpdGlvblJlY2lldmVkU3ViamVjdDogU3ViamVjdDxHcHNQb3NpdGlvbj47XG4gIHByaXZhdGUgZ3BzTG9jYXRvclN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIGdlb2xvY2F0b3I6IEdlb2xvY2F0b3I7XG5cbiAgZ2V0IHBvc2l0aW9uVGV4dCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnBvc2l0aW9uXG4gICAgICA/IGAke3RoaXMucG9zaXRpb24ubG9uZ2l0dWRlLnRvRml4ZWQodGhpcy5jb25maWcuZ3BzRGlzcGxheURlY2ltYWxQbGFjZXMpfVxuICAgICAgICwgJHt0aGlzLnBvc2l0aW9uLmxhdGl0dWRlLnRvRml4ZWQodGhpcy5jb25maWcuZ3BzRGlzcGxheURlY2ltYWxQbGFjZXMpfWBcbiAgICAgIDogJyc7XG4gIH1cblxuICBnZXQgcG9zaXRpb25SZWNlaXZlZEVsbGFwc2VkVGltZSgpOiBzdHJpbmcge1xuICAgIGlmICghdGhpcy5wb3NpdGlvblJlY2lldmVkVGltZSkge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIGNvbnN0IGRpZmZlcmVuY2VNaWxsaXNlY29uZHMgPSBEYXRlLm5vdygpIC0gdGhpcy5wb3NpdGlvblJlY2lldmVkVGltZS5nZXRUaW1lKCk7XG4gICAgcmV0dXJuIGAke3RvUmVhZGFibGVUaW1lKGRpZmZlcmVuY2VNaWxsaXNlY29uZHMpfSBhZ29gO1xuICB9XG5cbiAgZ2V0IGlzUG9zaXRpb25BY2NlcHRhYmxlKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGFjY3VyYWN5VGhyZXNob2xkID0gdGhpcy5nZW9sb2NhdG9yLmFjY3VyYWN5VW5pdCA9PT0gR2VvbG9jYXRvckFjY3VyYWN5VW5pdC5NZXRlclxuICAgICAgPyB0aGlzLmNvbmZpZy5ncHNSZXF1aXJlZEFjY3VyYWN5TWV0ZXJzXG4gICAgICA6IHRoaXMuY29uZmlnLmdwc1JlcXVpcmVkRGlsdXRpb25PZlByZWNpc2lvbjtcblxuICAgIHJldHVybiBpc1Bvc2l0aW9uQWNjZXB0YWJsZSh0aGlzLnBvc2l0aW9uLCBhY2N1cmFjeVRocmVzaG9sZCk7XG4gIH1cblxuICBnZXQgaXNQb3NpdGlvblVuYWNjZXB0YWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXRoaXMuaXNQb3NpdGlvbkFjY2VwdGFibGU7XG4gIH1cblxuICBnZXQgaXNQb3NpdGlvbldhcm5hYmxlKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGFjY3VyYWN5VGhyZXNob2xkID0gdGhpcy5nZW9sb2NhdG9yLmFjY3VyYWN5VW5pdCA9PT0gR2VvbG9jYXRvckFjY3VyYWN5VW5pdC5NZXRlclxuICAgICAgPyB0aGlzLmNvbmZpZy5ncHNXYXJuYWJsZUFjY3VyYWN5TWV0ZXJzXG4gICAgICA6IHRoaXMuY29uZmlnLmdwc1dhcm5hYmxlRGlsdXRpb25PZlByZWNpc2lvbjtcblxuICAgIHJldHVybiAhaXNQb3NpdGlvbkFjY2VwdGFibGUodGhpcy5wb3NpdGlvbiwgYWNjdXJhY3lUaHJlc2hvbGQpO1xuICB9XG5cbiAgZ2V0IGhhc0FjY3VyYWN5Q2FwYWJpbGl0eSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5nZW9sb2NhdG9yLmNhcGFiaWxpdGllcy5pbmRleE9mKEdlb2xvY2F0b3JDYXBhYmlsaXR5LkFjY3VyYWN5KSA+IC0xO1xuICB9XG5cbiAgZ2V0IGlzUG9zaXRpb25BY2N1cmFjeUtub3duKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnBvc2l0aW9uICYmIGlzTnVtYmVyKHRoaXMucG9zaXRpb24uYWNjdXJhY3kpO1xuICB9XG5cbiAgZ2V0IGlzUG9zaXRpb25BY2N1cmFjeVVua25vd24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLmlzUG9zaXRpb25BY2N1cmFjeUtub3duO1xuICB9XG5cbiAgZ2V0IGlzUG9zaXRpb25BY2N1cmFjeUluTWV0ZXJzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmdlb2xvY2F0b3IuYWNjdXJhY3lVbml0ID09PSBHZW9sb2NhdG9yQWNjdXJhY3lVbml0Lk1ldGVyO1xuICB9XG5cbiAgZ2V0IGlzUG9zaXRpb25BY2N1cmFjeUluRGlsdXRpb25PZlByZWNpc2lvbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5nZW9sb2NhdG9yLmFjY3VyYWN5VW5pdCA9PT0gR2VvbG9jYXRvckFjY3VyYWN5VW5pdC5QZG9wXG4gICAgICB8fCB0aGlzLmdlb2xvY2F0b3IuYWNjdXJhY3lVbml0ID09PSBHZW9sb2NhdG9yQWNjdXJhY3lVbml0Lkhkb3BcbiAgICAgIHx8IHRoaXMuZ2VvbG9jYXRvci5hY2N1cmFjeVVuaXQgPT09IEdlb2xvY2F0b3JBY2N1cmFjeVVuaXQuVmRvcFxuICAgICAgfHwgdGhpcy5nZW9sb2NhdG9yLmFjY3VyYWN5VW5pdCA9PT0gR2VvbG9jYXRvckFjY3VyYWN5VW5pdC5UZG9wO1xuICB9XG5cbiAgZ2V0IGdlb2xvY2F0b3JTZXJ2aWNlKCk6IEdlb2xvY2F0b3Ige1xuICAgIHJldHVybiB0aGlzLmdlb2xvY2F0b3I7XG4gIH1cblxuICBnZXQgYWNjdXJhY3lTdGF0ZW1lbnQoKTogc3RyaW5nIHtcbiAgICBjb25zdCBub1Bvc2l0aW9uID0gIXRoaXMucG9zaXRpb247XG5cbiAgICBpZiAobm9Qb3NpdGlvbikge1xuICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLmdwc05vQWNjdXJhY3lSZWFkaW5nO1xuICAgIH1cblxuICAgIGNvbnN0IGlzUG9zaXRpb25BY2N1cmFjeUtub3duID0gdGhpcy5pc1Bvc2l0aW9uQWNjdXJhY3lLbm93bjtcbiAgICBsZXQgYWNjdXJhY3k6IG51bWJlciA9IGlzUG9zaXRpb25BY2N1cmFjeUtub3duID8gdGhpcy5wb3NpdGlvbi5hY2N1cmFjeSA6IG51bGw7XG4gICAgbGV0IHN1ZmZpeDogc3RyaW5nO1xuXG4gICAgaWYgKGlzUG9zaXRpb25BY2N1cmFjeUtub3duICYmIHRoaXMuZ2VvbG9jYXRvci5oYXNDYXBhYmlsaXR5KEdlb2xvY2F0b3JDYXBhYmlsaXR5LkFjY3VyYWN5KSkge1xuICAgICAgc3VmZml4ID0gdGhpcy5nZW9sb2NhdG9yLmFjY3VyYWN5VW5pdCA9PT0gR2VvbG9jYXRvckFjY3VyYWN5VW5pdC5NZXRlclxuICAgICAgICA/ICdtJ1xuICAgICAgICA6IFN0cmluZyh0aGlzLmdlb2xvY2F0b3IuYWNjdXJhY3lVbml0KS50b1VwcGVyQ2FzZSgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5nZW9sb2NhdG9yLmhhc0NhcGFiaWxpdHkoR2VvbG9jYXRvckNhcGFiaWxpdHkuUERPUCkpIHtcbiAgICAgIGFjY3VyYWN5ID0gdGhpcy5wb3NpdGlvbi5wZG9wO1xuICAgICAgc3VmZml4ID0gU3RyaW5nKEdlb2xvY2F0b3JDYXBhYmlsaXR5LlBET1ApLnRvVXBwZXJDYXNlKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmdlb2xvY2F0b3IuaGFzQ2FwYWJpbGl0eShHZW9sb2NhdG9yQ2FwYWJpbGl0eS5IRE9QKSkge1xuICAgICAgYWNjdXJhY3kgPSB0aGlzLnBvc2l0aW9uLmhkb3A7XG4gICAgICBzdWZmaXggPSBTdHJpbmcoR2VvbG9jYXRvckNhcGFiaWxpdHkuSERPUCkudG9VcHBlckNhc2UoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuZ2VvbG9jYXRvci5oYXNDYXBhYmlsaXR5KEdlb2xvY2F0b3JDYXBhYmlsaXR5LlZET1ApKSB7XG4gICAgICBhY2N1cmFjeSA9IHRoaXMucG9zaXRpb24udmRvcDtcbiAgICAgIHN1ZmZpeCA9IFN0cmluZyhHZW9sb2NhdG9yQ2FwYWJpbGl0eS5WRE9QKS50b1VwcGVyQ2FzZSgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5nZW9sb2NhdG9yLmhhc0NhcGFiaWxpdHkoR2VvbG9jYXRvckNhcGFiaWxpdHkuVERPUCkpIHtcbiAgICAgIGFjY3VyYWN5ID0gdGhpcy5wb3NpdGlvbi50ZG9wO1xuICAgICAgc3VmZml4ID0gU3RyaW5nKEdlb2xvY2F0b3JDYXBhYmlsaXR5LlRET1ApLnRvVXBwZXJDYXNlKCk7XG4gICAgfVxuXG4gICAgaWYgKGlzTm90TnVtYmVyKGFjY3VyYWN5KSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLmdwc05vQWNjdXJhY3lSZWFkaW5nO1xuICAgIH1cblxuICAgIHJldHVybiBgJHtmb3JtYXROdW1iZXIoYWNjdXJhY3kpfSAke3N1ZmZpeH1gO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgZ2VvbG9jYXRvcjogQmFzZUdlb2xvY2F0b3IsXG4gICAgcHJpdmF0ZSByZWFkb25seSBsb2c6IExvZ2dlcixcbiAgICBwcml2YXRlIHJlYWRvbmx5IG5vdGlmeTogTm90aWZ5U2VydmljZSxcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgY29uZmlnOiBHZW9sb2NhdGlvbkNvbmZpZyxcbiAgKSB7XG4gICAgdGhpcy5nZW9sb2NhdG9yID0gZ2VvbG9jYXRvcjtcbiAgICB0aGlzLnBvc2l0aW9uQ2hhbmdlU3ViamVjdCA9IG5ldyBSZXBsYXlTdWJqZWN0KDEpO1xuICAgIHRoaXMucG9zaXRpb25SZWNpZXZlZFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xuXG4gICAgdGhpcy5wb3NpdGlvbkNoYW5nZSA9IHRoaXMucG9zaXRpb25DaGFuZ2VTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xuICAgIHRoaXMucG9zaXRpb25SZWNpZXZlZCA9IHRoaXMucG9zaXRpb25SZWNpZXZlZFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBlbmFibGVHcHNUcmFja2luZygpOiB0aGlzIHtcbiAgICBjb25zdCBnZW9PcHRpb25zID0ge1xuICAgICAgZW5hYmxlSGlnaEFjY3VyYWN5OiB0aGlzLmNvbmZpZy5ncHNFbmFibGVIaWdoQWNjdXJhY3lcbiAgICB9O1xuXG4gICAgdGhpcy5wb3NpdGlvbiA9IG51bGw7XG4gICAgdGhpcy50cnlVbnN1YnNjcmliZSgpO1xuICAgIHRoaXMubG9nLmRlYnVnKFxuICAgICAgYFN1YnNjcmliaW5nIHRvIEdQUyB3YXRjaGluZyBmb3IgJyR7dGhpcy5nZW9sb2NhdG9yLm5hbWV9JyB3aXRoIGhpZ2ggYWNjdXJhY3kgc2V0IHRvICcke2dlb09wdGlvbnMuZW5hYmxlSGlnaEFjY3VyYWN5fSdgXG4gICAgKTtcblxuICAgIHRoaXMuZ3BzTG9jYXRvclN1YnNjcmlwdGlvbiA9IHRoaXMuZ2VvbG9jYXRvci53YXRjaFBvc2l0aW9uKGdlb09wdGlvbnMpXG4gICAgICAuc3Vic2NyaWJlKFxuICAgICAgICBwb3NpdGlvbiA9PiB0aGlzLm9uUG9zaXRpb25SZWNpZXZlZChwb3NpdGlvbiksXG4gICAgICAgIGVycm9yID0+IHRoaXMub25Mb2NhdGlvbkVycm9yKGVycm9yKVxuICAgICAgKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZGlzYWJsZUdwc1RyYWNraW5nKCk6IHRoaXMge1xuICAgIHRoaXMuaXNUcmFja2luZ1Bvc2l0aW9uID0gZmFsc2U7XG4gICAgdGhpcy50cnlVbnN1YnNjcmliZSgpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZXRHZW9Mb2NhdG9yKGdlb2xvY2F0b3I6IEdlb2xvY2F0b3IpOiB0aGlzIHtcbiAgICB0aGlzLnRyeVVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5nZW9sb2NhdG9yID0gZ2VvbG9jYXRvcjtcbiAgICBpZiAodGhpcy5pc1RyYWNraW5nUG9zaXRpb24pIHtcbiAgICAgIHRoaXMuZW5hYmxlR3BzVHJhY2tpbmcoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNldEdwc1RyYWNraW5nKGlzVHJhY2tpbmdMb2NhdGlvbjogYm9vbGVhbik6IHRoaXMge1xuICAgIGlmIChpc1RyYWNraW5nTG9jYXRpb24pIHtcbiAgICAgIHRoaXMuZW5hYmxlR3BzVHJhY2tpbmcoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kaXNhYmxlR3BzVHJhY2tpbmcoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHRvZ2dsZUdwc1RyYWNraW5nKCk6IHRoaXMge1xuICAgIHRoaXMuc2V0R3BzVHJhY2tpbmcoIXRoaXMuaXNUcmFja2luZ1Bvc2l0aW9uKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG1vY2tHcHNQb3NpdGlvbihwb3NpdGlvbjogR3BzUG9zaXRpb24gfCBQb3NpdGlvbkVycm9yKTogdGhpcyB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5hbGxvd0dwc01vY2tpbmcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUGVybWlzc2lvbiBkZW5pZWQgdG8gbW9jayBHUFMgbG9jYXRpb24nKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5vblBvc2l0aW9uUmVjaWV2ZWQocG9zaXRpb24pO1xuICB9XG5cbiAgcHJvdGVjdGVkIG9uUG9zaXRpb25SZWNpZXZlZChwb3NpdGlvbjogR3BzUG9zaXRpb24gfCBQb3NpdGlvbkVycm9yKTogdGhpcyB7XG4gICAgaWYgKGlzUG9zaXRpb25FcnJvcihwb3NpdGlvbikpIHtcbiAgICAgIHRoaXMub25Mb2NhdGlvbkVycm9yKHBvc2l0aW9uIGFzIFBvc2l0aW9uRXJyb3IpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgY29uc3QgZ3BzUG9zaXRpb24gPSBwb3NpdGlvbiBhcyBHcHNQb3NpdGlvbjtcbiAgICBpZiAoaXNOb3RWYWxpZExvY2F0aW9uKGdwc1Bvc2l0aW9uKSkge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgY29uc3QgaXNQcmV2aW91c1BvaW50U2FtZUFzTmV3ID0gdGhpcy5wb3NpdGlvblxuICAgICAgJiYgZ3BzUG9zaXRpb25zQWxtb3N0RXF1YWwodGhpcy5wb3NpdGlvbiwgZ3BzUG9zaXRpb24sIHRoaXMuY29uZmlnLmdwc1Bvc2l0aW9uRHVwbGljYXRlUHJlY2lzaW9uKTtcblxuICAgIGlmIChpc1ByZXZpb3VzUG9pbnRTYW1lQXNOZXcgJiYgIXRoaXMuY29uZmlnLmVtaXREdXBsaWNhdGVHcHNQb3NpdGlvbnMpIHtcbiAgICAgIHRoaXMucG9zaXRpb25SZWNpZXZlZFN1YmplY3QubmV4dChncHNQb3NpdGlvbik7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICB0aGlzLmxvZy50cmFjZShgTG9jYXRpb24gcmVjaWV2ZWQgZnJvbSAnJHt0aGlzLmdlb2xvY2F0b3IubmFtZX0nOiAke2dwc1Bvc2l0aW9uLmxhdGl0dWRlfSwgJHtncHNQb3NpdGlvbi5sb25naXR1ZGV9YCk7XG4gICAgdGhpcy5hZGp1c3RDb29yZGluYXRlcyhncHNQb3NpdGlvbik7XG4gICAgdGhpcy5wb3NpdGlvbiA9IGdwc1Bvc2l0aW9uO1xuICAgIHRoaXMuaXNUcmFja2luZ1Bvc2l0aW9uID0gdHJ1ZTtcbiAgICB0aGlzLnBvc2l0aW9uUmVjaWV2ZWRUaW1lID0gbmV3IERhdGUodGhpcy5wb3NpdGlvbi50aW1lc3RhbXAgfHwgRGF0ZS5ub3coKSk7XG4gICAgdGhpcy5wb3NpdGlvblJlY2lldmVkU3ViamVjdC5uZXh0KHRoaXMucG9zaXRpb24pO1xuICAgIHRoaXMucG9zaXRpb25DaGFuZ2VTdWJqZWN0Lm5leHQodGhpcy5wb3NpdGlvbik7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHByb3RlY3RlZCBvbkxvY2F0aW9uRXJyb3IoZXJyb3I6IFBvc2l0aW9uRXJyb3IpOiB0aGlzIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvck1zZygnRmFpbGVkIHRvIHJldHJpZXZlIGxvY2F0aW9uIHBvc2l0aW9uLiB7ZXJyb3J9JywgZXJyb3IpO1xuICAgIHRoaXMucG9zaXRpb25DaGFuZ2VTdWJqZWN0LmVycm9yKGVycm9yKTtcbiAgICB0aGlzLmxvZy5lcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgIHRoaXMubm90aWZ5LmVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwcml2YXRlIGFkanVzdENvb3JkaW5hdGVzKHBvc2l0aW9uOiBHcHNQb3NpdGlvbik6IHRoaXMge1xuICAgIHRoaXMudHJ5QWRqdXN0TWlzc2luZ1Bvc2l0aW9uVmFsdWVzKHBvc2l0aW9uKTtcblxuICAgIGlmICh0aGlzLmNvbmZpZy5hZGp1c3RGb3JHcHNBbnRlbm5hSGVpZ2h0ICYmIHRoaXMuY29uZmlnLmdwc0FudGVubmFIZWlnaHQpIHtcbiAgICAgIGxldCBhZGp1c3RlZEhlaWdodCA9IHBvc2l0aW9uLmFsdGl0dWRlIC0gdGhpcy5jb25maWcuZ3BzQW50ZW5uYUhlaWdodDtcbiAgICAgIGFkanVzdGVkSGVpZ2h0ID0gYWRqdXN0ZWRIZWlnaHQgPCAwID8gMCA6IGFkanVzdGVkSGVpZ2h0O1xuXG4gICAgICB0aGlzLmxvZy50cmFjZShgQWRqdXN0aW5nIGNvb3JkaW5hdGUgYWx0aXR1ZGUgZnJvbSAke3Bvc2l0aW9uLmFsdGl0dWRlfSB0byAke2FkanVzdGVkSGVpZ2h0fWApO1xuICAgICAgT2JqZWN0LmFzc2lnbihwb3NpdGlvbiwge1xuICAgICAgICBhbHRpdHVkZTogYWRqdXN0ZWRIZWlnaHRcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcHJpdmF0ZSB0cnlBZGp1c3RNaXNzaW5nUG9zaXRpb25WYWx1ZXMobmV3UG9zaXRpb246IEdwc1Bvc2l0aW9uKTogdm9pZCB7XG4gICAgY29uc3QgbWlzc2luZ1NwZWVkID0gaXNOb3RWYWx1ZShuZXdQb3NpdGlvbi5zcGVlZCk7XG4gICAgY29uc3QgbWlzc2luZ0hlYWRpbmcgPSBpc05vdFZhbHVlKG5ld1Bvc2l0aW9uLmhlYWRpbmcpO1xuICAgIGNvbnN0IHBvc2l0aW9uVmFsdWVzTWlzc2luZyA9IG1pc3NpbmdTcGVlZCB8fCBtaXNzaW5nSGVhZGluZztcbiAgICBjb25zdCBzaG91bGRBZGp1c3RQb3NpdGlvblZhbHVlcyA9IHRoaXMucG9zaXRpb24gJiYgcG9zaXRpb25WYWx1ZXNNaXNzaW5nICYmIHRoaXMuY29uZmlnLmNhbGN1bGF0ZU1pc3NpbmdQb3NpdGlvblZhbHVlcztcblxuICAgIGlmIChzaG91bGRBZGp1c3RQb3NpdGlvblZhbHVlcykge1xuICAgICAgY29uc3QgZnJvbVBvaW50ID0gZ3BzUG9zaXRpb25Ub1BvaW50KHRoaXMucG9zaXRpb24pO1xuICAgICAgY29uc3QgdG9Qb2ludCA9IGdwc1Bvc2l0aW9uVG9Qb2ludChuZXdQb3NpdGlvbik7XG5cbiAgICAgIGlmIChtaXNzaW5nU3BlZWQpIHtcbiAgICAgICAgLy8gbWV0ZXJzIHBlciBzZWNvbmRcbiAgICAgICAgY29uc3Qga2lsb21ldGVyc1RyYXZlbGVkID0gZGlzdGFuY2UoZnJvbVBvaW50LCB0b1BvaW50LCB7IHVuaXRzOiAna2lsb21ldGVycycgfSk7XG4gICAgICAgIGlmIChraWxvbWV0ZXJzVHJhdmVsZWQpIHtcbiAgICAgICAgICBjb25zdCBtZXRlcnNUcmF2ZWxlZCA9IGNvbnZlcnRMZW5ndGhVbml0cyhraWxvbWV0ZXJzVHJhdmVsZWQsIExlbmd0aFVuaXQuS2lsb21ldGVyLCBMZW5ndGhVbml0Lk1ldGVyKTtcbiAgICAgICAgICBjb25zdCBzZWNvbmRzRGVsdGEgPSBtaWxsaXNlY29uZHNUb1NlY29uZHMoXG4gICAgICAgICAgICBNYXRoLmFicyhuZXdQb3NpdGlvbi50aW1lc3RhbXAgLSB0aGlzLnBvc2l0aW9uLnRpbWVzdGFtcClcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHNwZWVkID0gbWV0ZXJzVHJhdmVsZWQgLyBzZWNvbmRzRGVsdGE7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbihuZXdQb3NpdGlvbiwgeyBzcGVlZCB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAobWlzc2luZ0hlYWRpbmcpIHtcbiAgICAgICAgY29uc3QgaGVhZGluZyA9IGJlYXJpbmcoZnJvbVBvaW50LCB0b1BvaW50KTtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihuZXdQb3NpdGlvbiwgeyBoZWFkaW5nIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdHJ5VW5zdWJzY3JpYmUoKTogdGhpcyB7XG4gICAgaWYgKHRoaXMuZ3BzTG9jYXRvclN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5sb2cuZGVidWcoYFVuc3Vic2NyaWJpbmcgZnJvbSB3YXRjaGluZyBHUFMgc3RyZWFtIGZyb20gJyR7dGhpcy5nZW9sb2NhdG9yLm5hbWV9J2ApO1xuICAgICAgdGhpcy5ncHNMb2NhdG9yU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn1cbiJdfQ==