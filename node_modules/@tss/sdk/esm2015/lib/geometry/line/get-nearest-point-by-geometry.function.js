/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { toMultiPartPaths } from './to-multi-part-paths.function';
import { getDistanceBetweenPoints, getMetersBetweenLatLng } from '../point/get-distance-between-points.function';
import { toSinglePartPointArray } from '../point/to-single-part-point.function';
import { getDistanceToLine } from './get-distance-to-line.function';
import { addRange } from '../../core/array/add-range.function';
/**
 * @record
 */
export function LineVerticeeSummary() { }
if (false) {
    /** @type {?} */
    LineVerticeeSummary.prototype.nearestPoint;
    /** @type {?} */
    LineVerticeeSummary.prototype.furthestPoint;
    /** @type {?} */
    LineVerticeeSummary.prototype.minPoint;
    /** @type {?} */
    LineVerticeeSummary.prototype.maxPoint;
    /** @type {?} */
    LineVerticeeSummary.prototype.nextPoint;
    /** @type {?} */
    LineVerticeeSummary.prototype.previousPoint;
}
/**
 * @param {?} line
 * @param {?} point
 * @param {?=} isPointDegrees
 * @return {?}
 */
export function getVerticeeInfos(line, point, isPointDegrees = true) {
    /** @type {?} */
    const pointComparisonDetails = [];
    /** @type {?} */
    const paths = toMultiPartPaths(line);
    paths.forEach((/**
     * @param {?} coordinates
     * @return {?}
     */
    (coordinates) => {
        /** @type {?} */
        const details = comparePathWithPoint(coordinates, point, isPointDegrees);
        addRange(pointComparisonDetails, details);
    }));
    /** @type {?} */
    let nearestPoint;
    /** @type {?} */
    let furthestPoint;
    /** @type {?} */
    let minPoint;
    /** @type {?} */
    let maxPoint;
    pointComparisonDetails.forEach((/**
     * @param {?} pointCandidate
     * @return {?}
     */
    pointCandidate => {
        if (!nearestPoint || pointCandidate.distance < nearestPoint.distance) {
            nearestPoint = pointCandidate;
        }
        if (!furthestPoint || pointCandidate.distance > furthestPoint.distance) {
            furthestPoint = pointCandidate;
        }
        if (!minPoint || pointCandidate.pointMeasure < minPoint.pointMeasure) {
            minPoint = pointCandidate;
        }
        if (!maxPoint || pointCandidate.pointMeasure > maxPoint.pointMeasure) {
            maxPoint = pointCandidate;
        }
    }));
    // const nearestPoint = pointComparisionDetails
    //   .reduce((accumulator, value) => accumulator.distance > value.distance ? value : accumulator);
    /** @type {?} */
    const pointBefore = pointComparisonDetails[nearestPoint.index - 1];
    /** @type {?} */
    const pointAfter = pointComparisonDetails[nearestPoint.index + 1];
    /** @type {?} */
    let nextPoint = pointAfter;
    /** @type {?} */
    let previousPoint = pointBefore;
    // NOTE: this logic handles the rare case where the distance of the test point matches both the next
    // and previous verticee.
    // 0-----4--------------------------100
    //          5
    if (pointBefore && pointAfter) {
        /** @type {?} */
        const beforDistance = getDistanceToLine(point, nearestPoint.pointCoordinate, pointBefore.pointCoordinate);
        /** @type {?} */
        const afterDistance = getDistanceToLine(point, nearestPoint.pointCoordinate, pointAfter.pointCoordinate);
        if (beforDistance < afterDistance) {
            nextPoint = pointBefore;
            previousPoint = pointComparisonDetails[nextPoint.index - 2];
        }
    }
    return {
        nearestPoint,
        furthestPoint,
        nextPoint,
        previousPoint,
        minPoint,
        maxPoint
    };
}
/**
 * @param {?} line
 * @param {?} point
 * @param {?=} isPointDegrees
 * @return {?}
 */
export function getClosestVerticees(line, point, isPointDegrees = true) {
    /** @type {?} */
    const info = getVerticeeInfos(line, point, isPointDegrees);
    return [
        info.nearestPoint ? info.nearestPoint.pointCoordinate : null,
        info.nextPoint ? info.nextPoint.pointCoordinate : null
    ];
}
/**
 * @param {?} line
 * @param {?} point
 * @param {?=} isPointDegrees
 * @return {?}
 */
export function getClosestVerticee(line, point, isPointDegrees = true) {
    const [firstClosest] = getClosestVerticees(line, point, isPointDegrees);
    return firstClosest;
}
/**
 * @param {?} coordinates
 * @param {?} pointToCompare
 * @param {?} isPointDegrees
 * @return {?}
 */
function comparePathWithPoint(coordinates, pointToCompare, isPointDegrees) {
    /** @type {?} */
    const pointComparisionDetailsFromPath = coordinates
        .map((/**
     * @param {?} coordinate
     * @param {?} index
     * @return {?}
     */
    (coordinate, index) => compareCoordinateWithPoint(coordinate, pointToCompare, isPointDegrees, index)));
    return pointComparisionDetailsFromPath;
}
/**
 * @param {?} coordinate
 * @param {?} pointToCompare
 * @return {?}
 */
function getDegreeDistance(coordinate, pointToCompare) {
    /** @type {?} */
    const coordinate2 = toSinglePartPointArray(pointToCompare);
    return getMetersBetweenLatLng(coordinate[1], coordinate[0], coordinate2[1], coordinate2[0]);
}
/**
 * @param {?} coordinate
 * @param {?} pointToCompare
 * @param {?} isPointDegrees
 * @param {?} index
 * @return {?}
 */
function compareCoordinateWithPoint(coordinate, pointToCompare, isPointDegrees, index) {
    /** @type {?} */
    const distance = isPointDegrees
        ? getDegreeDistance(coordinate, pointToCompare)
        : getDistanceBetweenPoints(coordinate, pointToCompare);
    /** @type {?} */
    const pointDetails = {
        pointCoordinate: coordinate,
        distance,
        index
    };
    return pointDetails;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0LW5lYXJlc3QtcG9pbnQtYnktZ2VvbWV0cnkuZnVuY3Rpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdHNzL3Nkay8iLCJzb3VyY2VzIjpbImxpYi9nZW9tZXRyeS9saW5lL2dldC1uZWFyZXN0LXBvaW50LWJ5LWdlb21ldHJ5LmZ1bmN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUdsRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSwrQ0FBK0MsQ0FBQztBQUNqSCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNoRixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNwRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0scUNBQXFDLENBQUM7Ozs7QUFHL0QseUNBT0M7OztJQU5DLDJDQUFxQzs7SUFDckMsNENBQXNDOztJQUN0Qyx1Q0FBaUM7O0lBQ2pDLHVDQUFpQzs7SUFDakMsd0NBQWtDOztJQUNsQyw0Q0FBc0M7Ozs7Ozs7O0FBSXhDLE1BQU0sVUFBVSxnQkFBZ0IsQ0FBQyxJQUFrQixFQUFFLEtBQWtCLEVBQUUsaUJBQTBCLElBQUk7O1VBQy9GLHNCQUFzQixHQUE2QixFQUFFOztVQUNyRCxLQUFLLEdBQWlCLGdCQUFnQixDQUFDLElBQUksQ0FBQztJQUVsRCxLQUFLLENBQUMsT0FBTzs7OztJQUFDLENBQUMsV0FBdUIsRUFBRSxFQUFFOztjQUNsQyxPQUFPLEdBQUcsb0JBQW9CLENBQUMsV0FBVyxFQUFFLEtBQUssRUFBRSxjQUFjLENBQUM7UUFDeEUsUUFBUSxDQUFDLHNCQUFzQixFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzVDLENBQUMsRUFBQyxDQUFDOztRQUVDLFlBQW9DOztRQUNwQyxhQUFxQzs7UUFDckMsUUFBZ0M7O1FBQ2hDLFFBQWdDO0lBRXBDLHNCQUFzQixD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QixDQUFDLFVBQW9CLEVBQUUsY0FBMkI7O1VBQ3BFLFdBQVcsR0FBYSxzQkFBc0IsQ0FBQyxjQUFjLENBQUM7SUFFcEUsT0FBTyxzQkFBc0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM5RixDQUFDOzs7Ozs7OztBQUVELFNBQVMsMEJBQTBCLENBQ2pDLFVBQW9CLEVBQ3BCLGNBQTJCLEVBQzNCLGNBQXVCLEVBQ3ZCLEtBQWE7O1VBRVAsUUFBUSxHQUFHLGNBQWM7UUFDN0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLFVBQVUsRUFBRSxjQUFjLENBQUM7UUFDL0MsQ0FBQyxDQUFDLHdCQUF3QixDQUFDLFVBQVUsRUFBRSxjQUFjLENBQUM7O1VBRWxELFlBQVksR0FBMkI7UUFDM0MsZUFBZSxFQUFFLFVBQVU7UUFDM0IsUUFBUTtRQUNSLEtBQUs7S0FDTjtJQUVELE9BQU8sWUFBWSxDQUFDO0FBQ3RCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMaW5lR2VvbWV0cnkgfSBmcm9tICcuL2xpbmUtZ2VvbWV0cnknO1xuaW1wb3J0IHsgdG9NdWx0aVBhcnRQYXRocyB9IGZyb20gJy4vdG8tbXVsdGktcGFydC1wYXRocy5mdW5jdGlvbic7XG5pbXBvcnQgeyBQb2ludENvbXBhcmlzb25EZXRhaWxzIH0gZnJvbSAnLi4vcG9pbnQvcG9pbnQtY29tcGFyaXNvbi1kZXRhaWxzJztcbmltcG9ydCB7IFNpbmdsZVBvaW50IH0gZnJvbSAnLi4vcG9pbnQvc2luZ2xlLXBvaW50JztcbmltcG9ydCB7IGdldERpc3RhbmNlQmV0d2VlblBvaW50cywgZ2V0TWV0ZXJzQmV0d2VlbkxhdExuZyB9IGZyb20gJy4uL3BvaW50L2dldC1kaXN0YW5jZS1iZXR3ZWVuLXBvaW50cy5mdW5jdGlvbic7XG5pbXBvcnQgeyB0b1NpbmdsZVBhcnRQb2ludEFycmF5IH0gZnJvbSAnLi4vcG9pbnQvdG8tc2luZ2xlLXBhcnQtcG9pbnQuZnVuY3Rpb24nO1xuaW1wb3J0IHsgZ2V0RGlzdGFuY2VUb0xpbmUgfSBmcm9tICcuL2dldC1kaXN0YW5jZS10by1saW5lLmZ1bmN0aW9uJztcbmltcG9ydCB7IGFkZFJhbmdlIH0gZnJvbSAnLi4vLi4vY29yZS9hcnJheS9hZGQtcmFuZ2UuZnVuY3Rpb24nO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgTGluZVZlcnRpY2VlU3VtbWFyeSB7XG4gIG5lYXJlc3RQb2ludDogUG9pbnRDb21wYXJpc29uRGV0YWlscztcbiAgZnVydGhlc3RQb2ludDogUG9pbnRDb21wYXJpc29uRGV0YWlscztcbiAgbWluUG9pbnQ6IFBvaW50Q29tcGFyaXNvbkRldGFpbHM7XG4gIG1heFBvaW50OiBQb2ludENvbXBhcmlzb25EZXRhaWxzO1xuICBuZXh0UG9pbnQ6IFBvaW50Q29tcGFyaXNvbkRldGFpbHM7XG4gIHByZXZpb3VzUG9pbnQ6IFBvaW50Q29tcGFyaXNvbkRldGFpbHM7XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFZlcnRpY2VlSW5mb3MobGluZTogTGluZUdlb21ldHJ5LCBwb2ludDogU2luZ2xlUG9pbnQsIGlzUG9pbnREZWdyZWVzOiBib29sZWFuID0gdHJ1ZSk6IExpbmVWZXJ0aWNlZVN1bW1hcnkge1xuICBjb25zdCBwb2ludENvbXBhcmlzb25EZXRhaWxzOiBQb2ludENvbXBhcmlzb25EZXRhaWxzW10gPSBbXTtcbiAgY29uc3QgcGF0aHM6IG51bWJlcltdW11bXSA9IHRvTXVsdGlQYXJ0UGF0aHMobGluZSk7XG5cbiAgcGF0aHMuZm9yRWFjaCgoY29vcmRpbmF0ZXM6IG51bWJlcltdW10pID0+IHtcbiAgICBjb25zdCBkZXRhaWxzID0gY29tcGFyZVBhdGhXaXRoUG9pbnQoY29vcmRpbmF0ZXMsIHBvaW50LCBpc1BvaW50RGVncmVlcyk7XG4gICAgYWRkUmFuZ2UocG9pbnRDb21wYXJpc29uRGV0YWlscywgZGV0YWlscyk7XG4gIH0pO1xuXG4gIGxldCBuZWFyZXN0UG9pbnQ6IFBvaW50Q29tcGFyaXNvbkRldGFpbHM7XG4gIGxldCBmdXJ0aGVzdFBvaW50OiBQb2ludENvbXBhcmlzb25EZXRhaWxzO1xuICBsZXQgbWluUG9pbnQ6IFBvaW50Q29tcGFyaXNvbkRldGFpbHM7XG4gIGxldCBtYXhQb2ludDogUG9pbnRDb21wYXJpc29uRGV0YWlscztcblxuICBwb2ludENvbXBhcmlzb25EZXRhaWxzLmZvckVhY2gocG9pbnRDYW5kaWRhdGUgPT4ge1xuICAgIGlmICghbmVhcmVzdFBvaW50IHx8IHBvaW50Q2FuZGlkYXRlLmRpc3RhbmNlIDwgbmVhcmVzdFBvaW50LmRpc3RhbmNlKSB7XG4gICAgICBuZWFyZXN0UG9pbnQgPSBwb2ludENhbmRpZGF0ZTtcbiAgICB9XG5cbiAgICBpZiAoIWZ1cnRoZXN0UG9pbnQgfHwgcG9pbnRDYW5kaWRhdGUuZGlzdGFuY2UgPiBmdXJ0aGVzdFBvaW50LmRpc3RhbmNlKSB7XG4gICAgICBmdXJ0aGVzdFBvaW50ID0gcG9pbnRDYW5kaWRhdGU7XG4gICAgfVxuXG4gICAgaWYgKCFtaW5Qb2ludCB8fCBwb2ludENhbmRpZGF0ZS5wb2ludE1lYXN1cmUgPCBtaW5Qb2ludC5wb2ludE1lYXN1cmUpIHtcbiAgICAgIG1pblBvaW50ID0gcG9pbnRDYW5kaWRhdGU7XG4gICAgfVxuXG4gICAgaWYgKCFtYXhQb2ludCB8fCBwb2ludENhbmRpZGF0ZS5wb2ludE1lYXN1cmUgPiBtYXhQb2ludC5wb2ludE1lYXN1cmUpIHtcbiAgICAgIG1heFBvaW50ID0gcG9pbnRDYW5kaWRhdGU7XG4gICAgfVxuICB9KTtcblxuICAvLyBjb25zdCBuZWFyZXN0UG9pbnQgPSBwb2ludENvbXBhcmlzaW9uRGV0YWlsc1xuICAvLyAgIC5yZWR1Y2UoKGFjY3VtdWxhdG9yLCB2YWx1ZSkgPT4gYWNjdW11bGF0b3IuZGlzdGFuY2UgPiB2YWx1ZS5kaXN0YW5jZSA/IHZhbHVlIDogYWNjdW11bGF0b3IpO1xuXG4gIGNvbnN0IHBvaW50QmVmb3JlID0gcG9pbnRDb21wYXJpc29uRGV0YWlsc1tuZWFyZXN0UG9pbnQuaW5kZXggLSAxXTtcbiAgY29uc3QgcG9pbnRBZnRlciA9IHBvaW50Q29tcGFyaXNvbkRldGFpbHNbbmVhcmVzdFBvaW50LmluZGV4ICsgMV07XG4gIGxldCBuZXh0UG9pbnQgPSBwb2ludEFmdGVyO1xuICBsZXQgcHJldmlvdXNQb2ludCA9IHBvaW50QmVmb3JlO1xuXG4gIC8vIE5PVEU6IHRoaXMgbG9naWMgaGFuZGxlcyB0aGUgcmFyZSBjYXNlIHdoZXJlIHRoZSBkaXN0YW5jZSBvZiB0aGUgdGVzdCBwb2ludCBtYXRjaGVzIGJvdGggdGhlIG5leHRcbiAgLy8gYW5kIHByZXZpb3VzIHZlcnRpY2VlLlxuICAvLyAwLS0tLS00LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0xMDBcbiAgLy8gICAgICAgICAgNVxuICBpZiAocG9pbnRCZWZvcmUgJiYgcG9pbnRBZnRlcikge1xuICAgIGNvbnN0IGJlZm9yRGlzdGFuY2UgPSBnZXREaXN0YW5jZVRvTGluZShwb2ludCwgbmVhcmVzdFBvaW50LnBvaW50Q29vcmRpbmF0ZSwgcG9pbnRCZWZvcmUucG9pbnRDb29yZGluYXRlKTtcbiAgICBjb25zdCBhZnRlckRpc3RhbmNlID0gZ2V0RGlzdGFuY2VUb0xpbmUocG9pbnQsIG5lYXJlc3RQb2ludC5wb2ludENvb3JkaW5hdGUsIHBvaW50QWZ0ZXIucG9pbnRDb29yZGluYXRlKTtcblxuICAgIGlmIChiZWZvckRpc3RhbmNlIDwgYWZ0ZXJEaXN0YW5jZSkge1xuICAgICAgbmV4dFBvaW50ID0gcG9pbnRCZWZvcmU7XG4gICAgICBwcmV2aW91c1BvaW50ID0gcG9pbnRDb21wYXJpc29uRGV0YWlsc1tuZXh0UG9pbnQuaW5kZXggLSAyXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG5lYXJlc3RQb2ludCxcbiAgICBmdXJ0aGVzdFBvaW50LFxuICAgIG5leHRQb2ludCxcbiAgICBwcmV2aW91c1BvaW50LFxuICAgIG1pblBvaW50LFxuICAgIG1heFBvaW50XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDbG9zZXN0VmVydGljZWVzKFxuICBsaW5lOiBMaW5lR2VvbWV0cnksXG4gIHBvaW50OiBTaW5nbGVQb2ludCxcbiAgaXNQb2ludERlZ3JlZXM6IGJvb2xlYW4gPSB0cnVlXG4pOiBbU2luZ2xlUG9pbnQgfCBudWxsLCBTaW5nbGVQb2ludCB8IG51bGxdIHtcbiAgY29uc3QgaW5mbyA9IGdldFZlcnRpY2VlSW5mb3MobGluZSwgcG9pbnQsIGlzUG9pbnREZWdyZWVzKTtcblxuICByZXR1cm4gW1xuICAgIGluZm8ubmVhcmVzdFBvaW50ID8gaW5mby5uZWFyZXN0UG9pbnQucG9pbnRDb29yZGluYXRlIDogbnVsbCxcbiAgICBpbmZvLm5leHRQb2ludCA/IGluZm8ubmV4dFBvaW50LnBvaW50Q29vcmRpbmF0ZSA6IG51bGxcbiAgXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENsb3Nlc3RWZXJ0aWNlZShsaW5lOiBMaW5lR2VvbWV0cnksIHBvaW50OiBTaW5nbGVQb2ludCwgaXNQb2ludERlZ3JlZXM6IGJvb2xlYW4gPSB0cnVlKTogU2luZ2xlUG9pbnQge1xuICBjb25zdCBbZmlyc3RDbG9zZXN0XSA9IGdldENsb3Nlc3RWZXJ0aWNlZXMobGluZSwgcG9pbnQsIGlzUG9pbnREZWdyZWVzKTtcbiAgcmV0dXJuIGZpcnN0Q2xvc2VzdDtcbn1cblxuZnVuY3Rpb24gY29tcGFyZVBhdGhXaXRoUG9pbnQoY29vcmRpbmF0ZXM6IG51bWJlcltdW10sIHBvaW50VG9Db21wYXJlOiBTaW5nbGVQb2ludCwgaXNQb2ludERlZ3JlZXM6IGJvb2xlYW4pOiBQb2ludENvbXBhcmlzb25EZXRhaWxzW10ge1xuICBjb25zdCBwb2ludENvbXBhcmlzaW9uRGV0YWlsc0Zyb21QYXRoOiBQb2ludENvbXBhcmlzb25EZXRhaWxzW10gPSBjb29yZGluYXRlc1xuICAgIC5tYXAoXG4gICAgICAoY29vcmRpbmF0ZTogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpID0+IGNvbXBhcmVDb29yZGluYXRlV2l0aFBvaW50KGNvb3JkaW5hdGUsIHBvaW50VG9Db21wYXJlLCBpc1BvaW50RGVncmVlcywgaW5kZXgpXG4gICAgKTtcblxuICByZXR1cm4gcG9pbnRDb21wYXJpc2lvbkRldGFpbHNGcm9tUGF0aDtcbn1cblxuZnVuY3Rpb24gZ2V0RGVncmVlRGlzdGFuY2UoY29vcmRpbmF0ZTogbnVtYmVyW10sIHBvaW50VG9Db21wYXJlOiBTaW5nbGVQb2ludCk6IG51bWJlciB7XG4gIGNvbnN0IGNvb3JkaW5hdGUyOiBudW1iZXJbXSA9IHRvU2luZ2xlUGFydFBvaW50QXJyYXkocG9pbnRUb0NvbXBhcmUpO1xuXG4gIHJldHVybiBnZXRNZXRlcnNCZXR3ZWVuTGF0TG5nKGNvb3JkaW5hdGVbMV0sIGNvb3JkaW5hdGVbMF0sIGNvb3JkaW5hdGUyWzFdLCBjb29yZGluYXRlMlswXSk7XG59XG5cbmZ1bmN0aW9uIGNvbXBhcmVDb29yZGluYXRlV2l0aFBvaW50KFxuICBjb29yZGluYXRlOiBudW1iZXJbXSxcbiAgcG9pbnRUb0NvbXBhcmU6IFNpbmdsZVBvaW50LFxuICBpc1BvaW50RGVncmVlczogYm9vbGVhbixcbiAgaW5kZXg6IG51bWJlclxuKTogUG9pbnRDb21wYXJpc29uRGV0YWlscyB7XG4gIGNvbnN0IGRpc3RhbmNlID0gaXNQb2ludERlZ3JlZXNcbiAgICA/IGdldERlZ3JlZURpc3RhbmNlKGNvb3JkaW5hdGUsIHBvaW50VG9Db21wYXJlKVxuICAgIDogZ2V0RGlzdGFuY2VCZXR3ZWVuUG9pbnRzKGNvb3JkaW5hdGUsIHBvaW50VG9Db21wYXJlKTtcblxuICBjb25zdCBwb2ludERldGFpbHM6IFBvaW50Q29tcGFyaXNvbkRldGFpbHMgPSB7XG4gICAgcG9pbnRDb29yZGluYXRlOiBjb29yZGluYXRlLFxuICAgIGRpc3RhbmNlLFxuICAgIGluZGV4XG4gIH07XG5cbiAgcmV0dXJuIHBvaW50RGV0YWlscztcbn1cbiJdfQ==