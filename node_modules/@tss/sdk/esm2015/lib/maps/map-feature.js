/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// TSS.
import { getMeasureExtent } from '../geometry/geometry/get-measure-extent.function';
import { isLine } from '../geometry/geometry/is-line.function';
import { getIdFieldFieldName, isFieldExpression } from './fields/layer-field';
import { getCodedValueNameOrDefault } from './fields/get-coded-value-name-or-default.function';
import { evaluteFeatureDataExpression } from '../lrs/data/evaluate-feature-data-expression.function';
import { isPoint } from '../geometry/geometry/is-point.function';
import { isPolygon } from '../geometry/geometry/is-polygon.function';
import { WGS_84_SRID } from '../geometry/geometry.constants';
import { clone } from '../core/clone/clone.function';
export class MapFeature {
    /**
     * @return {?}
     */
    get layerId() {
        return this.layer ? this.layer.id : null;
    }
    /**
     * @return {?}
     */
    get hasZ() {
        return this.layer.hasZ;
    }
    /**
     * @return {?}
     */
    get hasM() {
        return this.layer.hasM;
    }
    /**
     * @param {?} feature
     * @param {?} layer
     * @param {?=} spatialReferenceId
     */
    constructor(feature, layer, spatialReferenceId = WGS_84_SRID) {
        this.id = feature.id;
        this.properties = feature.properties;
        this.type = feature.type;
        this.bbox = feature.bbox;
        this.layer = layer;
        this.spatialReferenceId = spatialReferenceId;
        /** @type {?} */
        const idFieldName = this.getIdFieldName();
        this.id = this.id || this.getValue(idFieldName);
        this.displayValue = this.getValue(layer.displayField);
        this.setGeometry(feature.geometry);
    }
    /**
     * @return {?}
     */
    getIdFieldName() {
        return getIdFieldFieldName(this.layer.fields);
    }
    /**
     * @param {?} fieldNameOrExpression
     * @return {?}
     */
    getValue(fieldNameOrExpression) {
        return isFieldExpression(fieldNameOrExpression)
            ? evaluteFeatureDataExpression(fieldNameOrExpression, this)
            : this.properties && this.properties[fieldNameOrExpression];
    }
    /**
     * @param {?} fieldName
     * @return {?}
     */
    getCodedValueNameOrDefault(fieldName) {
        /** @type {?} */
        const value = this.getValue(fieldName);
        /** @type {?} */
        const field = this.layer.getField(fieldName);
        return getCodedValueNameOrDefault(field, value);
    }
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} fieldName
     * @param {?} value
     * @return {THIS}
     */
    setValue(fieldName, value) {
        (/** @type {?} */ (this)).properties[fieldName] = value;
        return (/** @type {?} */ (this));
    }
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} id
     * @return {THIS}
     */
    setId(id) {
        (/** @type {?} */ (this)).id = id;
        (/** @type {?} */ (this)).setValue(getIdFieldFieldName((/** @type {?} */ (this)).layer.fields), id);
        return (/** @type {?} */ (this));
    }
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} geometry
     * @return {THIS}
     */
    setGeometry(geometry) {
        (/** @type {?} */ (this)).geometry = geometry;
        return (/** @type {?} */ (this)).setGeometryTypeProperties();
    }
    /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    setMeasureFromGeometry() {
        if ((/** @type {?} */ (this)).geometry) {
            /** @type {?} */
            const extent = getMeasureExtent((/** @type {?} */ (this)).geometry);
            (/** @type {?} */ (this)).fromMeasure = extent.min;
            (/** @type {?} */ (this)).toMeasure = extent.max;
        }
        return (/** @type {?} */ (this));
    }
    /**
     * @return {?}
     */
    isSpatialReferenceWgs84() {
        return this.spatialReferenceId === WGS_84_SRID;
    }
    /**
     * @return {?}
     */
    clone() {
        /** @type {?} */
        const copyFeature = clone(this.toFeature());
        return new MapFeature(copyFeature, this.layer);
    }
    /**
     * @return {?}
     */
    toFeature() {
        /** @type {?} */
        const feature = {
            type: 'Feature',
            geometry: this.geometry,
            properties: this.properties,
            id: this.id,
            bbox: this.bbox,
        };
        return feature;
    }
    /**
     * @return {?}
     */
    toGeoJson() {
        return this.toFeature();
    }
    /**
     * @protected
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    setGeometryTypeProperties() {
        (/** @type {?} */ (this)).isLinear = isLine((/** @type {?} */ (this)).geometry);
        (/** @type {?} */ (this)).isPoint = isPoint((/** @type {?} */ (this)).geometry);
        (/** @type {?} */ (this)).isPolygon = isPolygon((/** @type {?} */ (this)).geometry);
        return (/** @type {?} */ (this));
    }
}
if (false) {
    /** @type {?} */
    MapFeature.prototype.id;
    /** @type {?} */
    MapFeature.prototype.geometry;
    /** @type {?} */
    MapFeature.prototype.properties;
    /** @type {?} */
    MapFeature.prototype.bbox;
    /** @type {?} */
    MapFeature.prototype.type;
    /** @type {?} */
    MapFeature.prototype.routeId;
    /** @type {?} */
    MapFeature.prototype.fromMeasure;
    /** @type {?} */
    MapFeature.prototype.toMeasure;
    /** @type {?} */
    MapFeature.prototype.layer;
    /** @type {?} */
    MapFeature.prototype.displayValue;
    /** @type {?} */
    MapFeature.prototype.styleValue;
    /** @type {?} */
    MapFeature.prototype.isLinear;
    /** @type {?} */
    MapFeature.prototype.isPoint;
    /** @type {?} */
    MapFeature.prototype.isPolygon;
    /** @type {?} */
    MapFeature.prototype.viewDate;
    /** @type {?} */
    MapFeature.prototype.gdbVersion;
    /** @type {?} */
    MapFeature.prototype.spatialReferenceId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFwLWZlYXR1cmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdHNzL3Nkay8iLCJzb3VyY2VzIjpbImxpYi9tYXBzL21hcC1mZWF0dXJlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBSUEsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDcEYsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQy9ELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzlFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLG1EQUFtRCxDQUFDO0FBQy9GLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLHVEQUF1RCxDQUFDO0FBRXJHLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNqRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFDckUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRTdELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUdyRCxNQUFNLE9BQU8sVUFBVTs7OztJQW9CckIsSUFBSSxPQUFPO1FBQ1QsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQzNDLENBQUM7Ozs7SUFFRCxJQUFJLElBQUk7UUFDTixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7Ozs7SUFFRCxJQUFJLElBQUk7UUFDTixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7Ozs7OztJQUVELFlBQVksT0FBZ0IsRUFBRSxLQUF3QixFQUFFLGtCQUFrQixHQUFHLFdBQVc7UUFDdEYsSUFBSSxDQUFDLEVBQUUsR0FBRyxP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SUFDakIsK0JBQW1COztJQUNuQiw4QkFBZ0I7O0lBQ2hCLGdDQUFvQjs7SUFDcEIsd0NBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gM3JkIFBhcnR5LlxuaW1wb3J0IHsgRmVhdHVyZSwgR2VvbWV0cnksIEdlb0pzb25Qcm9wZXJ0aWVzLCBCQm94IH0gZnJvbSAnZ2VvanNvbic7XG5cbi8vIFRTUy5cbmltcG9ydCB7IGdldE1lYXN1cmVFeHRlbnQgfSBmcm9tICcuLi9nZW9tZXRyeS9nZW9tZXRyeS9nZXQtbWVhc3VyZS1leHRlbnQuZnVuY3Rpb24nO1xuaW1wb3J0IHsgaXNMaW5lIH0gZnJvbSAnLi4vZ2VvbWV0cnkvZ2VvbWV0cnkvaXMtbGluZS5mdW5jdGlvbic7XG5pbXBvcnQgeyBnZXRJZEZpZWxkRmllbGROYW1lLCBpc0ZpZWxkRXhwcmVzc2lvbiB9IGZyb20gJy4vZmllbGRzL2xheWVyLWZpZWxkJztcbmltcG9ydCB7IGdldENvZGVkVmFsdWVOYW1lT3JEZWZhdWx0IH0gZnJvbSAnLi9maWVsZHMvZ2V0LWNvZGVkLXZhbHVlLW5hbWUtb3ItZGVmYXVsdC5mdW5jdGlvbic7XG5pbXBvcnQgeyBldmFsdXRlRmVhdHVyZURhdGFFeHByZXNzaW9uIH0gZnJvbSAnLi4vbHJzL2RhdGEvZXZhbHVhdGUtZmVhdHVyZS1kYXRhLWV4cHJlc3Npb24uZnVuY3Rpb24nO1xuaW1wb3J0IHsgRmVhdHVyZUNsYXNzTGF5ZXIgfSBmcm9tICcuL2ZlYXR1cmUtY2xhc3MtbGF5ZXInO1xuaW1wb3J0IHsgaXNQb2ludCB9IGZyb20gJy4uL2dlb21ldHJ5L2dlb21ldHJ5L2lzLXBvaW50LmZ1bmN0aW9uJztcbmltcG9ydCB7IGlzUG9seWdvbiB9IGZyb20gJy4uL2dlb21ldHJ5L2dlb21ldHJ5L2lzLXBvbHlnb24uZnVuY3Rpb24nO1xuaW1wb3J0IHsgV0dTXzg0X1NSSUQgfSBmcm9tICcuLi9nZW9tZXRyeS9nZW9tZXRyeS5jb25zdGFudHMnO1xuaW1wb3J0IHsgQ2xvbmVhYmxlIH0gZnJvbSAnLi4vY29yZS9jbG9uZS9jbG9uZWFibGUnO1xuaW1wb3J0IHsgY2xvbmUgfSBmcm9tICcuLi9jb3JlL2Nsb25lL2Nsb25lLmZ1bmN0aW9uJztcblxuXG5leHBvcnQgY2xhc3MgTWFwRmVhdHVyZSBpbXBsZW1lbnRzIEZlYXR1cmUsIENsb25lYWJsZTxNYXBGZWF0dXJlPiB7XG4gIGlkPzogc3RyaW5nIHwgbnVtYmVyO1xuICBnZW9tZXRyeTogR2VvbWV0cnk7XG4gIHByb3BlcnRpZXM6IEdlb0pzb25Qcm9wZXJ0aWVzO1xuICBiYm94OiBCQm94O1xuICB0eXBlOiAnRmVhdHVyZSc7XG5cbiAgcm91dGVJZDogc3RyaW5nO1xuICBmcm9tTWVhc3VyZTogbnVtYmVyO1xuICB0b01lYXN1cmU6IG51bWJlcjtcbiAgbGF5ZXI6IEZlYXR1cmVDbGFzc0xheWVyO1xuICBkaXNwbGF5VmFsdWU6IGFueTtcbiAgc3R5bGVWYWx1ZTogYW55O1xuICBpc0xpbmVhcjogYm9vbGVhbjtcbiAgaXNQb2ludDogYm9vbGVhbjtcbiAgaXNQb2x5Z29uOiBib29sZWFuO1xuICB2aWV3RGF0ZT86IERhdGU7XG4gIGdkYlZlcnNpb24/OiBzdHJpbmc7XG4gIHNwYXRpYWxSZWZlcmVuY2VJZD86IG51bWJlcjtcblxuICBnZXQgbGF5ZXJJZCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmxheWVyID8gdGhpcy5sYXllci5pZCA6IG51bGw7XG4gIH1cblxuICBnZXQgaGFzWigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5sYXllci5oYXNaO1xuICB9XG5cbiAgZ2V0IGhhc00oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMubGF5ZXIuaGFzTTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGZlYXR1cmU6IEZlYXR1cmUsIGxheWVyOiBGZWF0dXJlQ2xhc3NMYXllciwgc3BhdGlhbFJlZmVyZW5jZUlkID0gV0dTXzg0X1NSSUQpIHtcbiAgICB0aGlzLmlkID0gZmVhdHVyZS5pZDtcbiAgICB0aGlzLnByb3BlcnRpZXMgPSBmZWF0dXJlLnByb3BlcnRpZXM7XG4gICAgdGhpcy50eXBlID0gZmVhdHVyZS50eXBlO1xuICAgIHRoaXMuYmJveCA9IGZlYXR1cmUuYmJveDtcbiAgICB0aGlzLmxheWVyID0gbGF5ZXI7XG4gICAgdGhpcy5zcGF0aWFsUmVmZXJlbmNlSWQgPSBzcGF0aWFsUmVmZXJlbmNlSWQ7XG5cbiAgICBjb25zdCBpZEZpZWxkTmFtZSA9IHRoaXMuZ2V0SWRGaWVsZE5hbWUoKTtcblxuICAgIHRoaXMuaWQgPSB0aGlzLmlkIHx8IHRoaXMuZ2V0VmFsdWUoaWRGaWVsZE5hbWUpO1xuICAgIHRoaXMuZGlzcGxheVZhbHVlID0gdGhpcy5nZXRWYWx1ZShsYXllci5kaXNwbGF5RmllbGQpO1xuICAgIHRoaXMuc2V0R2VvbWV0cnkoZmVhdHVyZS5nZW9tZXRyeSk7XG4gIH1cblxuICBnZXRJZEZpZWxkTmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBnZXRJZEZpZWxkRmllbGROYW1lKHRoaXMubGF5ZXIuZmllbGRzKTtcbiAgfVxuXG4gIGdldFZhbHVlKGZpZWxkTmFtZU9yRXhwcmVzc2lvbjogc3RyaW5nKTogYW55IHtcbiAgICByZXR1cm4gaXNGaWVsZEV4cHJlc3Npb24oZmllbGROYW1lT3JFeHByZXNzaW9uKVxuICAgICAgPyBldmFsdXRlRmVhdHVyZURhdGFFeHByZXNzaW9uKGZpZWxkTmFtZU9yRXhwcmVzc2lvbiwgdGhpcylcbiAgICAgIDogdGhpcy5wcm9wZXJ0aWVzICYmIHRoaXMucHJvcGVydGllc1tmaWVsZE5hbWVPckV4cHJlc3Npb25dO1xuICB9XG5cbiAgZ2V0Q29kZWRWYWx1ZU5hbWVPckRlZmF1bHQoZmllbGROYW1lOiBzdHJpbmcpOiBhbnkge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRWYWx1ZShmaWVsZE5hbWUpO1xuICAgIGNvbnN0IGZpZWxkID0gdGhpcy5sYXllci5nZXRGaWVsZChmaWVsZE5hbWUpO1xuICAgIHJldHVybiBnZXRDb2RlZFZhbHVlTmFtZU9yRGVmYXVsdChmaWVsZCwgdmFsdWUpO1xuICB9XG5cbiAgc2V0VmFsdWUoZmllbGROYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkpOiB0aGlzIHtcbiAgICB0aGlzLnByb3BlcnRpZXNbZmllbGROYW1lXSA9IHZhbHVlO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2V0SWQoaWQ6IHN0cmluZyB8IG51bWJlcik6IHRoaXMge1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLnNldFZhbHVlKGdldElkRmllbGRGaWVsZE5hbWUodGhpcy5sYXllci5maWVsZHMpLCBpZCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZXRHZW9tZXRyeShnZW9tZXRyeTogR2VvbWV0cnkpOiB0aGlzIHtcbiAgICB0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnk7XG4gICAgcmV0dXJuIHRoaXMuc2V0R2VvbWV0cnlUeXBlUHJvcGVydGllcygpO1xuICB9XG5cbiAgc2V0TWVhc3VyZUZyb21HZW9tZXRyeSgpOiB0aGlzIHtcbiAgICBpZiAodGhpcy5nZW9tZXRyeSkge1xuICAgICAgY29uc3QgZXh0ZW50ID0gZ2V0TWVhc3VyZUV4dGVudCh0aGlzLmdlb21ldHJ5KTtcbiAgICAgIHRoaXMuZnJvbU1lYXN1cmUgPSBleHRlbnQubWluO1xuICAgICAgdGhpcy50b01lYXN1cmUgPSBleHRlbnQubWF4O1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGlzU3BhdGlhbFJlZmVyZW5jZVdnczg0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnNwYXRpYWxSZWZlcmVuY2VJZCA9PT0gV0dTXzg0X1NSSUQ7XG4gIH1cblxuICBjbG9uZSgpOiBNYXBGZWF0dXJlIHtcbiAgICBjb25zdCBjb3B5RmVhdHVyZSA9IGNsb25lKHRoaXMudG9GZWF0dXJlKCkpO1xuICAgIHJldHVybiBuZXcgTWFwRmVhdHVyZShjb3B5RmVhdHVyZSwgdGhpcy5sYXllcik7XG4gIH1cblxuICB0b0ZlYXR1cmUoKTogRmVhdHVyZSB7XG4gICAgY29uc3QgZmVhdHVyZTogRmVhdHVyZSA9IHtcbiAgICAgIHR5cGU6ICdGZWF0dXJlJyxcbiAgICAgIGdlb21ldHJ5OiB0aGlzLmdlb21ldHJ5LFxuICAgICAgcHJvcGVydGllczogdGhpcy5wcm9wZXJ0aWVzLFxuICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICBiYm94OiB0aGlzLmJib3gsXG4gICAgfTtcblxuICAgIHJldHVybiBmZWF0dXJlO1xuICB9XG5cbiAgdG9HZW9Kc29uKCk6IEZlYXR1cmUge1xuICAgIHJldHVybiB0aGlzLnRvRmVhdHVyZSgpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHNldEdlb21ldHJ5VHlwZVByb3BlcnRpZXMoKTogdGhpcyB7XG4gICAgdGhpcy5pc0xpbmVhciA9IGlzTGluZSh0aGlzLmdlb21ldHJ5KTtcbiAgICB0aGlzLmlzUG9pbnQgPSBpc1BvaW50KHRoaXMuZ2VvbWV0cnkpO1xuICAgIHRoaXMuaXNQb2x5Z29uID0gaXNQb2x5Z29uKHRoaXMuZ2VvbWV0cnkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG59XG4iXX0=