/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { isClassBreakInfoEmpty } from './class-break-info';
import { isUniqueValueInfoEmpty } from './unique-value-info';
import { isArray } from '../../core/type-check/is-array.function';
import { rgbToHex } from '../../core/color/rgb-to-hex.function';
import { removeWhere } from '../../core/array/remove-where.function';
/** @type {?} */
export const DEFAULT_UNIQUE_VALUE_INFO = null;
/** @type {?} */
export const DEFAULT_CLASS_BREAK_VALUE_INFO = null;
/** @type {?} */
export const DEFAULT_RENDERER_SYMBOL = {
    type: 'esriSLS',
    style: 'esriSLSSolid',
    color: '#000000',
    width: 2
};
/**
 * @param {?} symbol
 * @return {?}
 */
export function isRendererSymbolDefault(symbol) {
    return Object.keys(symbol).length === Object.keys(DEFAULT_RENDERER_SYMBOL).length
        && symbol.type === DEFAULT_RENDERER_SYMBOL.type
        && symbol.style === DEFAULT_RENDERER_SYMBOL.style
        && symbol.color === DEFAULT_RENDERER_SYMBOL.color
        && symbol.width === DEFAULT_RENDERER_SYMBOL.width;
}
export class LayerDrawingInfoRenderer {
    /**
     * @return {?}
     */
    get isSimple() {
        return this.type === 'simple';
    }
    /**
     * @return {?}
     */
    get isUniqueValue() {
        return this.type === 'uniqueValue';
    }
    /**
     * @return {?}
     */
    get isClassBreak() {
        return this.type === 'classBreaks';
    }
    /**
     * @return {?}
     */
    get isEmpty() {
        return !this.minValue
            && !this.classBreakInfos.length
            && !this.uniqueValueInfos.length
            && isRendererSymbolDefault(this.symbol);
    }
    /**
     * @return {?}
     */
    get field() {
        return this.field1;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set field(value) {
        this.field1 = value;
    }
    /**
     * @param {?=} base
     */
    constructor(base) {
        Object.assign(this, base);
        this.type = this.type || 'simple';
        this.minValue = this.minValue || 0;
        this.classBreakInfos = this.classBreakInfos || [];
        this.uniqueValueInfos = this.uniqueValueInfos || [];
        this.symbol = Object.assign({}, DEFAULT_RENDERER_SYMBOL, this.symbol);
        this.label = this.label || '';
        this.description = this.description || '';
        this.standardizeRenderSymbols();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    getSymbol(value) {
        /** @type {?} */
        let symbol = this.symbol || this.defaultSymbol;
        if (this.isUniqueValue) {
            /** @type {?} */
            const uniqueValueInfo = this.getUniqueValueInfoOrDefault(value);
            symbol = isUniqueValueInfoEmpty(uniqueValueInfo) ? null : uniqueValueInfo.symbol;
        }
        else if (this.isClassBreak) {
            /** @type {?} */
            const classBreakInfo = this.getClassBreakInfoOrDefault(value);
            symbol = isClassBreakInfoEmpty(classBreakInfo) ? null : classBreakInfo.symbol;
        }
        return symbol || this.defaultSymbol || null;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    getUniqueValueInfo(value) {
        if (!this.uniqueValueInfos || !this.uniqueValueInfos.length) {
            return null;
        }
        return this.uniqueValueInfos.find((/**
         * @param {?} info
         * @return {?}
         */
        info => info.value === value || String(info.value) === String(value)));
    }
    /**
     * @param {?} value
     * @return {?}
     */
    getUniqueValueInfoOrDefault(value) {
        return this.getUniqueValueInfo(value) || DEFAULT_UNIQUE_VALUE_INFO;
    }
    /**
     * @param {?} classValue
     * @return {?}
     */
    getClassBreakInfo(classValue) {
        if (!this.classBreakInfos || !this.classBreakInfos.length) {
            return null;
        }
        return this.classBreakInfos.find((/**
         * @param {?} value
         * @param {?} index
         * @return {?}
         */
        (value, index) => this.isValueInClassBreakRange(value, classValue, index)));
    }
    /**
     * @param {?} value
     * @return {?}
     */
    getClassBreakInfoOrDefault(value) {
        return this.getClassBreakInfo(value) || DEFAULT_CLASS_BREAK_VALUE_INFO;
    }
    /**
     * @param {?} classBreakInfo
     * @param {?} value
     * @param {?} index
     * @return {?}
     */
    isValueInClassBreakRange(classBreakInfo, value, index) {
        /** @type {?} */
        const rangeMin = index === 0 ? this.minValue : this.classBreakInfos[index - 1].classMaxValue;
        /** @type {?} */
        const rangeMax = classBreakInfo.classMaxValue;
        return rangeMin < value && rangeMax > value;
    }
    /**
     * @return {?}
     */
    clearEmptyInfos() {
        removeWhere(this.uniqueValueInfos, (/**
         * @param {?} info
         * @return {?}
         */
        info => isUniqueValueInfoEmpty(info)));
        removeWhere(this.classBreakInfos, (/**
         * @param {?} info
         * @return {?}
         */
        info => isClassBreakInfoEmpty(info)));
    }
    /**
     * @param {?=} value
     * @return {?}
     */
    getBestRepresentativeColor(value) {
        /** @type {?} */
        let symbol = this.defaultSymbol || this.symbol;
        if (this.isUniqueValue && this.uniqueValueInfos.length) {
            /** @type {?} */
            const foundInfo = this.getUniqueValueInfo(value);
            symbol = foundInfo ? foundInfo.symbol : this.uniqueValueInfos[0].symbol;
        }
        else if (this.isClassBreak && this.classBreakInfos.length) {
            /** @type {?} */
            const foundInfo = this.getClassBreakInfo(value);
            symbol = foundInfo ? foundInfo.symbol : this.classBreakInfos[0].symbol;
        }
        return (/** @type {?} */ (symbol.color));
    }
    /**
     * @return {?}
     */
    standardizeRenderSymbols() {
        standardizeRenderSymbol(this.defaultSymbol);
        standardizeRenderSymbol(this.symbol);
        this.uniqueValueInfos.forEach((/**
         * @param {?} info
         * @return {?}
         */
        info => standardizeRenderSymbol(info.symbol)));
        this.classBreakInfos.forEach((/**
         * @param {?} info
         * @return {?}
         */
        info => standardizeRenderSymbol(info.symbol)));
    }
}
if (false) {
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.type;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.field1;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.field2;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.field3;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.fieldDelimiter;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.valueExpression;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.classificationMethod;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.minValue;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.classBreakInfos;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.uniqueValueInfos;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.label;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.defaultLabel;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.description;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.defaultSymbol;
    /** @type {?} */
    LayerDrawingInfoRenderer.prototype.symbol;
}
/**
 * @param {?} symbol
 * @return {?}
 */
function standardizeRenderSymbol(symbol) {
    if (!symbol) {
        return;
    }
    if (isArray(symbol.color)) {
        symbol.color = rgbToHex((/** @type {?} */ (symbol.color)));
    }
    if (symbol.outline && isArray(symbol.outline.color)) {
        symbol.outline.color = rgbToHex((/** @type {?} */ (symbol.outline.color)));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF5ZXItZHJhd2luZy1pbmZvLXJlbmRlcmVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRzcy9zZGsvIiwic291cmNlcyI6WyJsaWIvbWFwcy9kcmF3aW5nL2xheWVyLWRyYXdpbmctaW5mby1yZW5kZXJlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFrQixxQkFBcUIsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzNFLE9BQU8sRUFBbUIsc0JBQXNCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUU5RSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDbEUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQ2hFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQzs7QUFHckUsTUFBTSxPQUFPLHlCQUF5QixHQUFHLElBQUk7O0FBQzdDLE1BQU0sT0FBTyw4QkFBOEIsR0FBRyxJQUFJOztBQUNsRCxNQUFNLE9BQU8sdUJBQXVCLEdBQUc7SUFDckMsSUFBSSxFQUFFLFNBQVM7SUFDZixLQUFLLEVBQUUsY0FBYztJQUNyQixLQUFLLEVBQUUsU0FBUztJQUNoQixLQUFLLEVBQUUsQ0FBQztDQUNUOzs7OztBQUVELE1BQU0sVUFBVSx1QkFBdUIsQ0FBQyxNQUEyQjtJQUNqRSxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxLQUFLLE1BQU0sQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxNQUFNO1dBQzVFLE1BQU0sQ0FBQyxJQUFJLEtBQUssdUJBQXVCLENBQUMsSUFBSTtXQUM1QyxNQUFNLENBQUMsS0FBSyxLQUFLLHVCQUF1QixDQUFDLEtBQUs7V0FDOUMsTUFBTSxDQUFDLEtBQUssS0FBSyx1QkFBdUIsQ0FBQyxLQUFLO1dBQzlDLE1BQU0sQ0FBQyxLQUFLLEtBQUssdUJBQXVCLENBQUMsS0FBSyxDQUFDO0FBQ3RELENBQUM7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SUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFDLENBQUM7UUFDNUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPOzs7O1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUMsQ0FBQztJQUM3RSxDQUFDO0NBQ0Y7OztJQTlIQyx3Q0FBd0I7O0lBQ3hCLDBDQUFnQjs7SUFDaEIsMENBQWdCOztJQUNoQiwwQ0FBZ0I7O0lBQ2hCLGtEQUF3Qjs7SUFDeEIsbURBQXlCOztJQUN6Qix3REFBeUQ7O0lBQ3pELDRDQUFrQjs7SUFDbEIsbURBQW1DOztJQUNuQyxvREFBcUM7O0lBQ3JDLHlDQUFlOztJQUNmLGdEQUFzQjs7SUFDdEIsK0NBQXFCOztJQUNyQixpREFBb0M7O0lBQ3BDLDBDQUE2Qjs7Ozs7O0FBa0gvQixTQUFTLHVCQUF1QixDQUFDLE1BQTJCO0lBQzFELElBQUksQ0FBQyxNQUFNLEVBQUU7UUFDWCxPQUFPO0tBQ1I7SUFFRCxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDekIsTUFBTSxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUMsbUJBQUEsTUFBTSxDQUFDLEtBQUssRUFBNEIsQ0FBQyxDQUFDO0tBQ25FO0lBRUQsSUFBSSxNQUFNLENBQUMsT0FBTyxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1FBQ25ELE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQyxtQkFBQSxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBNEIsQ0FBQyxDQUFDO0tBQ25GO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExheWVyUmVuZGVyZXJDbGFzc2lmaWNhdGlvbk1ldGhvZCwgTGF5ZXJSZW5kZXJlclR5cGUgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IENsYXNzQnJlYWtJbmZvLCBpc0NsYXNzQnJlYWtJbmZvRW1wdHkgfSBmcm9tICcuL2NsYXNzLWJyZWFrLWluZm8nO1xuaW1wb3J0IHsgVW5pcXVlVmFsdWVJbmZvLCBpc1VuaXF1ZVZhbHVlSW5mb0VtcHR5IH0gZnJvbSAnLi91bmlxdWUtdmFsdWUtaW5mbyc7XG5pbXBvcnQgeyBMYXllclJlbmRlcmVyU3ltYm9sIH0gZnJvbSAnLi9sYXllci1yZW5kZXJlci1zeW1ib2wnO1xuaW1wb3J0IHsgaXNBcnJheSB9IGZyb20gJy4uLy4uL2NvcmUvdHlwZS1jaGVjay9pcy1hcnJheS5mdW5jdGlvbic7XG5pbXBvcnQgeyByZ2JUb0hleCB9IGZyb20gJy4uLy4uL2NvcmUvY29sb3IvcmdiLXRvLWhleC5mdW5jdGlvbic7XG5pbXBvcnQgeyByZW1vdmVXaGVyZSB9IGZyb20gJy4uLy4uL2NvcmUvYXJyYXkvcmVtb3ZlLXdoZXJlLmZ1bmN0aW9uJztcblxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9VTklRVUVfVkFMVUVfSU5GTyA9IG51bGw7XG5leHBvcnQgY29uc3QgREVGQVVMVF9DTEFTU19CUkVBS19WQUxVRV9JTkZPID0gbnVsbDtcbmV4cG9ydCBjb25zdCBERUZBVUxUX1JFTkRFUkVSX1NZTUJPTCA9IHtcbiAgdHlwZTogJ2VzcmlTTFMnLFxuICBzdHlsZTogJ2VzcmlTTFNTb2xpZCcsXG4gIGNvbG9yOiAnIzAwMDAwMCcsXG4gIHdpZHRoOiAyXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gaXNSZW5kZXJlclN5bWJvbERlZmF1bHQoc3ltYm9sOiBMYXllclJlbmRlcmVyU3ltYm9sKTogYm9vbGVhbiB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhzeW1ib2wpLmxlbmd0aCA9PT0gT2JqZWN0LmtleXMoREVGQVVMVF9SRU5ERVJFUl9TWU1CT0wpLmxlbmd0aFxuICAgICYmIHN5bWJvbC50eXBlID09PSBERUZBVUxUX1JFTkRFUkVSX1NZTUJPTC50eXBlXG4gICAgJiYgc3ltYm9sLnN0eWxlID09PSBERUZBVUxUX1JFTkRFUkVSX1NZTUJPTC5zdHlsZVxuICAgICYmIHN5bWJvbC5jb2xvciA9PT0gREVGQVVMVF9SRU5ERVJFUl9TWU1CT0wuY29sb3JcbiAgICAmJiBzeW1ib2wud2lkdGggPT09IERFRkFVTFRfUkVOREVSRVJfU1lNQk9MLndpZHRoO1xufVxuXG5leHBvcnQgY2xhc3MgTGF5ZXJEcmF3aW5nSW5mb1JlbmRlcmVyIHtcbiAgdHlwZTogTGF5ZXJSZW5kZXJlclR5cGU7XG4gIGZpZWxkMT86IHN0cmluZztcbiAgZmllbGQyPzogc3RyaW5nO1xuICBmaWVsZDM/OiBzdHJpbmc7XG4gIGZpZWxkRGVsaW1pdGVyPzogc3RyaW5nO1xuICB2YWx1ZUV4cHJlc3Npb24/OiBzdHJpbmc7XG4gIGNsYXNzaWZpY2F0aW9uTWV0aG9kPzogTGF5ZXJSZW5kZXJlckNsYXNzaWZpY2F0aW9uTWV0aG9kO1xuICBtaW5WYWx1ZT86IG51bWJlcjtcbiAgY2xhc3NCcmVha0luZm9zPzogQ2xhc3NCcmVha0luZm9bXTtcbiAgdW5pcXVlVmFsdWVJbmZvcz86IFVuaXF1ZVZhbHVlSW5mb1tdO1xuICBsYWJlbD86IHN0cmluZztcbiAgZGVmYXVsdExhYmVsPzogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgZGVmYXVsdFN5bWJvbD86IExheWVyUmVuZGVyZXJTeW1ib2w7XG4gIHN5bWJvbD86IExheWVyUmVuZGVyZXJTeW1ib2w7XG5cbiAgZ2V0IGlzU2ltcGxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICdzaW1wbGUnO1xuICB9XG5cbiAgZ2V0IGlzVW5pcXVlVmFsdWUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gJ3VuaXF1ZVZhbHVlJztcbiAgfVxuXG4gIGdldCBpc0NsYXNzQnJlYWsoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gJ2NsYXNzQnJlYWtzJztcbiAgfVxuXG4gIGdldCBpc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5taW5WYWx1ZVxuICAgICAgJiYgIXRoaXMuY2xhc3NCcmVha0luZm9zLmxlbmd0aFxuICAgICAgJiYgIXRoaXMudW5pcXVlVmFsdWVJbmZvcy5sZW5ndGhcbiAgICAgICYmIGlzUmVuZGVyZXJTeW1ib2xEZWZhdWx0KHRoaXMuc3ltYm9sKTtcbiAgfVxuXG4gIGdldCBmaWVsZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmZpZWxkMTtcbiAgfVxuXG4gIHNldCBmaWVsZCh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5maWVsZDEgPSB2YWx1ZTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGJhc2U/OiBMYXllckRyYXdpbmdJbmZvUmVuZGVyZXIpIHtcbiAgICBPYmplY3QuYXNzaWduKHRoaXMsIGJhc2UpO1xuICAgIHRoaXMudHlwZSA9IHRoaXMudHlwZSB8fCAnc2ltcGxlJztcbiAgICB0aGlzLm1pblZhbHVlID0gdGhpcy5taW5WYWx1ZSB8fCAwO1xuICAgIHRoaXMuY2xhc3NCcmVha0luZm9zID0gdGhpcy5jbGFzc0JyZWFrSW5mb3MgfHwgW107XG4gICAgdGhpcy51bmlxdWVWYWx1ZUluZm9zID0gdGhpcy51bmlxdWVWYWx1ZUluZm9zIHx8IFtdO1xuICAgIHRoaXMuc3ltYm9sID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9SRU5ERVJFUl9TWU1CT0wsIHRoaXMuc3ltYm9sKTtcbiAgICB0aGlzLmxhYmVsID0gdGhpcy5sYWJlbCB8fCAnJztcbiAgICB0aGlzLmRlc2NyaXB0aW9uID0gdGhpcy5kZXNjcmlwdGlvbiB8fCAnJztcblxuICAgIHRoaXMuc3RhbmRhcmRpemVSZW5kZXJTeW1ib2xzKCk7XG4gIH1cblxuICBnZXRTeW1ib2wodmFsdWU6IHN0cmluZyB8IG51bWJlcik6IExheWVyUmVuZGVyZXJTeW1ib2wgfCBudWxsIHtcbiAgICBsZXQgc3ltYm9sID0gdGhpcy5zeW1ib2wgfHwgdGhpcy5kZWZhdWx0U3ltYm9sO1xuXG4gICAgaWYgKHRoaXMuaXNVbmlxdWVWYWx1ZSkge1xuICAgICAgY29uc3QgdW5pcXVlVmFsdWVJbmZvID0gdGhpcy5nZXRVbmlxdWVWYWx1ZUluZm9PckRlZmF1bHQodmFsdWUpO1xuICAgICAgc3ltYm9sID0gaXNVbmlxdWVWYWx1ZUluZm9FbXB0eSh1bmlxdWVWYWx1ZUluZm8pID8gbnVsbCA6IHVuaXF1ZVZhbHVlSW5mby5zeW1ib2w7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzQ2xhc3NCcmVhaykge1xuICAgICAgY29uc3QgY2xhc3NCcmVha0luZm8gPSB0aGlzLmdldENsYXNzQnJlYWtJbmZvT3JEZWZhdWx0KHZhbHVlKTtcbiAgICAgIHN5bWJvbCA9IGlzQ2xhc3NCcmVha0luZm9FbXB0eShjbGFzc0JyZWFrSW5mbykgPyBudWxsIDogY2xhc3NCcmVha0luZm8uc3ltYm9sO1xuICAgIH1cblxuICAgIHJldHVybiBzeW1ib2wgfHwgdGhpcy5kZWZhdWx0U3ltYm9sIHx8IG51bGw7XG4gIH1cblxuICBnZXRVbmlxdWVWYWx1ZUluZm8odmFsdWU6IHN0cmluZyB8IG51bWJlcik6IFVuaXF1ZVZhbHVlSW5mbyB7XG4gICAgaWYgKCF0aGlzLnVuaXF1ZVZhbHVlSW5mb3MgfHwgIXRoaXMudW5pcXVlVmFsdWVJbmZvcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnVuaXF1ZVZhbHVlSW5mb3MuZmluZChpbmZvID0+XG4gICAgICBpbmZvLnZhbHVlID09PSB2YWx1ZSB8fCBTdHJpbmcoaW5mby52YWx1ZSkgPT09IFN0cmluZyh2YWx1ZSlcbiAgICApO1xuICB9XG5cbiAgZ2V0VW5pcXVlVmFsdWVJbmZvT3JEZWZhdWx0KHZhbHVlOiBzdHJpbmcgfCBudW1iZXIpOiBVbmlxdWVWYWx1ZUluZm8ge1xuICAgIHJldHVybiB0aGlzLmdldFVuaXF1ZVZhbHVlSW5mbyh2YWx1ZSkgfHwgREVGQVVMVF9VTklRVUVfVkFMVUVfSU5GTztcbiAgfVxuXG4gIGdldENsYXNzQnJlYWtJbmZvKGNsYXNzVmFsdWU6IHN0cmluZyB8IG51bWJlcik6IENsYXNzQnJlYWtJbmZvIHtcbiAgICBpZiAoIXRoaXMuY2xhc3NCcmVha0luZm9zIHx8ICF0aGlzLmNsYXNzQnJlYWtJbmZvcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNsYXNzQnJlYWtJbmZvcy5maW5kKCh2YWx1ZSwgaW5kZXgpID0+IHRoaXMuaXNWYWx1ZUluQ2xhc3NCcmVha1JhbmdlKHZhbHVlLCBjbGFzc1ZhbHVlLCBpbmRleCkpO1xuICB9XG5cbiAgZ2V0Q2xhc3NCcmVha0luZm9PckRlZmF1bHQodmFsdWU6IHN0cmluZyB8IG51bWJlcik6IENsYXNzQnJlYWtJbmZvIHtcbiAgICByZXR1cm4gdGhpcy5nZXRDbGFzc0JyZWFrSW5mbyh2YWx1ZSkgfHwgREVGQVVMVF9DTEFTU19CUkVBS19WQUxVRV9JTkZPO1xuICB9XG5cbiAgaXNWYWx1ZUluQ2xhc3NCcmVha1JhbmdlKGNsYXNzQnJlYWtJbmZvOiBDbGFzc0JyZWFrSW5mbywgdmFsdWU6IHN0cmluZyB8IG51bWJlciwgaW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHJhbmdlTWluID0gaW5kZXggPT09IDAgPyB0aGlzLm1pblZhbHVlIDogdGhpcy5jbGFzc0JyZWFrSW5mb3NbaW5kZXggLSAxXS5jbGFzc01heFZhbHVlO1xuICAgIGNvbnN0IHJhbmdlTWF4ID0gY2xhc3NCcmVha0luZm8uY2xhc3NNYXhWYWx1ZTtcbiAgICByZXR1cm4gcmFuZ2VNaW4gPCB2YWx1ZSAmJiByYW5nZU1heCA+IHZhbHVlO1xuICB9XG5cbiAgY2xlYXJFbXB0eUluZm9zKCk6IHZvaWQge1xuICAgIHJlbW92ZVdoZXJlKHRoaXMudW5pcXVlVmFsdWVJbmZvcywgaW5mbyA9PiBpc1VuaXF1ZVZhbHVlSW5mb0VtcHR5KGluZm8pKTtcbiAgICByZW1vdmVXaGVyZSh0aGlzLmNsYXNzQnJlYWtJbmZvcywgaW5mbyA9PiBpc0NsYXNzQnJlYWtJbmZvRW1wdHkoaW5mbykpO1xuICB9XG5cbiAgZ2V0QmVzdFJlcHJlc2VudGF0aXZlQ29sb3IodmFsdWU/OiBzdHJpbmcgfCBudW1iZXIpOiBzdHJpbmcge1xuICAgIGxldCBzeW1ib2wgPSB0aGlzLmRlZmF1bHRTeW1ib2wgfHwgdGhpcy5zeW1ib2w7XG4gICAgaWYgKHRoaXMuaXNVbmlxdWVWYWx1ZSAmJiB0aGlzLnVuaXF1ZVZhbHVlSW5mb3MubGVuZ3RoKSB7XG4gICAgICBjb25zdCBmb3VuZEluZm8gPSB0aGlzLmdldFVuaXF1ZVZhbHVlSW5mbyh2YWx1ZSk7XG4gICAgICBzeW1ib2wgPSBmb3VuZEluZm8gPyBmb3VuZEluZm8uc3ltYm9sIDogdGhpcy51bmlxdWVWYWx1ZUluZm9zWzBdLnN5bWJvbDtcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNDbGFzc0JyZWFrICYmIHRoaXMuY2xhc3NCcmVha0luZm9zLmxlbmd0aCkge1xuICAgICAgY29uc3QgZm91bmRJbmZvID0gdGhpcy5nZXRDbGFzc0JyZWFrSW5mbyh2YWx1ZSk7XG4gICAgICBzeW1ib2wgPSBmb3VuZEluZm8gPyBmb3VuZEluZm8uc3ltYm9sIDogdGhpcy5jbGFzc0JyZWFrSW5mb3NbMF0uc3ltYm9sO1xuICAgIH1cblxuICAgIHJldHVybiBzeW1ib2wuY29sb3IgYXMgc3RyaW5nO1xuICB9XG5cbiAgc3RhbmRhcmRpemVSZW5kZXJTeW1ib2xzKCk6IHZvaWQge1xuICAgIHN0YW5kYXJkaXplUmVuZGVyU3ltYm9sKHRoaXMuZGVmYXVsdFN5bWJvbCk7XG4gICAgc3RhbmRhcmRpemVSZW5kZXJTeW1ib2wodGhpcy5zeW1ib2wpO1xuICAgIHRoaXMudW5pcXVlVmFsdWVJbmZvcy5mb3JFYWNoKGluZm8gPT4gc3RhbmRhcmRpemVSZW5kZXJTeW1ib2woaW5mby5zeW1ib2wpKTtcbiAgICB0aGlzLmNsYXNzQnJlYWtJbmZvcy5mb3JFYWNoKGluZm8gPT4gc3RhbmRhcmRpemVSZW5kZXJTeW1ib2woaW5mby5zeW1ib2wpKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzdGFuZGFyZGl6ZVJlbmRlclN5bWJvbChzeW1ib2w6IExheWVyUmVuZGVyZXJTeW1ib2wpOiB2b2lkIHtcbiAgaWYgKCFzeW1ib2wpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoaXNBcnJheShzeW1ib2wuY29sb3IpKSB7XG4gICAgc3ltYm9sLmNvbG9yID0gcmdiVG9IZXgoc3ltYm9sLmNvbG9yIGFzIFtudW1iZXIsIG51bWJlciwgbnVtYmVyXSk7XG4gIH1cblxuICBpZiAoc3ltYm9sLm91dGxpbmUgJiYgaXNBcnJheShzeW1ib2wub3V0bGluZS5jb2xvcikpIHtcbiAgICBzeW1ib2wub3V0bGluZS5jb2xvciA9IHJnYlRvSGV4KHN5bWJvbC5vdXRsaW5lLmNvbG9yIGFzIFtudW1iZXIsIG51bWJlciwgbnVtYmVyXSk7XG4gIH1cbn1cbiJdfQ==