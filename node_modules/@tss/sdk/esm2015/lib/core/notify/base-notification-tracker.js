/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { isFunction } from '../type-check/is-function.function';
import { errorMsg } from '../error/error-msg.function';
/**
 * @abstract
 * @template T
 */
export class BaseNotificationTracker {
    /**
     * @param {?} notify
     * @param {?=} log
     * @param {?=} config
     */
    constructor(notify, log, config = { logErrors: true }) {
        this.notify = notify;
        this.log = log;
        this.config = config;
        this.eventWatchers = [];
    }
    /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    wait(message, title, config) {
        this.waitResponse = this.notify.wait(message, title, config);
        // This method needs implemented in each implementation.
        this.emit('wait');
        return this;
    }
    /**
     * @param {?} predicate
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    waitIf(predicate, message, title, config) {
        /** @type {?} */
        const doWait = isFunction(predicate)
            ? ((/** @type {?} */ (predicate)))()
            : Boolean(predicate);
        return doWait ? this.wait(message, title, config) : this;
    }
    /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    success(message, title, config) {
        this.config.showSuccess = true;
        this.config.successMsg = message;
        this.config.successTitle = title;
        this.config.successConfiguration = config;
        this.emit('success');
        return this;
    }
    /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    error(message, title, config) {
        this.config.showError = true;
        this.config.errorMsg = message;
        this.config.errorTitle = title;
        this.config.errorConfiguration = config;
        this.emit('error');
        return this;
    }
    /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    warn(message, title, config) {
        this.config.showWarn = true;
        this.config.warnMsg = message;
        this.config.warnTitle = title;
        this.config.warnConfiguration = config;
        this.emit('warn');
        return this;
    }
    /**
     * @param {?} message
     * @param {?=} title
     * @param {?=} config
     * @return {?}
     */
    info(message, title, config) {
        this.config.showInfo = true;
        this.config.infoMsg = message;
        this.config.infoTitle = title;
        this.config.infoConfiguration = config;
        this.emit('info');
        return this;
    }
    /**
     * @param {?} onDone
     * @return {?}
     */
    finally(onDone) {
        this.onDone = onDone;
        this.emit('finally');
        return this;
    }
    /**
     * @param {?} eventType
     * @param {?} callback
     * @return {?}
     */
    on(eventType, callback) {
        this.eventWatchers.push({ eventType, callback });
    }
    /**
     * @protected
     * @param {?} eventType
     * @param {?=} event
     * @return {?}
     */
    emit(eventType, event) {
        this.eventWatchers
            .filter((/**
         * @param {?} watcher
         * @return {?}
         */
        watcher => watcher.eventType === eventType))
            .forEach((/**
         * @param {?} watcher
         * @return {?}
         */
        watcher => watcher.callback(event)));
    }
    /**
     * @protected
     * @param {?=} response
     * @return {?}
     */
    done(response) {
        if (this.waitResponse) {
            this.notify.clear(this.waitResponse.notifyId, this.waitResponse.containerId);
        }
        if (this.onDone) {
            this.onDone(response);
        }
    }
    /**
     * @protected
     * @param {?} response
     * @return {?}
     */
    onSuccess(response) {
        if (this.config.showSuccess) {
            this.notify.success(this.config.successMsg, this.config.successTitle, this.config.successConfiguration);
        }
        if (this.config.showInfo) {
            this.notify.info(this.config.infoMsg, this.config.infoTitle, this.config.infoConfiguration);
        }
        this.done(response);
    }
    /**
     * @protected
     * @param {?} error
     * @return {?}
     */
    onFail(error) {
        /** @type {?} */
        const responseError = (error.error || error) || error;
        /** @type {?} */
        const msg = errorMsg(this.config.errorMsg, responseError);
        if (this.log && this.config.logErrors) {
            this.log.error(msg);
        }
        if (this.config.showError) {
            this.notify.error(msg, this.config.errorTitle, responseError, this.config.errorConfiguration);
        }
        if (this.config.showWarn) {
            this.notify.warn(msg, this.config.infoTitle, this.config.warnConfiguration);
        }
        this.done();
    }
}
if (false) {
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.onDone;
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.waitResponse;
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.eventWatchers;
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.notify;
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.log;
    /**
     * @type {?}
     * @protected
     */
    BaseNotificationTracker.prototype.config;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1ub3RpZmljYXRpb24tdHJhY2tlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0c3Mvc2RrLyIsInNvdXJjZXMiOlsibGliL2NvcmUvbm90aWZ5L2Jhc2Utbm90aWZpY2F0aW9uLXRyYWNrZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQU1BLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7Ozs7O0FBR3ZELE1BQU0sT0FBZ0IsdUJBQXVCOzs7Ozs7SUFRM0MsWUFBc0IsTUFBcUIsRUFBWSxHQUFZLEVBQVksU0FBNkIsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFO1FBQXpHLFdBQU0sR0FBTixNQUFNLENBQWU7UUFBWSxRQUFHLEdBQUgsR0FBRyxDQUFTO1FBQVksV0FBTSxHQUFOLE1BQU0sQ0FBMEM7UUFMckgsa0JBQWEsR0FHakIsRUFBRSxDQUFDO0lBR1QsQ0FBQzs7Ozs7OztJQUVELElBQUksQ0FBQyxPQUFlLEVBQUUsS0FBYyxFQUFFLE1BQVk7UUFDaEQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRTdELHdEQUF3RDtRQUN4RCxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7Ozs7Ozs7SUFFRCxNQUFNLENBQUMsU0FBb0MsRUFBRSxPQUFlLEVBQUUsS0FBYyxFQUFFLE1BQVk7O2NBQ2xGLE1BQU0sR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDO1lBQ2xDLENBQUMsQ0FBQyxDQUFDLG1CQUFBLFNBQVMsRUFBaUIsQ0FBQyxFQUFFO1lBQ2hDLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO1FBRXRCLE9BQU8sTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJ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LEdBQUcsQ0FBQyxDQUFDO1NBQ3JCO1FBRUQsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRTtZQUN6QixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsYUFBYSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQztTQUMvRjtRQUVELElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUU7WUFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztTQUM3RTtRQUVELElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNkLENBQUM7Q0FDRjs7Ozs7O0lBdEhDLHlDQUF5RTs7Ozs7SUFDekUsK0NBQXVDOzs7OztJQUN2QyxnREFHUzs7Ozs7SUFFRyx5Q0FBK0I7Ozs7O0lBQUUsc0NBQXNCOzs7OztJQUFFLHlDQUEwRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5vdGlmaWNhdGlvblRyYWNrZXIgfSBmcm9tICcuL25vdGlmaWNhdGlvbi10cmFja2VyJztcbmltcG9ydCB7IE5vdGlmeVJlc3BvbnNlIH0gZnJvbSAnLi9ub3RpZnktcmVzcG9uc2UnO1xuaW1wb3J0IHsgTm90aWZ5RXZlbnRUeXBlIH0gZnJvbSAnLi9ub3RpZnktZXZlbnQtdHlwZSc7XG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnLi9ub3RpZnkuc2VydmljZSc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi9sb2dnaW5nL2xvZ2dlci5zZXJ2aWNlJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbkNvbmZpZyB9IGZyb20gJy4vbm90aWZpY2F0aW9uLWNvbmZpZyc7XG5pbXBvcnQgeyBpc0Z1bmN0aW9uIH0gZnJvbSAnLi4vdHlwZS1jaGVjay9pcy1mdW5jdGlvbi5mdW5jdGlvbic7XG5pbXBvcnQgeyBlcnJvck1zZyB9IGZyb20gJy4uL2Vycm9yL2Vycm9yLW1zZy5mdW5jdGlvbic7XG5cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhc2VOb3RpZmljYXRpb25UcmFja2VyPFQ+IGltcGxlbWVudHMgTm90aWZpY2F0aW9uVHJhY2tlcjxUPiB7XG4gIHByb3RlY3RlZCBvbkRvbmU6ICh2YWx1ZTogVCB8IHVuZGVmaW5lZCB8IG51bGwgfCBQcm9taXNlTGlrZTxUPikgPT4gdm9pZDtcbiAgcHJvdGVjdGVkIHdhaXRSZXNwb25zZTogTm90aWZ5UmVzcG9uc2U7XG4gIHByb3RlY3RlZCBldmVudFdhdGNoZXJzOiB7XG4gICAgZXZlbnRUeXBlOiBOb3RpZnlFdmVudFR5cGUsXG4gICAgY2FsbGJhY2s6ICgoZT86IGFueSkgPT4gdm9pZClcbiAgfVtdID0gW107XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIG5vdGlmeTogTm90aWZ5U2VydmljZSwgcHJvdGVjdGVkIGxvZz86IExvZ2dlciwgcHJvdGVjdGVkIGNvbmZpZzogTm90aWZpY2F0aW9uQ29uZmlnID0geyBsb2dFcnJvcnM6IHRydWUgfSkge1xuICB9XG5cbiAgd2FpdChtZXNzYWdlOiBzdHJpbmcsIHRpdGxlPzogc3RyaW5nLCBjb25maWc/OiBhbnkpOiBOb3RpZmljYXRpb25UcmFja2VyPFQ+IHtcbiAgICB0aGlzLndhaXRSZXNwb25zZSA9IHRoaXMubm90aWZ5LndhaXQobWVzc2FnZSwgdGl0bGUsIGNvbmZpZyk7XG5cbiAgICAvLyBUaGlzIG1ldGhvZCBuZWVkcyBpbXBsZW1lbnRlZCBpbiBlYWNoIGltcGxlbWVudGF0aW9uLlxuICAgIHRoaXMuZW1pdCgnd2FpdCcpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgd2FpdElmKHByZWRpY2F0ZTogYm9vbGVhbiB8ICgoKSA9PiBib29sZWFuKSwgbWVzc2FnZTogc3RyaW5nLCB0aXRsZT86IHN0cmluZywgY29uZmlnPzogYW55KTogTm90aWZpY2F0aW9uVHJhY2tlcjxUPiB7XG4gICAgY29uc3QgZG9XYWl0ID0gaXNGdW5jdGlvbihwcmVkaWNhdGUpXG4gICAgICA/IChwcmVkaWNhdGUgYXMgKCkgPT4gYm9vbGVhbikoKVxuICAgICAgOiBCb29sZWFuKHByZWRpY2F0ZSk7XG5cbiAgICByZXR1cm4gZG9XYWl0ID8gdGhpcy53YWl0KG1lc3NhZ2UsIHRpdGxlLCBjb25maWcpIDogdGhpcztcbiAgfVxuXG4gIHN1Y2Nlc3MobWVzc2FnZTogc3RyaW5nLCB0aXRsZT86IHN0cmluZywgY29uZmlnPzogYW55KTogTm90aWZpY2F0aW9uVHJhY2tlcjxUPiB7XG4gICAgdGhpcy5jb25maWcuc2hvd1N1Y2Nlc3MgPSB0cnVlO1xuICAgIHRoaXMuY29uZmlnLnN1Y2Nlc3NNc2cgPSBtZXNzYWdlO1xuICAgIHRoaXMuY29uZmlnLnN1Y2Nlc3NUaXRsZSA9IHRpdGxlO1xuICAgIHRoaXMuY29uZmlnLnN1Y2Nlc3NDb25maWd1cmF0aW9uID0gY29uZmlnO1xuICAgIHRoaXMuZW1pdCgnc3VjY2VzcycpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZXJyb3IobWVzc2FnZTogc3RyaW5nLCB0aXRsZT86IHN0cmluZywgY29uZmlnPzogYW55KTogTm90aWZpY2F0aW9uVHJhY2tlcjxUPiB7XG4gICAgdGhpcy5jb25maWcuc2hvd0Vycm9yID0gdHJ1ZTtcbiAgICB0aGlzLmNvbmZpZy5lcnJvck1zZyA9IG1lc3NhZ2U7XG4gICAgdGhpcy5jb25maWcuZXJyb3JUaXRsZSA9IHRpdGxlO1xuICAgIHRoaXMuY29uZmlnLmVycm9yQ29uZmlndXJhdGlvbiA9IGNvbmZpZztcbiAgICB0aGlzLmVtaXQoJ2Vycm9yJyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB3YXJuKG1lc3NhZ2U6IHN0cmluZywgdGl0bGU/OiBzdHJpbmcsIGNvbmZpZz86IGFueSk6IE5vdGlmaWNhdGlvblRyYWNrZXI8VD4ge1xuICAgIHRoaXMuY29uZmlnLnNob3dXYXJuID0gdHJ1ZTtcbiAgICB0aGlzLmNvbmZpZy53YXJuTXNnID0gbWVzc2FnZTtcbiAgICB0aGlzLmNvbmZpZy53YXJuVGl0bGUgPSB0aXRsZTtcbiAgICB0aGlzLmNvbmZpZy53YXJuQ29uZmlndXJhdGlvbiA9IGNvbmZpZztcbiAgICB0aGlzLmVtaXQoJ3dhcm4nKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGluZm8obWVzc2FnZTogc3RyaW5nLCB0aXRsZT86IHN0cmluZywgY29uZmlnPzogYW55KTogTm90aWZpY2F0aW9uVHJhY2tlcjxUPiB7XG4gICAgdGhpcy5jb25maWcuc2hvd0luZm8gPSB0cnVlO1xuICAgIHRoaXMuY29uZmlnLmluZm9Nc2cgPSBtZXNzYWdlO1xuICAgIHRoaXMuY29uZmlnLmluZm9UaXRsZSA9IHRpdGxlO1xuICAgIHRoaXMuY29uZmlnLmluZm9Db25maWd1cmF0aW9uID0gY29uZmlnO1xuICAgIHRoaXMuZW1pdCgnaW5mbycpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZmluYWxseShvbkRvbmU6ICh2YWx1ZTogVCB8IHVuZGVmaW5lZCB8IG51bGwgfCBQcm9taXNlTGlrZTxUPikgPT4gdm9pZCk6IE5vdGlmaWNhdGlvblRyYWNrZXI8VD4ge1xuICAgIHRoaXMub25Eb25lID0gb25Eb25lO1xuICAgIHRoaXMuZW1pdCgnZmluYWxseScpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgb24oZXZlbnRUeXBlOiBOb3RpZnlFdmVudFR5cGUsIGNhbGxiYWNrOiAoZT86IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuZXZlbnRXYXRjaGVycy5wdXNoKHsgZXZlbnRUeXBlLCBjYWxsYmFjayB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBlbWl0KGV2ZW50VHlwZTogTm90aWZ5RXZlbnRUeXBlLCBldmVudD86IGFueSkge1xuICAgIHRoaXMuZXZlbnRXYXRjaGVyc1xuICAgICAgLmZpbHRlcih3YXRjaGVyID0+IHdhdGNoZXIuZXZlbnRUeXBlID09PSBldmVudFR5cGUpXG4gICAgICAuZm9yRWFjaCh3YXRjaGVyID0+IHdhdGNoZXIuY2FsbGJhY2soZXZlbnQpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBkb25lKHJlc3BvbnNlPzogYW55KSB7XG4gICAgaWYgKHRoaXMud2FpdFJlc3BvbnNlKSB7XG4gICAgICB0aGlzLm5vdGlmeS5jbGVhcih0aGlzLndhaXRSZXNwb25zZS5ub3RpZnlJZCwgdGhpcy53YWl0UmVzcG9uc2UuY29udGFpbmVySWQpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9uRG9uZSkge1xuICAgICAgdGhpcy5vbkRvbmUocmVzcG9uc2UpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBvblN1Y2Nlc3MocmVzcG9uc2U6IGFueSk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbmZpZy5zaG93U3VjY2Vzcykge1xuICAgICAgdGhpcy5ub3RpZnkuc3VjY2Vzcyh0aGlzLmNvbmZpZy5zdWNjZXNzTXNnLCB0aGlzLmNvbmZpZy5zdWNjZXNzVGl0bGUsIHRoaXMuY29uZmlnLnN1Y2Nlc3NDb25maWd1cmF0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb25maWcuc2hvd0luZm8pIHtcbiAgICAgIHRoaXMubm90aWZ5LmluZm8odGhpcy5jb25maWcuaW5mb01zZywgdGhpcy5jb25maWcuaW5mb1RpdGxlLCB0aGlzLmNvbmZpZy5pbmZvQ29uZmlndXJhdGlvbik7XG4gICAgfVxuXG4gICAgdGhpcy5kb25lKHJlc3BvbnNlKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBvbkZhaWwoZXJyb3I6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IHJlc3BvbnNlRXJyb3IgPSAoZXJyb3IuZXJyb3IgfHwgZXJyb3IpIHx8IGVycm9yO1xuICAgIGNvbnN0IG1zZzogc3RyaW5nID0gZXJyb3JNc2codGhpcy5jb25maWcuZXJyb3JNc2csIHJlc3BvbnNlRXJyb3IpO1xuXG4gICAgaWYgKHRoaXMubG9nICYmIHRoaXMuY29uZmlnLmxvZ0Vycm9ycykge1xuICAgICAgdGhpcy5sb2cuZXJyb3IobXNnKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb25maWcuc2hvd0Vycm9yKSB7XG4gICAgICB0aGlzLm5vdGlmeS5lcnJvcihtc2csIHRoaXMuY29uZmlnLmVycm9yVGl0bGUsIHJlc3BvbnNlRXJyb3IsIHRoaXMuY29uZmlnLmVycm9yQ29uZmlndXJhdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY29uZmlnLnNob3dXYXJuKSB7XG4gICAgICB0aGlzLm5vdGlmeS53YXJuKG1zZywgdGhpcy5jb25maWcuaW5mb1RpdGxlLCB0aGlzLmNvbmZpZy53YXJuQ29uZmlndXJhdGlvbik7XG4gICAgfVxuXG4gICAgdGhpcy5kb25lKCk7XG4gIH1cbn1cbiJdfQ==