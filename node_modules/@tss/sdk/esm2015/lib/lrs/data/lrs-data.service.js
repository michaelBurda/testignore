/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// Angular.
import { Injectable } from '@angular/core';
import { HttpParams } from '@angular/common/http';
import { toFieldName, getGeometryFieldName } from '../../maps/fields/layer-field';
import { EsriMapServerService } from '../../esri/esri-map-server.service';
import { DataSourceService } from '../../data-source/data-source.service';
import { WhereClauseBuilder } from '../../maps/where-clause-builder';
import { DataSourceConfig } from '../../data-source/data-source-config';
import * as i0 from "@angular/core";
import * as i1 from "../../esri/esri-map-server.service";
import * as i2 from "../../data-source/data-source.service";
import * as i3 from "../../data-source/data-source-config";
export class LrsDataService {
    /**
     * @param {?} mapService
     * @param {?} dataSourceService
     * @param {?} dataSourceConfig
     */
    constructor(mapService, dataSourceService, dataSourceConfig) {
        this.mapService = mapService;
        this.dataSourceService = dataSourceService;
        this.dataSourceConfig = dataSourceConfig;
    }
    /**
     * @template T
     * @param {?} dataSource
     * @param {?} layer
     * @param {?} field
     * @param {?=} whereClause
     * @return {?}
     */
    getUniqueValues(dataSource, layer, field, whereClause) {
        /** @type {?} */
        const mapServiceParams = { gdbVersion: layer.versionName };
        /** @type {?} */
        let httpParams;
        if (whereClause) {
            mapServiceParams.where = whereClause;
            httpParams = new HttpParams().set('where', whereClause);
        }
        return dataSource.serviceUrl
            ? this.mapService.getUniqueValues(dataSource.serviceUrl, layer, field, mapServiceParams)
            : this.dataSourceService.getUniqueColumnValues(dataSource.id, layer.featureClassName, toFieldName(field), httpParams);
    }
    /**
     * @param {?} dataSource
     * @param {?} layer
     * @param {?} whereClause
     * @return {?}
     */
    getQueryCount(dataSource, layer, whereClause) {
        return dataSource.serviceUrl
            ? this.mapService.getQueryCount(dataSource.serviceUrl, layer, whereClause, { gdbVersion: layer.versionName })
            : this.dataSourceService.getRecordCount(dataSource.id, layer.featureClassName, whereClause, layer.versionName);
    }
    /**
     * @param {?} dataSource
     * @param {?} layer
     * @param {?} routeIds
     * @return {?}
     */
    queryRoutesByIds(dataSource, layer, routeIds) {
        if (!routeIds || !routeIds.length) {
            throw new Error('Failed to query routes. No route IDs supplied.');
        }
        if (!layer.compositeRouteIdFieldName) {
            throw new Error(`Failed to query routes. No 'compositeRouteIdFieldName' property found for layer.`);
        }
        /** @type {?} */
        const whereClause = `${layer.compositeRouteIdFieldName} IN ('${routeIds.join(`','`)}')`;
        return this.queryRoutes(dataSource, layer, whereClause);
    }
    /**
     * @param {?} dataSource
     * @param {?} layer
     * @param {?=} whereClause
     * @return {?}
     */
    queryRoutes(dataSource, layer, whereClause) {
        /** @type {?} */
        const shapeFieldName = getGeometryFieldName(layer.fields);
        return dataSource.serviceUrl
            ? this.mapService.queryRoutes(dataSource.serviceUrl, layer, whereClause, { gdbVersion: layer.versionName })
            : this.dataSourceService.querySpatialData(dataSource.id, layer.featureClassName, whereClause, layer.versionName, null, null, true, shapeFieldName);
    }
    /**
     * @param {?} dataSource
     * @param {?} layer
     * @param {?} searchText
     * @return {?}
     */
    searchRoutesByText(dataSource, layer, searchText) {
        /** @type {?} */
        const useMapService = Boolean(dataSource.serviceUrl);
        /** @type {?} */
        const shapeFieldName = getGeometryFieldName(layer.fields);
        /** @type {?} */
        let whereClause;
        if (!useMapService) {
            whereClause = new WhereClauseBuilder({
                quoteFields: !this.dataSourceConfig.skipColumnQuotes
            })
                .whereLike(layer.displayField, searchText)
                .toWhereClause();
        }
        return useMapService
            ? this.mapService.searchRoutesByText(dataSource.serviceUrl, layer, searchText, { gdbVersion: layer.versionName })
            : this.dataSourceService.querySpatialData(dataSource.id, layer.featureClassName, whereClause, layer.versionName, null, null, true, shapeFieldName);
    }
}
LrsDataService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
LrsDataService.ctorParameters = () => [
    { type: EsriMapServerService },
    { type: DataSourceService },
    { type: DataSourceConfig }
];
/** @nocollapse */ LrsDataService.ngInjectableDef = i0.defineInjectable({ factory: function LrsDataService_Factory() { return new LrsDataService(i0.inject(i1.EsriMapServerService), i0.inject(i2.DataSourceService), i0.inject(i3.DataSourceConfig)); }, token: LrsDataService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    LrsDataService.prototype.mapService;
    /**
     * @type {?}
     * @private
     */
    LrsDataService.prototype.dataSourceService;
    /**
     * @type {?}
     * @private
     */
    LrsDataService.prototype.dataSourceConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHJzLWRhdGEuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0c3Mvc2RrLyIsInNvdXJjZXMiOlsibGliL2xycy9kYXRhL2xycy1kYXRhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUlsRCxPQUFPLEVBQWMsV0FBVyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFHOUYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDMUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFJMUUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDckUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7Ozs7O0FBTXhFLE1BQU0sT0FBTyxjQUFjOzs7Ozs7SUFDekIsWUFDVSxVQUFnQyxFQUNoQyxpQkFBb0MsRUFDcEMsZ0JBQWtDO1FBRmxDLGVBQVUsR0FBVixVQUFVLENBQXNCO1FBQ2hDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtJQUU1QyxDQUFDOzs7Ozs7Ozs7SUFFRCxlQUFlLENBQUksVUFBc0IsRUFBRSxLQUFlLEVBQUUsS0FBMEIsRUFBRSxXQUFvQjs7Y0FDcEcsZ0JBQWdCLEdBQStCLEVBQUUsVUFBVSxFQUFFLEtBQUssQ0FBQyxXQUFXLEVBQUU7O1lBQ2xGLFVBQVU7UUFFZCxJQUFJLFdBQVcsRUFBRTtZQUNmLGdCQUFnQixDQUFDLEtBQUssR0FBRyxXQUFXLENBQUM7WUFDckMsVUFBVSxHQUFHLElBQUksVUFBVSxFQUFFLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQztTQUN6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QixDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLENBQUMsVUFBVSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsRUFBRSxVQUFVLEVBQUUsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2pILENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsZ0JBQWdCLENBQ3ZDLFVBQVUsQ0FBQyxFQUFFLEVBQ2IsS0FBSyxDQUFDLGdCQUFnQixFQUN0QixXQUFXLEVBQ1gsS0FBSyxDQUFDLFdBQVcsRUFDakIsSUFBSSxFQUNKLElBQUksRUFDSixJQUFJLEVBQ0osY0FBYyxDQUNmLENBQUM7SUFDTixDQUFDOzs7WUF0RkYsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7O1lBWFEsb0JBQW9CO1lBQ3BCLGlCQUFpQjtZQUtqQixnQkFBZ0I7Ozs7Ozs7O0lBUXJCLG9DQUF3Qzs7Ozs7SUFDeEMsMkNBQTRDOzs7OztJQUM1QywwQ0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBbmd1bGFyLlxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cFBhcmFtcyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcblxuLy8gM3JkIFBhcnR5LlxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTGF5ZXJGaWVsZCwgdG9GaWVsZE5hbWUsIGdldEdlb21ldHJ5RmllbGROYW1lIH0gZnJvbSAnLi4vLi4vbWFwcy9maWVsZHMvbGF5ZXItZmllbGQnO1xuaW1wb3J0IHsgTHJzTGF5ZXIgfSBmcm9tICcuLi9scnMtbGF5ZXInO1xuaW1wb3J0IHsgRGF0YVNvdXJjZSB9IGZyb20gJy4uLy4uL2RhdGEtc291cmNlL2RhdGEtc291cmNlJztcbmltcG9ydCB7IEVzcmlNYXBTZXJ2ZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vZXNyaS9lc3JpLW1hcC1zZXJ2ZXIuc2VydmljZSc7XG5pbXBvcnQgeyBEYXRhU291cmNlU2VydmljZSB9IGZyb20gJy4uLy4uL2RhdGEtc291cmNlL2RhdGEtc291cmNlLnNlcnZpY2UnO1xuaW1wb3J0IHsgTmV0d29ya0ZlYXR1cmVDb2xsZWN0aW9uIH0gZnJvbSAnLi4vbmV0d29ya3MvbmV0d29yay1mZWF0dXJlLWNvbGxlY3Rpb24nO1xuaW1wb3J0IHsgTmV0d29ya0xheWVyIH0gZnJvbSAnLi4vbmV0d29ya3MvbmV0d29yay1sYXllcic7XG5pbXBvcnQgeyBFc3JpTWFwU2VydmljZVF1ZXJ5T3B0aW9ucyB9IGZyb20gJy4uLy4uL2VzcmkvcXVlcnkvZXNpLW1hcC1zZXJ2aWNlLXF1ZXJ5LW9wdGlvbnMnO1xuaW1wb3J0IHsgV2hlcmVDbGF1c2VCdWlsZGVyIH0gZnJvbSAnLi4vLi4vbWFwcy93aGVyZS1jbGF1c2UtYnVpbGRlcic7XG5pbXBvcnQgeyBEYXRhU291cmNlQ29uZmlnIH0gZnJvbSAnLi4vLi4vZGF0YS1zb3VyY2UvZGF0YS1zb3VyY2UtY29uZmlnJztcblxuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBMcnNEYXRhU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbWFwU2VydmljZTogRXNyaU1hcFNlcnZlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBkYXRhU291cmNlU2VydmljZTogRGF0YVNvdXJjZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBkYXRhU291cmNlQ29uZmlnOiBEYXRhU291cmNlQ29uZmlnXG4gICkge1xuICB9XG5cbiAgZ2V0VW5pcXVlVmFsdWVzPFQ+KGRhdGFTb3VyY2U6IERhdGFTb3VyY2UsIGxheWVyOiBMcnNMYXllciwgZmllbGQ6IHN0cmluZyB8IExheWVyRmllbGQsIHdoZXJlQ2xhdXNlPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxUW10+IHtcbiAgICBjb25zdCBtYXBTZXJ2aWNlUGFyYW1zOiBFc3JpTWFwU2VydmljZVF1ZXJ5T3B0aW9ucyA9IHsgZ2RiVmVyc2lvbjogbGF5ZXIudmVyc2lvbk5hbWUgfTtcbiAgICBsZXQgaHR0cFBhcmFtcztcblxuICAgIGlmICh3aGVyZUNsYXVzZSkge1xuICAgICAgbWFwU2VydmljZVBhcmFtcy53aGVyZSA9IHdoZXJlQ2xhdXNlO1xuICAgICAgaHR0cFBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCkuc2V0KCd3aGVyZScsIHdoZXJlQ2xhdXNlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0YVNvdXJjZS5zZXJ2aWNlVXJsXG4gICAgICA/IHRoaXMubWFwU2VydmljZS5nZXRVbmlxdWVWYWx1ZXM8VD4oZGF0YVNvdXJjZS5zZXJ2aWNlVXJsLCBsYXllciwgZmllbGQsIG1hcFNlcnZpY2VQYXJhbXMpXG4gICAgICA6IHRoaXMuZGF0YVNvdXJjZVNlcnZpY2UuZ2V0VW5pcXVlQ29sdW1uVmFsdWVzPFQ+KGRhdGFTb3VyY2UuaWQsIGxheWVyLmZlYXR1cmVDbGFzc05hbWUsIHRvRmllbGROYW1lKGZpZWxkKSwgaHR0cFBhcmFtcyk7XG4gIH1cblxuICBnZXRRdWVyeUNvdW50KGRhdGFTb3VyY2U6IERhdGFTb3VyY2UsIGxheWVyOiBMcnNMYXllciwgd2hlcmVDbGF1c2U6IHN0cmluZyk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgcmV0dXJuIGRhdGFTb3VyY2Uuc2VydmljZVVybFxuICAgICAgPyB0aGlzLm1hcFNlcnZpY2UuZ2V0UXVlcnlDb3VudChkYXRhU291cmNlLnNlcnZpY2VVcmwsIGxheWVyLCB3aGVyZUNsYXVzZSwgeyBnZGJWZXJzaW9uOiBsYXllci52ZXJzaW9uTmFtZSB9KVxuICAgICAgOiB0aGlzLmRhdGFTb3VyY2VTZXJ2aWNlLmdldFJlY29yZENvdW50KGRhdGFTb3VyY2UuaWQsIGxheWVyLmZlYXR1cmVDbGFzc05hbWUsIHdoZXJlQ2xhdXNlLCBsYXllci52ZXJzaW9uTmFtZSk7XG4gIH1cblxuICBxdWVyeVJvdXRlc0J5SWRzKGRhdGFTb3VyY2U6IERhdGFTb3VyY2UsIGxheWVyOiBOZXR3b3JrTGF5ZXIsIHJvdXRlSWRzOiBzdHJpbmdbXSk6IE9ic2VydmFibGU8TmV0d29ya0ZlYXR1cmVDb2xsZWN0aW9uPiB7XG4gICAgaWYgKCFyb3V0ZUlkcyB8fCAhcm91dGVJZHMubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBxdWVyeSByb3V0ZXMuIE5vIHJvdXRlIElEcyBzdXBwbGllZC4nKTtcbiAgICB9XG5cbiAgICBpZiAoIWxheWVyLmNvbXBvc2l0ZVJvdXRlSWRGaWVsZE5hbWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHF1ZXJ5IHJvdXRlcy4gTm8gJ2NvbXBvc2l0ZVJvdXRlSWRGaWVsZE5hbWUnIHByb3BlcnR5IGZvdW5kIGZvciBsYXllci5gKTtcbiAgICB9XG5cbiAgICBjb25zdCB3aGVyZUNsYXVzZSA9IGAke2xheWVyLmNvbXBvc2l0ZVJvdXRlSWRGaWVsZE5hbWV9IElOICgnJHtyb3V0ZUlkcy5qb2luKGAnLCdgKX0nKWA7XG4gICAgcmV0dXJuIHRoaXMucXVlcnlSb3V0ZXMoZGF0YVNvdXJjZSwgbGF5ZXIsIHdoZXJlQ2xhdXNlKTtcbiAgfVxuXG4gIHF1ZXJ5Um91dGVzKGRhdGFTb3VyY2U6IERhdGFTb3VyY2UsIGxheWVyOiBOZXR3b3JrTGF5ZXIsIHdoZXJlQ2xhdXNlPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxOZXR3b3JrRmVhdHVyZUNvbGxlY3Rpb24+IHtcbiAgICBjb25zdCBzaGFwZUZpZWxkTmFtZSA9IGdldEdlb21ldHJ5RmllbGROYW1lKGxheWVyLmZpZWxkcyk7XG5cbiAgICByZXR1cm4gZGF0YVNvdXJjZS5zZXJ2aWNlVXJsXG4gICAgICA/IHRoaXMubWFwU2VydmljZS5xdWVyeVJvdXRlcyhkYXRhU291cmNlLnNlcnZpY2VVcmwsIGxheWVyLCB3aGVyZUNsYXVzZSwgeyBnZGJWZXJzaW9uOiBsYXllci52ZXJzaW9uTmFtZSB9KVxuICAgICAgOiB0aGlzLmRhdGFTb3VyY2VTZXJ2aWNlLnF1ZXJ5U3BhdGlhbERhdGEoXG4gICAgICAgIGRhdGFTb3VyY2UuaWQsXG4gICAgICAgIGxheWVyLmZlYXR1cmVDbGFzc05hbWUsXG4gICAgICAgIHdoZXJlQ2xhdXNlLFxuICAgICAgICBsYXllci52ZXJzaW9uTmFtZSxcbiAgICAgICAgbnVsbCxcbiAgICAgICAgbnVsbCxcbiAgICAgICAgdHJ1ZSxcbiAgICAgICAgc2hhcGVGaWVsZE5hbWVcbiAgICAgICk7XG4gIH1cblxuICBzZWFyY2hSb3V0ZXNCeVRleHQoZGF0YVNvdXJjZTogRGF0YVNvdXJjZSwgbGF5ZXI6IE5ldHdvcmtMYXllciwgc2VhcmNoVGV4dDogc3RyaW5nKTogT2JzZXJ2YWJsZTxOZXR3b3JrRmVhdHVyZUNvbGxlY3Rpb24+IHtcbiAgICBjb25zdCB1c2VNYXBTZXJ2aWNlID0gQm9vbGVhbihkYXRhU291cmNlLnNlcnZpY2VVcmwpO1xuICAgIGNvbnN0IHNoYXBlRmllbGROYW1lID0gZ2V0R2VvbWV0cnlGaWVsZE5hbWUobGF5ZXIuZmllbGRzKTtcbiAgICBsZXQgd2hlcmVDbGF1c2U6IHN0cmluZztcblxuICAgIGlmICghdXNlTWFwU2VydmljZSkge1xuICAgICAgd2hlcmVDbGF1c2UgPSBuZXcgV2hlcmVDbGF1c2VCdWlsZGVyKHtcbiAgICAgICAgcXVvdGVGaWVsZHM6ICF0aGlzLmRhdGFTb3VyY2VDb25maWcuc2tpcENvbHVtblF1b3Rlc1xuICAgICAgfSlcbiAgICAgICAgLndoZXJlTGlrZShsYXllci5kaXNwbGF5RmllbGQsIHNlYXJjaFRleHQpXG4gICAgICAgIC50b1doZXJlQ2xhdXNlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHVzZU1hcFNlcnZpY2VcbiAgICAgID8gdGhpcy5tYXBTZXJ2aWNlLnNlYXJjaFJvdXRlc0J5VGV4dChkYXRhU291cmNlLnNlcnZpY2VVcmwsIGxheWVyLCBzZWFyY2hUZXh0LCB7IGdkYlZlcnNpb246IGxheWVyLnZlcnNpb25OYW1lIH0pXG4gICAgICA6IHRoaXMuZGF0YVNvdXJjZVNlcnZpY2UucXVlcnlTcGF0aWFsRGF0YShcbiAgICAgICAgZGF0YVNvdXJjZS5pZCxcbiAgICAgICAgbGF5ZXIuZmVhdHVyZUNsYXNzTmFtZSxcbiAgICAgICAgd2hlcmVDbGF1c2UsXG4gICAgICAgIGxheWVyLnZlcnNpb25OYW1lLFxuICAgICAgICBudWxsLFxuICAgICAgICBudWxsLFxuICAgICAgICB0cnVlLFxuICAgICAgICBzaGFwZUZpZWxkTmFtZVxuICAgICAgKTtcbiAgfVxufVxuIl19