/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// Angular.
import { HttpClient, HttpParams } from '@angular/common/http';
import { Injectable } from '@angular/core';
// TSS.
import { DataSourceConfig } from './data-source-config';
import { BaseResourceService } from '../core/resource/base-resource.service';
import { EMPTY_PARAM_VALUE } from '../core/resource/resource.constants';
import { isValue } from '../core/type-check/is-value.function';
import { SELECT_ALL_WHERE_CLAUSE } from './data-source.constants';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "./data-source-config";
export class DataSourceService extends BaseResourceService {
    /**
     * @param {?} http
     * @param {?} dsConfig
     */
    constructor(http, dsConfig) {
        super(http, {
            url: dsConfig.serviceUrl,
            queryEndpoint: dsConfig.dataSourcesEndpoint,
            getEndpoint: dsConfig.dataSourcesEndpoint,
            updateEndpoint: dsConfig.dataSourcesEndpoint,
            deleteEndpoint: dsConfig.dataSourcesEndpoint,
            createEndpoint: dsConfig.dataSourcesEndpoint,
        });
        this.http = http;
        this.dsConfig = dsConfig;
    }
    /**
     * @param {?} entity
     * @param {?} useEntityFramework
     * @param {?=} params
     * @return {?}
     */
    testConnection(entity, useEntityFramework, params) {
        throw new Error('Not implemented yet');
    }
    /**
     * @param {?} id
     * @param {?=} params
     * @return {?}
     */
    testExistingConnection(id, params) {
        throw new Error('Not implemented yet');
    }
    // 'http:' + this.appConfig.serviceUrl + '/api/data/sources/:id/tables'
    /**
     * @param {?} dataSourceId
     * @param {?=} params
     * @return {?}
     */
    getTables(dataSourceId, params) {
        /** @type {?} */
        const url = this.getUrlWithId(dataSourceId, this.dsConfig.tablesEndpoint, {});
        return this.http.get(url, { params });
    }
    // 'http:' + this.appConfig.serviceUrl + '/api/data/sources/:id/tables/details'
    /**
     * @param {?} dataSourceId
     * @param {?=} params
     * @return {?}
     */
    getTableDetails(dataSourceId, params) {
        /** @type {?} */
        const url = this.getUrlWithId(dataSourceId, this.dsConfig.tableActionEndpoint, {
            action: 'details'
        });
        return this.http.get(url, { params });
    }
    // 'http:' + this.appConfig.serviceUrl + '/api/data/sources/:id/tables/:table/columns/:column/:action',
    /**
     * @param {?} dataSourceId
     * @param {?} table
     * @param {?=} params
     * @return {?}
     */
    getColumns(dataSourceId, table, params) {
        /** @type {?} */
        const url = this.getUrlWithId(dataSourceId, this.dsConfig.columnsEndpoint, { table });
        return this.http.get(url, { params });
    }
    // api/data/sources/test_1051_sql/tables/RH.DIVIDED_ROADS/columns/SurveyDirection/values?unique=false
    /**
     * @template T
     * @param {?} dataSourceId
     * @param {?} table
     * @param {?} column
     * @param {?=} unique
     * @param {?=} params
     * @return {?}
     */
    getColumnValues(dataSourceId, table, column, unique = false, params) {
        /** @type {?} */
        const url = this.getUrlWithId(dataSourceId, this.dsConfig.columnsEndpoint, {
            table,
            column,
            action: 'values'
        });
        params = (params || new HttpParams()).set('unique', String(unique));
        return this.http.get(url, { params });
    }
    // api/data/sources/test_1051_sql/tables/RH.DIVIDED_ROADS/columns/SurveyDirection/values?unique=true
    /**
     * @template T
     * @param {?} dataSourceId
     * @param {?} table
     * @param {?} column
     * @param {?=} params
     * @return {?}
     */
    getUniqueColumnValues(dataSourceId, table, column, params) {
        return this.getColumnValues(dataSourceId, table, column, true, params);
    }
    // 'http:' + this.appConfig.serviceUrl + '/api/data/sources/:id/tables/:count'
    /**
     * @param {?} dataSourceId
     * @param {?} table
     * @param {?=} whereClause
     * @param {?=} version
     * @param {?=} params
     * @return {?}
     */
    getRecordCount(dataSourceId, table, whereClause = SELECT_ALL_WHERE_CLAUSE, version, params) {
        /** @type {?} */
        const url = this.getUrlWithId(dataSourceId, this.dsConfig.tableActionEndpoint, {
            table,
            action: 'count'
        });
        params = (params || new HttpParams())
            .set('where', whereClause)
            .set('version', version || EMPTY_PARAM_VALUE);
        return this.http.get(url, { params });
    }
    // api/data/sources/test_1051_sql/tables/RH.DIVIDED_ROADS/query/details?page=1&pageSize=25&where=1%3D1
    /**
     * @param {?} dataSourceId
     * @param {?} table
     * @param {?} whereClause
     * @param {?=} version
     * @param {?=} page
     * @param {?=} pageSize
     * @param {?=} includeGeometry
     * @param {?=} shapeField
     * @param {?=} params
     * @return {?}
     */
    queryData(dataSourceId, table, whereClause, version, page, pageSize, includeGeometry, shapeField, params) {
        return this.querySpatialData(dataSourceId, table, whereClause, version, page, pageSize, includeGeometry, shapeField, 'json', params);
    }
    /**
     * @param {?} dataSourceId
     * @param {?} table
     * @param {?} whereClause
     * @param {?=} version
     * @param {?=} page
     * @param {?=} pageSize
     * @param {?=} includeGeometry
     * @param {?=} shapeField
     * @param {?=} params
     * @return {?}
     */
    queryGeoJsonData(dataSourceId, table, whereClause, version, page, pageSize, includeGeometry, shapeField, params) {
        return this.querySpatialData(dataSourceId, table, whereClause, version, page, pageSize, includeGeometry, shapeField, 'geojson', params);
    }
    /**
     * @template T
     * @param {?} dataSourceId
     * @param {?} table
     * @param {?} whereClause
     * @param {?=} version
     * @param {?=} page
     * @param {?=} pageSize
     * @param {?=} includeGeometry
     * @param {?=} shapeField
     * @param {?=} format
     * @param {?=} params
     * @return {?}
     */
    querySpatialData(dataSourceId, table, whereClause, version, page, pageSize, includeGeometry, shapeField, format, params) {
        /** @type {?} */
        const url = this.getUrlWithId(dataSourceId, this.dsConfig.tableActionEndpoint, {
            table,
            action: 'query/details'
        });
        params = (params || new HttpParams())
            .set('where', whereClause || EMPTY_PARAM_VALUE)
            .set('version', version || EMPTY_PARAM_VALUE)
            .set('page', isValue(page) ? String(page) : EMPTY_PARAM_VALUE)
            .set('pageSize', isValue(pageSize) ? String(pageSize) : EMPTY_PARAM_VALUE)
            .set('includeGeometry', isValue(includeGeometry) ? String(includeGeometry) : EMPTY_PARAM_VALUE)
            .set('shapeField', shapeField || EMPTY_PARAM_VALUE)
            .set('format', format || EMPTY_PARAM_VALUE);
        return this.http.get(url, { params });
    }
}
DataSourceService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
DataSourceService.ctorParameters = () => [
    { type: HttpClient },
    { type: DataSourceConfig }
];
/** @nocollapse */ DataSourceService.ngInjectableDef = i0.defineInjectable({ factory: function DataSourceService_Factory() { return new DataSourceService(i0.inject(i1.HttpClient), i0.inject(i2.DataSourceConfig)); }, token: DataSourceService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @protected
     */
    DataSourceService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    DataSourceService.prototype.dsConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YS1zb3VyY2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0c3Mvc2RrLyIsInNvdXJjZXMiOlsibGliL2RhdGEtc291cmNlL2RhdGEtc291cmNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzlELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7O0FBTzNDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBTXhELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQzdFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMvRCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQzs7OztBQU1sRSxNQUFNLE9BQU8saUJBQWtCLFNBQVEsbUJBQStCOzs7OztJQUNwRSxZQUFzQixJQUFnQixFQUFVLFFBQTBCO1FBQ3hFLEtBQUssQ0FBQyxJQUFJLEVBQUU7WUFDVixHQUFHLEVBQUUsUUFBUSxDQUFDLFVBQVU7WUFDeEIsYUFBYSxFQUFFLFFBQVEsQ0FBQyxtQkFBbUI7WUFDM0MsV0FBVyxFQUFFLFFBQVEsQ0FBQyxtQkFBbUI7WUFDekMsY0FBYyxFQUFFLFFBQVEsQ0FBQyxtQkFBbUI7WUFDNUMsY0FBYyxFQUFFLFFBQVEsQ0FBQyxtQkFBbUI7WUFDNUMsY0FBYyxFQUFFLFFBQVEsQ0FBQyxtQkFBbUI7U0FDN0MsQ0FBQyxDQUFDO1FBUmlCLFNBQUksR0FBSixJQUFJLENBQVk7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFrQjtJQVMxRSxDQUFDOzs7Ozs7O0lBRUQsY0FBYyxDQUFDLE1BQWtCLEVBQUUsa0JBQTJCLEVBQUUsTUFBbUI7UUFDakYs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VyxJQUFJLGlCQUFpQixDQUFDO2FBQzlDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsT0FBTyxJQUFJLGlCQUFpQixDQUFDO2FBQzVDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDO2FBQzdELEdBQUcsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDO2FBQ3pFLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUM7YUFDOUYsR0FBRyxDQUFDLFlBQVksRUFBRSxVQUFVLElBQUksaUJBQWlCLENBQUM7YUFDbEQsR0FBRyxDQUFDLFFBQVEsRUFBRSxNQUFNLElBQUksaUJBQWlCLENBQUMsQ0FBQztRQUU5QyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFJLEdBQUcsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDM0MsQ0FBQzs7O1lBaEtGLFVBQVUsU0FBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7OztZQXRCUSxVQUFVO1lBUVYsZ0JBQWdCOzs7Ozs7OztJQWdCWCxpQ0FBMEI7Ozs7O0lBQUUscUNBQWtDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQW5ndWxhci5cbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBQYXJhbXMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbi8vIDNyZCBQYXJ0eS5cbmltcG9ydCB7IEZlYXR1cmVDb2xsZWN0aW9uIH0gZnJvbSAnZ2VvanNvbic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbi8vIFRTUy5cbmltcG9ydCB7IERhdGFTb3VyY2VDb25maWcgfSBmcm9tICcuL2RhdGEtc291cmNlLWNvbmZpZyc7XG5pbXBvcnQgeyBEYXRhU291cmNlIH0gZnJvbSAnLi9kYXRhLXNvdXJjZSc7XG5pbXBvcnQgeyBEYXRhVGFibGVJbmZvIH0gZnJvbSAnLi9kYXRhLXRhYmxlLWluZm8nO1xuaW1wb3J0IHsgRGF0YUNvbHVtbiB9IGZyb20gJy4vZGF0YS1jb2x1bW4nO1xuaW1wb3J0IHsgRGF0YVRhYmxlIH0gZnJvbSAnLi9kYXRhLXRhYmxlJztcbmltcG9ydCB7IERhdGFTb3VyY2VTcGF0aWFsRXhwb3J0Rm9ybWF0IH0gZnJvbSAnLi9kYXRhLXNvdXJjZS1zcGF0aWFsLWV4cG9ydC1mb3JtYXQnO1xuaW1wb3J0IHsgQmFzZVJlc291cmNlU2VydmljZSB9IGZyb20gJy4uL2NvcmUvcmVzb3VyY2UvYmFzZS1yZXNvdXJjZS5zZXJ2aWNlJztcbmltcG9ydCB7IEVNUFRZX1BBUkFNX1ZBTFVFIH0gZnJvbSAnLi4vY29yZS9yZXNvdXJjZS9yZXNvdXJjZS5jb25zdGFudHMnO1xuaW1wb3J0IHsgaXNWYWx1ZSB9IGZyb20gJy4uL2NvcmUvdHlwZS1jaGVjay9pcy12YWx1ZS5mdW5jdGlvbic7XG5pbXBvcnQgeyBTRUxFQ1RfQUxMX1dIRVJFX0NMQVVTRSB9IGZyb20gJy4vZGF0YS1zb3VyY2UuY29uc3RhbnRzJztcblxuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBEYXRhU291cmNlU2VydmljZSBleHRlbmRzIEJhc2VSZXNvdXJjZVNlcnZpY2U8RGF0YVNvdXJjZT4ge1xuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaHR0cDogSHR0cENsaWVudCwgcHJpdmF0ZSBkc0NvbmZpZzogRGF0YVNvdXJjZUNvbmZpZykge1xuICAgIHN1cGVyKGh0dHAsIHtcbiAgICAgIHVybDogZHNDb25maWcuc2VydmljZVVybCxcbiAgICAgIHF1ZXJ5RW5kcG9pbnQ6IGRzQ29uZmlnLmRhdGFTb3VyY2VzRW5kcG9pbnQsXG4gICAgICBnZXRFbmRwb2ludDogZHNDb25maWcuZGF0YVNvdXJjZXNFbmRwb2ludCxcbiAgICAgIHVwZGF0ZUVuZHBvaW50OiBkc0NvbmZpZy5kYXRhU291cmNlc0VuZHBvaW50LFxuICAgICAgZGVsZXRlRW5kcG9pbnQ6IGRzQ29uZmlnLmRhdGFTb3VyY2VzRW5kcG9pbnQsXG4gICAgICBjcmVhdGVFbmRwb2ludDogZHNDb25maWcuZGF0YVNvdXJjZXNFbmRwb2ludCxcbiAgICB9KTtcbiAgfVxuXG4gIHRlc3RDb25uZWN0aW9uKGVudGl0eTogRGF0YVNvdXJjZSwgdXNlRW50aXR5RnJhbWV3b3JrOiBib29sZWFuLCBwYXJhbXM/OiBIdHRwUGFyYW1zKTogT2JzZXJ2YWJsZTxEYXRhVGFibGU+IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCB5ZXQnKTtcbiAgfVxuXG4gIHRlc3RFeGlzdGluZ0Nvbm5lY3Rpb24oaWQ6IHN0cmluZywgcGFyYW1zPzogSHR0cFBhcmFtcyk6IE9ic2VydmFibGU8RGF0YVRhYmxlPiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQgeWV0Jyk7XG4gIH1cblxuICAvLyAnaHR0cDonICsgdGhpcy5hcHBDb25maWcuc2VydmljZVVybCArICcvYXBpL2RhdGEvc291cmNlcy86aWQvdGFibGVzJ1xuICBnZXRUYWJsZXMoZGF0YVNvdXJjZUlkOiBzdHJpbmcsIHBhcmFtcz86IEh0dHBQYXJhbXMpOiBPYnNlcnZhYmxlPERhdGFUYWJsZUluZm9bXT4ge1xuICAgIGNvbnN0IHVybCA9IHRoaXMuZ2V0VXJsV2l0aElkKGRhdGFTb3VyY2VJZCwgdGhpcy5kc0NvbmZpZy50YWJsZXNFbmRwb2ludCwge30pO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PERhdGFUYWJsZUluZm9bXT4odXJsLCB7IHBhcmFtcyB9KTtcbiAgfVxuXG4gIC8vICdodHRwOicgKyB0aGlzLmFwcENvbmZpZy5zZXJ2aWNlVXJsICsgJy9hcGkvZGF0YS9zb3VyY2VzLzppZC90YWJsZXMvZGV0YWlscydcbiAgZ2V0VGFibGVEZXRhaWxzKGRhdGFTb3VyY2VJZDogc3RyaW5nLCBwYXJhbXM/OiBIdHRwUGFyYW1zKTogT2JzZXJ2YWJsZTxEYXRhVGFibGU+IHtcbiAgICBjb25zdCB1cmwgPSB0aGlzLmdldFVybFdpdGhJZChkYXRhU291cmNlSWQsIHRoaXMuZHNDb25maWcudGFibGVBY3Rpb25FbmRwb2ludCwge1xuICAgICAgYWN0aW9uOiAnZGV0YWlscydcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PERhdGFUYWJsZT4odXJsLCB7IHBhcmFtcyB9KTtcbiAgfVxuXG4gIC8vICdodHRwOicgKyB0aGlzLmFwcENvbmZpZy5zZXJ2aWNlVXJsICsgJy9hcGkvZGF0YS9zb3VyY2VzLzppZC90YWJsZXMvOnRhYmxlL2NvbHVtbnMvOmNvbHVtbi86YWN0aW9uJyxcbiAgZ2V0Q29sdW1ucyhkYXRhU291cmNlSWQ6IHN0cmluZywgdGFibGU6IHN0cmluZywgcGFyYW1zPzogSHR0cFBhcmFtcyk6IE9ic2VydmFibGU8RGF0YUNvbHVtbltdPiB7XG4gICAgY29uc3QgdXJsID0gdGhpcy5nZXRVcmxXaXRoSWQoZGF0YVNvdXJjZUlkLCB0aGlzLmRzQ29uZmlnLmNvbHVtbnNFbmRwb2ludCwgeyB0YWJsZSB9KTtcblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PERhdGFDb2x1bW5bXT4odXJsLCB7IHBhcmFtcyB9KTtcbiAgfVxuXG4gIC8vIGFwaS9kYXRhL3NvdXJjZXMvdGVzdF8xMDUxX3NxbC90YWJsZXMvUkguRElWSURFRF9ST0FEUy9jb2x1bW5zL1N1cnZleURpcmVjdGlvbi92YWx1ZXM/dW5pcXVlPWZhbHNlXG4gIGdldENvbHVtblZhbHVlczxUPihkYXRhU291cmNlSWQ6IHN0cmluZywgdGFibGU6IHN0cmluZywgY29sdW1uOiBzdHJpbmcsIHVuaXF1ZTogYm9vbGVhbiA9IGZhbHNlLCBwYXJhbXM/OiBIdHRwUGFyYW1zKTogT2JzZXJ2YWJsZTxUW10+IHtcbiAgICBjb25zdCB1cmwgPSB0aGlzLmdldFVybFdpdGhJZChkYXRhU291cmNlSWQsIHRoaXMuZHNDb25maWcuY29sdW1uc0VuZHBvaW50LCB7XG4gICAgICB0YWJsZSxcbiAgICAgIGNvbHVtbixcbiAgICAgIGFjdGlvbjogJ3ZhbHVlcydcbiAgICB9KTtcbiAgICBwYXJhbXMgPSAocGFyYW1zIHx8IG5ldyBIdHRwUGFyYW1zKCkpLnNldCgndW5pcXVlJywgU3RyaW5nKHVuaXF1ZSkpO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8VFtdPih1cmwsIHsgcGFyYW1zIH0pO1xuICB9XG5cbiAgLy8gYXBpL2RhdGEvc291cmNlcy90ZXN0XzEwNTFfc3FsL3RhYmxlcy9SSC5ESVZJREVEX1JPQURTL2NvbHVtbnMvU3VydmV5RGlyZWN0aW9uL3ZhbHVlcz91bmlxdWU9dHJ1ZVxuICBnZXRVbmlxdWVDb2x1bW5WYWx1ZXM8VD4oZGF0YVNvdXJjZUlkOiBzdHJpbmcsIHRhYmxlOiBzdHJpbmcsIGNvbHVtbjogc3RyaW5nLCBwYXJhbXM/OiBIdHRwUGFyYW1zKTogT2JzZXJ2YWJsZTxUW10+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRDb2x1bW5WYWx1ZXM8VD4oZGF0YVNvdXJjZUlkLCB0YWJsZSwgY29sdW1uLCB0cnVlLCBwYXJhbXMpO1xuICB9XG5cbiAgLy8gJ2h0dHA6JyArIHRoaXMuYXBwQ29uZmlnLnNlcnZpY2VVcmwgKyAnL2FwaS9kYXRhL3NvdXJjZXMvOmlkL3RhYmxlcy86Y291bnQnXG4gIGdldFJlY29yZENvdW50KFxuICAgIGRhdGFTb3VyY2VJZDogc3RyaW5nLFxuICAgIHRhYmxlOiBzdHJpbmcsXG4gICAgd2hlcmVDbGF1c2U6IHN0cmluZyA9IFNFTEVDVF9BTExfV0hFUkVfQ0xBVVNFLFxuICAgIHZlcnNpb24/OiBzdHJpbmcsXG4gICAgcGFyYW1zPzogSHR0cFBhcmFtc1xuICApOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIGNvbnN0IHVybCA9IHRoaXMuZ2V0VXJsV2l0aElkKGRhdGFTb3VyY2VJZCwgdGhpcy5kc0NvbmZpZy50YWJsZUFjdGlvbkVuZHBvaW50LCB7XG4gICAgICB0YWJsZSxcbiAgICAgIGFjdGlvbjogJ2NvdW50J1xuICAgIH0pO1xuXG4gICAgcGFyYW1zID0gKHBhcmFtcyB8fCBuZXcgSHR0cFBhcmFtcygpKVxuICAgICAgLnNldCgnd2hlcmUnLCB3aGVyZUNsYXVzZSlcbiAgICAgIC5zZXQoJ3ZlcnNpb24nLCB2ZXJzaW9uIHx8IEVNUFRZX1BBUkFNX1ZBTFVFKTtcblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PG51bWJlcj4odXJsLCB7IHBhcmFtcyB9KTtcbiAgfVxuXG4gIC8vIGFwaS9kYXRhL3NvdXJjZXMvdGVzdF8xMDUxX3NxbC90YWJsZXMvUkguRElWSURFRF9ST0FEUy9xdWVyeS9kZXRhaWxzP3BhZ2U9MSZwYWdlU2l6ZT0yNSZ3aGVyZT0xJTNEMVxuICBxdWVyeURhdGEoXG4gICAgZGF0YVNvdXJjZUlkOiBzdHJpbmcsXG4gICAgdGFibGU6IHN0cmluZyxcbiAgICB3aGVyZUNsYXVzZTogc3RyaW5nLFxuICAgIHZlcnNpb24/OiBzdHJpbmcsXG4gICAgcGFnZT86IG51bWJlcixcbiAgICBwYWdlU2l6ZT86IG51bWJlcixcbiAgICBpbmNsdWRlR2VvbWV0cnk/OiBib29sZWFuLFxuICAgIHNoYXBlRmllbGQ/OiBzdHJpbmcsXG4gICAgcGFyYW1zPzogSHR0cFBhcmFtc1xuICApOiBPYnNlcnZhYmxlPERhdGFUYWJsZT4ge1xuICAgIHJldHVybiB0aGlzLnF1ZXJ5U3BhdGlhbERhdGE8RGF0YVRhYmxlPihcbiAgICAgIGRhdGFTb3VyY2VJZCxcbiAgICAgIHRhYmxlLFxuICAgICAgd2hlcmVDbGF1c2UsXG4gICAgICB2ZXJzaW9uLFxuICAgICAgcGFnZSxcbiAgICAgIHBhZ2VTaXplLFxuICAgICAgaW5jbHVkZUdlb21ldHJ5LFxuICAgICAgc2hhcGVGaWVsZCxcbiAgICAgICdqc29uJyxcbiAgICAgIHBhcmFtcyxcbiAgICApO1xuICB9XG5cbiAgcXVlcnlHZW9Kc29uRGF0YShcbiAgICBkYXRhU291cmNlSWQ6IHN0cmluZyxcbiAgICB0YWJsZTogc3RyaW5nLFxuICAgIHdoZXJlQ2xhdXNlOiBzdHJpbmcsXG4gICAgdmVyc2lvbj86IHN0cmluZyxcbiAgICBwYWdlPzogbnVtYmVyLFxuICAgIHBhZ2VTaXplPzogbnVtYmVyLFxuICAgIGluY2x1ZGVHZW9tZXRyeT86IGJvb2xlYW4sXG4gICAgc2hhcGVGaWVsZD86IHN0cmluZyxcbiAgICBwYXJhbXM/OiBIdHRwUGFyYW1zXG4gICk6IE9ic2VydmFibGU8RmVhdHVyZUNvbGxlY3Rpb24+IHtcbiAgICByZXR1cm4gdGhpcy5xdWVyeVNwYXRpYWxEYXRhPEZlYXR1cmVDb2xsZWN0aW9uPihcbiAgICAgIGRhdGFTb3VyY2VJZCxcbiAgICAgIHRhYmxlLFxuICAgICAgd2hlcmVDbGF1c2UsXG4gICAgICB2ZXJzaW9uLFxuICAgICAgcGFnZSxcbiAgICAgIHBhZ2VTaXplLFxuICAgICAgaW5jbHVkZUdlb21ldHJ5LFxuICAgICAgc2hhcGVGaWVsZCxcbiAgICAgICdnZW9qc29uJyxcbiAgICAgIHBhcmFtcyxcbiAgICApO1xuICB9XG5cbiAgcXVlcnlTcGF0aWFsRGF0YTxUIGV4dGVuZHMgRGF0YVRhYmxlIHwgRmVhdHVyZUNvbGxlY3Rpb24+KFxuICAgIGRhdGFTb3VyY2VJZDogc3RyaW5nLFxuICAgIHRhYmxlOiBzdHJpbmcsXG4gICAgd2hlcmVDbGF1c2U6IHN0cmluZyxcbiAgICB2ZXJzaW9uPzogc3RyaW5nLFxuICAgIHBhZ2U/OiBudW1iZXIsXG4gICAgcGFnZVNpemU/OiBudW1iZXIsXG4gICAgaW5jbHVkZUdlb21ldHJ5PzogYm9vbGVhbixcbiAgICBzaGFwZUZpZWxkPzogc3RyaW5nLFxuICAgIGZvcm1hdD86IERhdGFTb3VyY2VTcGF0aWFsRXhwb3J0Rm9ybWF0LFxuICAgIHBhcmFtcz86IEh0dHBQYXJhbXNcbiAgKTogT2JzZXJ2YWJsZTxUPiB7XG4gICAgY29uc3QgdXJsID0gdGhpcy5nZXRVcmxXaXRoSWQoZGF0YVNvdXJjZUlkLCB0aGlzLmRzQ29uZmlnLnRhYmxlQWN0aW9uRW5kcG9pbnQsIHtcbiAgICAgIHRhYmxlLFxuICAgICAgYWN0aW9uOiAncXVlcnkvZGV0YWlscydcbiAgICB9KTtcblxuICAgIHBhcmFtcyA9IChwYXJhbXMgfHwgbmV3IEh0dHBQYXJhbXMoKSlcbiAgICAgIC5zZXQoJ3doZXJlJywgd2hlcmVDbGF1c2UgfHwgRU1QVFlfUEFSQU1fVkFMVUUpXG4gICAgICAuc2V0KCd2ZXJzaW9uJywgdmVyc2lvbiB8fCBFTVBUWV9QQVJBTV9WQUxVRSlcbiAgICAgIC5zZXQoJ3BhZ2UnLCBpc1ZhbHVlKHBhZ2UpID8gU3RyaW5nKHBhZ2UpIDogRU1QVFlfUEFSQU1fVkFMVUUpXG4gICAgICAuc2V0KCdwYWdlU2l6ZScsIGlzVmFsdWUocGFnZVNpemUpID8gU3RyaW5nKHBhZ2VTaXplKSA6IEVNUFRZX1BBUkFNX1ZBTFVFKVxuICAgICAgLnNldCgnaW5jbHVkZUdlb21ldHJ5JywgaXNWYWx1ZShpbmNsdWRlR2VvbWV0cnkpID8gU3RyaW5nKGluY2x1ZGVHZW9tZXRyeSkgOiBFTVBUWV9QQVJBTV9WQUxVRSlcbiAgICAgIC5zZXQoJ3NoYXBlRmllbGQnLCBzaGFwZUZpZWxkIHx8IEVNUFRZX1BBUkFNX1ZBTFVFKVxuICAgICAgLnNldCgnZm9ybWF0JywgZm9ybWF0IHx8IEVNUFRZX1BBUkFNX1ZBTFVFKTtcblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFQ+KHVybCwgeyBwYXJhbXMgfSk7XG4gIH1cbn1cbiJdfQ==